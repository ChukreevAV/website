<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Визуализация данных уловов  на базе табличных данных и регулярной полигональной сети</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">	  
<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/projects.html">Проекты</a></li>
</ul>
<!--Contents start-->
<h1>Визуализация данных уловов  на базе табличных данных и регулярной полигональной сети</h1>
<p class="ann">Реализация пространственного запроса assign by location с помощью Excel и дальнейшая визуализация в ArcGIS </p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=1330"--></span></p>
<p>Целью настоящего  сообщения является изложение процесса обработки данных по уловам гидробионтов для  последующей визуализации их с помощью регулярной полигональной сети в ArcGIS. В данной статье подробно разбирается визуализация данных на  примере улова тихоокеанских лососей.</p>
            <p>Допустим, перед нами стоит задача подготовить для последующей визуализации в ArcGIS данные, отражающие плотность лососей на акватории, ограниченной координатами 30-65 с.ш. и 125-180 в.д.</p>
            <p> Для  визуализации данных, необходимы 2 программы: ArcGIS и Excel и 2 расширения для них Fishnet для ArcGIS и SeaSalmonCatch для Excel). Надстройка  для ArcGIS доступна <a href="http://arcscripts.esri.com/details.asp?dbid=12807" target="_blank" class="external">через Arcscripts</a> ,  надстройку для MS&nbsp;Excel  можно получить, прислав запрос на salmon@magniro.ru.</p>
            <p> Следуя  инструкциям, прилагающимся к надстройке Fishnet, устанавливаем ее:</p>
            <ul>
              <li>распаковываем загруженный из интернета файл в  папку, из которой будет работать надстройка;</li>
              <li>запускаем ArcGIS (ArcMap или ArcCatalog  (надстройка работает в обеих программах));</li>
              <li>выбираем меню Tools, в  нем выбираем Customize…;</li>
              <li>в появившемся диалоговом окне Customize выбираем Add from file…;</li>
              <li>выбираем папку, в которой расположен Fishnet.dll;</li>
              <li>выбираем Fishnet.dll и нажимаем Open.</li>
              <li>выбираем закладку Commands диалогового  окна Customize.</li>
              <li>в окне Categories диалогового окна  Customize выбираем запись Developer Samples;</li>
              <li>в окне Commands  диалогового окна Customize выбираем  Fishnet;</li>
              <li>перетаскиваем Fishnet в  любую панель ArcGIS;</li>
              <li>закрываем диалоговое окно Customize.</li>
            </ul>
            <p>Установив расширение, запускаем его. В диалоговом окне Create Fishnet (создать сетку) нужно ввести параметры, необходимые для построения регулярной полигональной сети. Особо отметим, что флажок напротив Create Spatial Index обязательно должен быть установлен, в результате будет создано индексное поле, по которому мы сможем в дальнейшем обновлять данные. </p>
            <table width="95%" border="0" align="center">
              <tr>
                <td valign="top"><p>В нашем случае: </p>
                  <ul>
                    <li>Параметр Lover Left Corner (Нижний Левый Угол) указываем для Х (долгота) 125, для Y (широта) 30;</li>
                    <li>Параметр Number Of (Количество) указываем Rows (Строк) 35 (т.е. 65-30=35 строк), а в Columns (Столбцы) 55 (т.е. 180-125=55 столбцов); </li>
                    <li>Параметр  Size of each Cells (Размер ячеек) указываем для Width (Ширина) и для Height (Высота) по 1; </li>
                    <li>Параметр Specify Output Shapefile выбираем месторасположение шейп-файла и указываем его имя (в нашем случае - 1-градусный); </li>
                    <li>При необходимости в рамке Coordinat System (optional) выбираем Систему координат для создаваемого шейп-файла; </li>
                    <li>Параметр Make (Сделать) отмечаем Polygons (Полигоны).</span></li>
                  </ul>                  </td>
                <td><img src="/images/salmon-viz-01.gif" alt="fishnet" width="309" height="505" /></td>
              </tr>
            </table>
            <p>Результатом работы будет регулярная полигональная сеть заданного географического охвата и размеров ячейки. </p>
            <p align="center"><img src="/images/salmon-viz-02.gif" alt="фрагмент полигональной сети" width="381" height="205" /></p>
            <p>В результате работы расширения Fishnet создается полигональная тема в формате shape-file. Эта тема в свою очередь состоит из 5 файлов, которые имеют одинаковое название, но разные расширения: в нашем случае все файлы с именем «1-градусный», а расширения shp, shx, dbf, sbx и sbn. Из всего этого разнообразия для дальнейшей работы нам нужен только файл, имеющий расширение dbf. В нем хранятся атрибуты каждой ячейки полигональной сети, а иными словами – информация, которая отражается на карте. Сейчас в dbf-файле находится только одно индексное поле, содержащее порядковый номер каждой ячейки.</p>
            <p>Внести в dbf-файл данные можно в MS Excel. В случае большого количества ячеек заполнение dbf-файла трудоемко и может привести к ошибкам. Поэтому при подготовке материалов для их представления в ArcGIS предлагается воспользоваться надстройкой (Add-In) SeaSalmonCatch для  Excel, специально подготовленной для визуализации данных по уловам тихоокеанских лососей в период исследования их морского периода жизни. Единственное, что требуется – установить надстройку  (Надстройка в Windows XP копируется в Имя диска:\Documents and Settings\имя пользователя\Application Data\Microsoft\AddIns\, а в MS Excel она включается в меню Сервис\Надстройки…) и привести данные к единой форме (таблица) – поля с A по J должны быть заполнены.</p>
            <table width="60%" border="0" align="center">
              <tr>
                <th><p>Поле</p></th>
                <th><p>Наименование</p></th>
                <th><p>Поле</p></th>
                <th><p>Наименование</p></th>
              </tr>
              <tr>
                <td><p align="center">A<br />
                  B<br />
                  C<br />
                  D<br />
                  E<br />
                  F<br />
                  G<br />
                  H<br />
                  I<br />
                  J<br />
                  K<br />
                  L<br />
                M </p></td>
                <td><p>подзона<br />
                  институт<br />
                  судно<br />
                  Дата<br />
                  Широта<br />
                  Долгота<br />
                  Сетей_шт.<br />
                  Сетей_м<br />
                  Ячея<br />
                  застой_мин.<br />
                  нерка_экз.<br />
                  нерка_кг<br />
                кета_экз </p></td>
                <td><p align="center">N<br />
                  O<br />
                  P<br />
                  Q<br />
                  R<br />
                  S<br />
                  T<br />
                  U<br />
                  V<br />
                  W<br />
                  X<br />
                  Y<br />
                Z </p></td>
                <td><p>кета_кг<br />
                  горбуша_экз.<br />
                  горбуша_кг<br />
                  чавыча_экз.<br />
                  чавыча_кг<br />
                  кижуч_экз.<br />
                  кижуч_кг<br />
                  сима_экз.<br />
                  сима_кг<br />
                  микижа_экз.<br />
                  микижа_кг<br />
                  вылов_экз.<br />
                вылов_кг </p></td>
              </tr>
            </table>
            <p>Унифицировав данные, приступаем к их обработке. В меню SeaSalmonCatch (оно появляется после установки одноименной надстройки и возможно для его появления придется перезапустить MS Excel) выбираем пункт &quot;Отбор данных для полигонов&quot;. В появившемся диалоговом окне указываем параметры, по которым мы хотим отобрать данные. Пример заполения диалоговой формы SeaSalmonCatch при отборе данных по плотности лососей на акватории, ограниченной координатами 30-65 с.ш. и 125-180 в.д., приведен ниже.</p>
            <p align="center"><img src="/images/salmon-viz-03.gif" alt="фрагмент полигональной сети" width="514" height="301" /></p>
            <p>Отметим, что обработка ведется на отдельных листах и исходные материалы не изменяются. Кроме того, для каждого дискретного периода времени формируется свой лист. Эти листы и будут подставляться в качестве dbf-файлов. </p>
            <p>Для того, чтобы обеспечить правильное связывание dbf-файлов, сформированных в ходе работы Fishnet и SeaSalmonCatch, у нас есть индексное поле как в шейп-файле (для этого мы ставили флажок напротив Create Spatial Index в диалоговом окне Create Fishnet, так и эквивалентное в таблице Excel созданное по тому же географическому охвату и шагу ячейки.  Алгоритм работы надстройки SeaSalmonCatch таков, что в ходе ее выполнения формируется такое же индексное поле, а для проверки правильности отбора данных создаются 2 дополнительных поля Lat и Long, в которых приводятся координаты, левой и правой границы долготы и нижней и верхней границ широты. </p>
            <p>В том случае, если получается что для одной ячейке полигональной сети соответствует несколько значений в таблице данных (например, для района, ограниченного координатами 51-52 с.ш. и 164-165 в.д. есть несколько станций с уловами лососей), то они объединяются в одно значение как среднее арифметическое.</p>
            <p>Для сохранения 1 листа или всех листов в формат dbf можно воспользоваться соответствующими пунктами в меню SeaSalmonCatch или стандартными средствами MS Excel (через меню Файл\Сохранить как… с последующим выбором типа файла, в который будут данные сохраняться).</p>
            <p>Теперь скажем несколько слов о подстановке dbf-файлов. Способов это сделать много, но мы предлагаем остановиться на следующем – автоматически присвоить имена dbf-файлов, сформированных нами в MS Excel, всем 5 файлам, созданным в ArcGIS при выполнении надстройки Fishnet. Для этого инициируем в меню SeaSalmonCatch пункт &quot;Распределение шейп-файлов&quot; и в 2 последовательно появляющихся в диалоговых окнах указываем:</p>
            <ol>
              <li>полный путь к папке (каталогу), в которой располагаются dbf-файлы;</li>
              <li>полный путь к папке (каталогу), в которой располагаются шейп-файлы. </li>
            </ol>
            <p>В результате работы данной процедуры в папке с dbf-файлами по их количеству и с их именами будут созданы каталоги, содержащие переименованные шейп-файлы с добавленными данными в dbf-файлы. Теперь шейп-файлы можно загружать в ArcGIS и проводить визуализацию. Пример итогового варианта распределения плотностей лососей:</p>
            <p align="center"><span><img src="/images/salmon-viz-04.gif" alt="результирующая карта" width="707" height="492" /></span></p>
            <p>Представленный выше алгоритм является альтернативной реализацией пространственной связи между двумя слоями или слоем и таблицей с данными (spatial join). Данный подход имеет свои преимущества при использовании в основном табличных данных в формате таблиц Excel.</p>
            <p class="discuss">
				<span><!--#include virtual="/scripts/forum-comments-num.php?i=1330"--></span>
			</p>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 30.12.2006
<br>
Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=7819" target="_blank">Сергей Марченко</a></span></p>
<!--#include virtual="/inc/footer2.php" -->