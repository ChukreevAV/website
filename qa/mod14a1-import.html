<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Импорт данных MOD14A1 в shape-формат</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Статьи</a></li>
</ul>
<!--Contents start-->
<h1>Импорт данных MOD14A1 в shape-формат </h1>
<p class="ann">Получение, конвертация, склейка и перепроецирование данных. </p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=7507"--></span></p>

<p>Эта статья описывает процесс подготовки к работе данных MOD14A1 (<a href="mod14a1.html">подробнее</a> про эти данные). Исходно эти данные распространяются в HDF, который нельзя назвать  удобным форматом для работы. Статья является синтезом других статей уже размещенных на нашем ресурсе, мы постараемся не дублировать информацию из них, а дать ссылки. Обратите внимание, что вам может быть не нужно  осуществлять импорт именно в shape-формат, это зависит от того, что вам нужно сделать с данными в дальнейшем. </p>
<p>Некоторое ПО использованное в этой статье не является свободно доступным. Многие этапы можно реализовать по другому. Исправления к процессу аналогичные по скорости и удобству всячески приветствуются. </p>
<p><strong>Оглавление</strong></p>
<ol>
	  <li><a href="#01">Получение данных </a></li>
	  <li><a href="#02">Конвертация в GeoTIFF </a></li>
      <li><a href="#shape">Конвертация в shape-формат</a> </li>
      <li><a href="#merge">Создание единого слоя </a></li>
      <li><a href="#project"> Перепроецирование в WGS84 Lat/Long </a></li>
</ol>

<!-- Первый раздел -->
<h2><strong><a name="01" id="01"></a></strong>1. Получение данных </h2>
<p>Для начала работы необходимо получить фрагменты (тайлы) MODIS на вашу территорию и временной промежуток. Данные в исходном формате HDF можно скачать <a href="mod14a1.html">здесь</a>. </p>
<!-- Второй раздел -->
<h2><strong><a name="02" id="02"></a></strong>2. Конвертация в GeoTIFF </h2>
<p>Подробно использование Modis Reprojection Tool (MRT) описано в статье: Импорт продуктов MODIS уровней 2G, 3, 4 с помощью MRT&quot; (<a href="modisimport.html">прочитать статью</a>).</p>
<p>Если используется MODIS Import Tool (<a href="modisimport-tool.html">прочитать описание</a>), то настройки программы должны быть следующими:</p>
<p>Проекция: Sinusoidal, исходные данные MOD14A1 хранятся именно в этой проекции и конвертация в нее, а не в более удобную сэкономит время на перепроецирование. В любом случае, перепроецировать в нужную проекцию удобнее будет окончательный векторный слой. </p>
<p>Разрешение: 1000 метров, исходное разрешение MOD14A1</p>
<p>Import/no import bands: первые 8 - единицы, остальные 0. Нам нужно импортировать только данные за 8 дней (допустим каналы с Quality Assessment пока не нужны, если нужны, то и их делаем 1). </p>
<p>Mosaic then Reproject: установите, если у вас несколько фрагментов (подробнее см. описание работы с MRT). </p>
<p align="center"><img src="../images/mod14a1-import-01.gif" alt="импорт" width="223" height="345"></p>
<p>Нажимаем Create Batch и дожидаемся сообщения об успешном окончании работы. После этого запускаем !process-bands.bat и дожидаемся окончания процесса импорта. Нормальный процесс импорта выглядит следующим образом: </p>
<p align="center"><img src="../images/mod14a1-import-02.gif" alt="импорт" width="677" height="342"></p>
<p>Количество отдельных растров генерируемых при импорте данных с 2000 по 2010 год составляет около 3950 растров. </p>
<h2><a name="shape"></a>3. Конвертация в shape-формат </h2>
<p>Результатом предыдущего этапа является много растровых файлов в формате GeoTIFF. Если вам нужны именно растры, на этом можно остановиться. Если нет, конвертируем данные в вектор.</p>
<p>Так как это требуется нашему конвертеру в вектор, сначала переименовываем все растры так, чтобы имена стали покороче, например по шаблону: [N9-16]_[N72]. Таким образом из названия MOD14A1.A2000065.H19V01.005.2006270190019_res.FireMask.Number_of_Days_04.tif, мы получим более лаконичное: A2000065_b4.tif</p>
<p>Примечание: иногда в исходных файлах HDF содержится меньше чем 8 каналов, в этом случае будут импортированы дополнительные каналы не являющиеся пожарными масками (QA, MaxFRP, sample). После окончания процесса конвертации их рекомендуется удалить. </p>
<p>После этого запускаем <a href="/programs/aml/image2poly-res-calc-shapes-fires.aml">скрипт</a> для Arcinfo Workstation. Этот скрипт делает следующее:</p>
<ol>
  <li>Конвертирует GeoTIFF в GRID</li>
  <li>Конвертирует GRID в COVERAGE</li>
  <li>Вытаскивает категории 8 и 9 (очаги пожаров с нормальной и повышенной достоверностью) в отдельные покрытия</li>
  <li>Конвертирует эти покрытия в shape-файлы</li>
  <li>Удаляет источники</li>
</ol>
<p>Подробнее про запуск, содержание и работу с подобными скриптами можно ознакомиться в статье &quot;Пакетный импорт растровых данных в GRID и их обработка с помощью Arcinfo Workstation&quot; (<a href="importraster-ai.html">прочитать</a>).</p>
<h2><a name="merge"></a>4. Создание единого слоя </h2>
<p>Для пакетного склеивания ежедневных shape-файлов удобно использовать расширение Merge Shapes из QGIS (<a href="merge-shapes.html">подробнее про расширение</a>). Склейка в данном случае осуществляется потайлово, но можно склеивать и все вместе. </p>
<p align="center">
  <!-- обсуждение на форуме, цифра изменяется при публикации статьи -->   
  <img src="../images/mod14a1-import-03.gif" alt="импорт" width="393" height="340"></p>
<h2><a name="project"></a>5. Перепроецирование в WGS84 Lat/Long </h2>
<p>Результирующие shape-файлы может понадобится перепроецировать из синусоидальной проекции в географическую систему координат WGS84. Можно делать это и на этапе импорта в GeoTIFF, но это не рекомендуется, так как займет во много раз больше времени чем перепроецировани уже отфильтрованного вектора. </p>
<p>Система координат растров после работы MRT следующая:</p>
<p align="center"><img src="../images/mod14a1-import-04.gif" alt="импорт" width="677" height="450"> </p>
<p>То есть используется Sinusoidal проекция на сфере радиусом 6370997 метров (цифра подтверждается MRT_Users_Manual.doc, стр. 57). В ArcGIS такая сфера соответствует сфере D_Sphere_ARC_INFO из папки Geographic Coordinate Systems\Spheroid based\. Соответственно для векторного файла PRJ файл будет выглядеть следующим образом:</p>
<pre>PROJCS["World_Sinusoidal",
     GEOGCS["GCS_Sphere_ARC_INFO",
           DATUM["D_Sphere_ARC_INFO",
                SPHEROID["Sphere_ARC_INFO",6370997.0,0.0]
           ],
           PRIMEM["Greenwich",0.0],
           UNIT["Degree",0.0174532925199433]
     ],
     PROJECTION["Sinusoidal"],
     PARAMETER["False_Easting",0.0],
     PARAMETER["False_Northing",0.0],
     PARAMETER["Central_Meridian",0.0],
     UNIT["Meter",1.0]
]</pre>
<p>Наложение растра только что импортированного MRT и границ субъектов РФ в Lat/Long WGS84 (<a href="rusbounds-rosreestr.html">источник</a>) в ArcGIS (трансформация WGS84 -&gt; Sinusoidal &quot;на лету&quot;) приводит к достаточно хорошему соответствию, то есть система координат растра верна:</p>
<p align="center"><img src="../images/mod14a1-import-05.gif" alt="импорт" width="638" height="504"> </p>
<p>Для перепроецировании растра или вектора в Lat/Long WGS84 используем:</p>
<pre>gdalwarp -s_srs &quot;+proj=sinu +R=6370997.0 +nadgrids=@null +wktext&quot; -t_srs EPSG:4326 A2000057_2.tif A2000057_2_wgs.tif</pre>
<p>или</p>
<pre>ogr2ogr -s_srs "+proj=sinu +R=6370997.0 +nadgrids=@null +wktext" -t_srs EPSG:4326 h19v02_wgs.shp h19v02.shp</pre>
<p>Стоит повторить, что это лишь один из возможных путей импорта данных в векторных формат, однако он работает. </p>
<p class="discuss"><span><!--#include virtual="/scripts/forum-comments-num.php?i=7507"--></span></p>
<!-- ссылки -->
<div class="links">
	<h2>Ссылки по теме</h2>
		<ul>
			<li><a href="mod14a1.html">Данные по тепловым аномалиям MOD14A1: описание и получение</a></li>
			</ul>
</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 21.03.2011<br>
Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=2" target="_blank">Максим Дубинин</a></span></p>
<!--#include virtual="/inc/footer2.php" -->
