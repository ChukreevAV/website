<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Конвертация файла привязки OZI Explorer в World-файл</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Конвертация файла привязки OZI Explorer в world-файл</h1>
<p class="ann">Аннотация</p>
<p>Дано: два файла,  файл изображения test.tif и файл привязки в формате Ozi Explorer test.map. Файл  изображения не содержит внедренных данных о географической привязке, в этом  можно убедиться, используя программу listgeo.</p>
<p>  Задача: Конвертировать  файл привязки в формате Ozi Explorer в <a href="/qa/tfw.html" target="_blank" class="external">стандартный world-файл</a>.</p>
<p>Допустим исходные данные представлены двумя файлами: test.tif и test.map </p>
<h2>1. Подготовка </h2>
<p>Создадим копию файла test.map  и переименуем его в test.csv </p>
<h2>2. Создание файла с координатами</h2>
<p>Отредактируем файл test.csv  при помощи любого текстового редактора, таким образом, чтобы в нем остались только строки  широты и долготы. </p>
<p> а) Сначала удалим все строки, не  содержащие координат точек, такого вида: </p>
<pre>Point01,xy,0,0,in,deg,43,58.7092215,N,40,2.00958252,E,grid,,,,N</pre>
<p>  Восемь таких строк,  подлежащих удалению, обычно есть в верхней части файла и большое количество в нижней  части.</p>
<p>б) Затем, оставим только часть с  координатами (при этом убрать пробелы между символами в них и заменить запятую  между данными широты и долготы на точку с запятой) в следующем виде: </p>
<pre>43,58.7092215;40,2.00958252</pre>
<p>  В конце должны остаться  только строки с этими параметрами.</p>
<p>  в) В начало файла добавим следующие  заголовки полей:</p>
<pre>latdeg,latmin;longdeg,longmin</pre>
<p>Между latdeg,latmin  и longdeg,longmin должен стоять символ точки с  запятой.</p>
<p>г) Сохраним полученный файл.</p>
<p>Начало результирующего файла будет  выглядеть следующим образом:</p>
<pre>latdeg,latmin;longdeg,longmin
43,58.7092215;40,2.00958252
43,58.7092215;40,2.545166016</pre>
<h2>3. Пересчет координат в формат dd.ddddd </h2>
<p>Так как сейчас координаты разделены на несколько столбцов в формате dd, mm.mmmmmm, необходимо их пересчитать в  понятный ГИС формат десятичных градусов dd.ddddddd. Для этого сделаем копию  файла test.csv и  дадим ему имя test-pereschet.csv, откроем его в программе Excel/Calc.</p>
<p>Необходимо произвести перерасчет в десятичную по следующим формулам: для  широты - latdeg+(latmin/60), для долготы - longdeg+(longmin/60).</p>
<p> а) Создадим рядом с существующими данными  следующие колонки </p>
<table border="0" cellspacing="0" cellpadding="0" width="632">
  <tr>
    <td>latdeg </td>
    <td>latmin</td>
    <td>60\</td>
    <td>latmin/60=</td>
    <td>lat</td>
    <td>longdeg</td>
    <td>longmin</td>
    <td>60</td>
    <td>longmin/60=</td>
    <td>long</td>
  </tr>
</table>
<p>б) Скопируем данные градуса поля широты  и занесем их в колонку latdeg<br>
  в) Заменим все точки в данных на запятые через Замену.<br>
  г) Скопируем данные минут и секунд поля  широты и занесем их в колонку latmin<br>
  д) Во всех ячейках колонки 60 поставим  60.                    <br>
  е) Поставим в ячейку latmin/60= знак  = и применим к данным в колонках latmin  и 60 формулу {latmin}/{60}.<br>
  ж) Поставим в ячейку lat знак равно и  применим формулу к данным в колонках latdeg  и latmin/60=  формулу {latdeg}+{latmin/60=}.<br>
  з) По той же самой системе произведем пересчет в десятичный  градус данных долготы.</p>
<p>4. Перенос широты и долготы в dd.ddddd в файл test.csv.</p>
<p> а) В файле test-pereschet.csv стираем все поля кроме  столбиков Lat и Long с  полученными десятичными градусами.<br>
  б) Сохраняем этот файл под именем test.csv (с заменой существующего).<br>
  в) Если необходимо, заменяем в данных (в текстовом  редакторе) запятые точками (Через Правка/  Заменить). <br>
  г) Если необходимо, заменяем разделитель полей Lat и Long  (в текстовом редакторе) – вместо точки с запятой везде ставим запятую  (через Правка/ Заменить).</p>
<p>Полученный файл  test.csv будет выглядеть следующим образом:</p>
<pre>lat,long
44.77172109,37.41685867
44.72380806,37.47076035
44.72380806,37.41685867
44.77172109,37.47076035
44.74776954,37.44380951
44.77172109,37.44380951
44.74776954,37.41685867
44.74776954,37.47076035
44.74047472,37.44380951</pre>
<p>Количество цифр после  точки не должно быть больше 9.</p>
<h2>5. Загрузка в Arcview</h2>
<p>а) Открываем новый проект Arcview.<br>
  б) Выделяем в менеджере проектов закладку Table.<br>
  в) Нажимаем кнопку Add.<br>
  г) Находим каталог, где лежит файл test.csv,  вводим в поле знак *(звездочка), после чего нажимаем Enter и файл test.csv становится  видимым, открываем его.</p>
<h2>6. Создание DBF-файла</h2>
<p>а) Сохраняем файл как test.dbf. Это необходимо, так как Arcview не умеет редактировать CSV таблицы. </p>
<h2>7. Перепроектирование </h2>
<p>а) Выделяем закладку View и  дважды щелкаем на ней или нажимаем на кнопку New – будет создан новый вид View1.<br>
  б) Добавляем  файл test.txt и  делаем из него тему с помощью View/Add Event Theme. <br>
  в) Включаем появившуюсь в TOC вида тему, должны появиться точки. <br>
  г)   Выделяем и задаем в свойствах View1 систему координат растра (View\Properties\Projection), в Category выбираем Projections of the World, а в Type выбираем Mercator. Устанавливаем проекцию через кнопку OK. Выходим из View\Properties. </p>
<h2>8. Добавление полей </h2>
<p>Добавим два поля в таблицу, в которых будут сохранены новые значения. Открываем  в виде View1 таблицу темы test.dbf и  добавляем в нее два новых поля –Y и X.</p>
<p>а) Выделяем тему test.dbf<br>
  б) Открываем таблицу темы test.dbf через Theme/Table.<br>
  в) Включаем редактирование таблицы (через Table/Start  Editing)<br>
  г) Добавляем поле Y <br>
  - Edit/Add Field/ <br>
  - Name - Y, Decimal Places - 5, Type и Width не  меняем.<br>
  - ОК.<br>
  д) Тем же образом добавляем поле X.</p>
<h2>9. Расчитываем координаты в новой системе координат </h2>
<p>В  полях Y и X расcчитаем спроектированные координаты точек, в системе  координат вида. <br>
  а) Выделяем поле Y<br>
  б) Выбираем Field/Calculate<br>
  в) Вставляем в поле [Y] формулу:</p>
<pre>[Shape].returnprojected(av.Finddoc(&quot;View1&quot;).Getprojection).gety</pre>
<p><br>
  г) Для поля X повторяем с другим выражением:</p>
<pre>[Shape].returnprojected(av.Finddoc(&quot;View1&quot;).Getprojection).getx</pre>
<p>  д) Сохраняем изменения в таблице через Table/Stop  Editing/Save Edits/OK<br>
  е) Экспортируем  полученную таблицу через File/Export/Delimited Text в текстовый файл Test.txt</p>
<p>10. Создаем файл регистрации (world-file) </p>
<p>В  папке где лежит космоснимок создаем новый файл с именем test.tfw.</p>
<p> а) В первой строке файла  test.tfw необходимо указать размер пикселя,  соответствующий уровню разрешения снимка  (допустим это 18-й уровень).  Если эти  данные были получены с Google нужно использовать следующие размеры в  зависимости от уровня разрешения, при котором они были получены:</p>
<pre>0 156367.865593911000
1 78183.932796955300
2 39091.966398477600
3 19545.983199238800
4 9772.991599619410
5 4886.495799809710
6 2443.247899904850
7 1221.623949952430
8 610.811974976213
9 305.405987488107
10 152.702993744053
11 76.351496872027
12 38.175748436013
13 19.087874218007
14 9.543937109003
15 4.771968554502
16 2.385984277251
17 1.192992138625
18 0.596496069313</pre>
<p>б) Во второй и третьей строке нужно указать:  0<br>
  в) В четвертой строке: данные первой строки  со знаком минус.<br>
  г) В пятой строке указываем расчетную  координату Х, которую берем из файла Test.txt – последнее значение в первой  строке с цифрами  в этом файле (координата X левого верхнего угла). <br>
  д) В шестой строке указываем расчетную  координату Y, которую берем из файла Test.txt – предпоследнее  значение в первой строке с цифрами в этом файле (координата Y левого верхнего угла). </p>
<p>Полученный в итоге файл Test.tfw должен  выглядеть примерно так:</p>
<pre>0.596496069313
0
0
-0.596496069313
4451519.22576
5455999.04661
</pre>
<p>е) Сохраняем и закрываем файл tfw. </p>
<h2>10. Сохраняем</h2>
<p>Сделаем  в программе ArcView добавление темы через View\Add event theme и укажем  отредактированную таблицу и соответствующие поля (lat и long, не x и y) – т.е.  ничего не меняем и нажмем ОК.</p>
<p>14) Загружаем  в программе ArcView через добавление темы в вид View1 (View/ Add Theme/ Image Data Source изображение test.tif с только что созданным файлом tfw (с этим ничего  делать не надо – он загружается автоматически, главное, файл с расширением tfw) должен иметь то же имя, что и файл снимка с  расширением tif, и лежать в той же папке)</p>
<p>15) Проверяем  корректно ли мы создали World-файл  привязки.<br>
  15.1         Ставим галочку на теме test.tif.</p>
<p>Если все сделано правильно,  изображение должно попасть в точки таким образом, что четыре точки будут  совпадать с углами изображения.<br>
  Результат всей нашей  работы – два файла test.tif (снимок) и test.tfw (файл привязки). Для автоматического распознавания системы координт, имя файлов должно быть одинаковым.</p>
<p class="ann"><span>
  <!--#include virtual="/scripts/forum-comments-num.php?i=852"-->
</span>		</p>
            

<div class="links">
				<h2>Ссылки по теме</h2>
					<ul>
						<li><a href="modislandprod.html">Ссылка на дополнительный источник информации внутренняя</a></li>
						<li><a href="http://lpdaac.usgs.gov/landdaac/tools/modis/about.asp" target="_blank" class="external">Ссылка на дополнительный источник информации внешняя</a></li>
					</ul>
			</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<!--#include virtual="/inc/footer2.php" -->
