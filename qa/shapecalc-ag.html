<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Получение основных пространственных характеристик объектов в ArcGIS</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Получение основных пространственных характеристик объектов в ArcGIS</h1>
<p class="ann">Расчеты координат, длин, площадей в таблицу через VBA.</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=875"--></span></p>
<p>В статье рассматривается получение нескольких основных
              пространственных характеристик объектов <b>без использования</b> дополнительных расширений (extensions), с использованием стандартных возможностей пакета ArcGIS.</p>
            <p>Примечание: Рассмотренные в статье возможности начиная с версии 9.2 также доступны через меню Calculate geometry. </p>
            <p>В данной статье рассматриваются следующие типы объектов и соответствующие им пространственные характеристики:</p>
            <table align="center" class="tabanno">
              <tr>
                <td><p>Тип объекта</p></td>
                <td><p>Пространственная характеристика </p></td>
                <td><p>&nbsp;</p></td>
              </tr>
              <tr>
                <td><p>Точка</p></td>
                <td><p>Координата X<br />
                    Координата Y </p></td>
                <td><p align="center"><a href="#point">перейти</a></p></td>
              </tr>
              <tr>
                <td><p>Линия</p></td>
                <td><p>Длина</p></td>
                <td><p align="center"><a href="#line">перейти</a></p></td>
              </tr>
              <tr>
                <td><p>Полигон</p></td>
                <td><p>Длина (периметр)<br />
                    Площадь<br />
                Центроид</p></td>
                <td><p align="center"><a href="#polygon">перейти</a></p></td>
              </tr>
            </table>
            <p>Те, кто пользовался или пользуется Mapinfo могут с недоумением отметить отсутствие в Arcview метода быстрого просмотра площади объекта или координат точки. Посмотреть основные пространственные характеристики объекта просто выбрав его в Arcview, ArcGIS в отличие от Mapinfo невозможно. Однако, несмотря на кажующееся неудобство, в этом есть своя логика.</p>
            <p>Дело в том, что визуальная
              оценка параметров объекта, является, по большому счету, довольно бессмысленной задачей. Более оптимально было бы заносить пространственные характеристики объектов непосредственно в атрибутивную таблицу. При желании
              можно также организовать постоянный мониторинг (обновление) пространственных характеристик объектов, так, как это делает, например, Arcinfo Workstation при работе со своим форматом. Это имеет смысл если вы выполняете серию пространственных
              операций изменяющих пространственные характеристики объектов и вам нужно следить за их изменениями.</p>
            <p>Пространственные характеристики объетов о которых идет речь - неотъемлимая часть их геометрии. В Arcview, ArcGIS получить геометрию объекта можно через специальное поле в таблице - Shape.</p>
            <p>При расчете пространственной характеристики важно помнить, что единицы измерения, по умолчанию, будут соответствовать исходным единицам измерения ваших данных. То есть:</p>
            <ul>
              <li> Если данные находятся в географической системе координат, то независимо от того, спроектирован вид или нет, получаемые значения площадей и т.д., по умолчанию, будут в десятичных градусах (что приемлемо для координат точек, но не приемлемо для длин и площадей).</li>
              <li> Если данные находятся в неизвестной системе координат и единицы измерения также неизвестны, то расчеты все равно могут быть произведены, однако единицы измерения также останутся неизвестными. </li>
            </ul>
            <p>Ниже будет продемонстрировано, как, используя набор данных в географической системе координат, находящихся в спроектированном виде, можно получить в атрибутивной таблице пространственные характеристики объектов в спроектированной системе координат (т.е. с учетом проекции вида). При таких вычислениях необходимо помнить, в какой системе координат находился вид при расчете пространственных характеристик.</p>
            <p>Итак, для занесения пространственной характеристики объекта (объектов), необходимо:</p>
            <p>1. Открыть таблицу нажав правой кнопкой на нужном слое, пространственные характеристики объектов которого нужно получить. Выбрать <strong>Open Attribute Table </strong></p>
            <p>2. Создать в ней поле(поля) нужного формата: целочисленного или с плавающей точкой (в зависимости от типа пространственной характеристики). <strong>Options\Add Field...</strong></p>
            <p>3. Вызвать инструмент ввода значений всем записям в таблице щелкнув правой кнопкой мыши на заголовке поля и
              выбрав <strong>Calculate Values...</strong></p>
            <p align="center"><img src="/images/shapecalc-04.gif" width="440" height="203" /></p>
            <p>4. В окне Field Calculator включить режим Advanced
              (Расширенный)</p>
            <p>5. В появившейся<span> области  Pre-logic VBA Script Code ввести</span> выражение-команду, которая обратится за пространственными характеристиками объекта к полю <b>shape</b>, содержащему геометрию объекта. </p>
            <p align="center"><span><img src="/images/shapecalc-05.gif" width="468" height="431" /></span> </p>
            <p><b>1. <a name="polygon" id="polygon"></a>Полигональный объект</b></p>
            <p><b>Площадь (Area)</b></p>
            <p>Выражение для получения данных в системе координат и единицах измерения самой темы. Данные как и вид могут в любой системе координат, получаемый результат НЕ будет зависеть от проекции вида:</p>
<pre>Dim Output as double
Dim pArea as IArea
Set pArea = [shape]
Output = pArea.area</pre>
            <p>Повторимся, что этот запрос неудобно использовать при работе со спроектированными видами, так как он (запрос) будет возвращать площадь, не учитывая проекцию вида (см. статью &quot;<a href="/qa/areacalc.html">Вычисление площади</a>&quot;). Однако если вы работаете с вектором уже находящимся в проекции, то это самый быстрый способ расчитать площади для полигонов.</p>
            <p>Для получения значения в метрах используя спроектированные на лету данные, исходно находящиеся в географической системе координат, необходимо модифицировать выражение следующим образом:</p>
<pre>Dim pMxDoc As IMxDocument
Set pMxDoc = ThisDocument
Dim pMap As IMap
Set pMap = pMxDoc.FocusMap
Dim pSR As ISpatialReference
Set pSR = pMap.SpatialReference
Dim pPolygon As IPolygon
Dim pArea as IArea
Set pPolygon = [Shape]
pPolygon.Project pSR
Set pArea = pPolygon
Output = pArea.area</pre>
            <p>В последней области ввода, в заголовке которой значится &quot;<b>area =&quot; </b>ввести <b>output</b></p>
            <p>где Area - название поля, где будет размещен результат вычисления (название поля может быть любым).</p>
            <p><b>Периметр</b></p>
            <p>Выражение для получения данных в системе координат и единицах измерения самой темы. Данные как и вид могут в любой системе координат, получаемый результат НЕ будет зависеть от проекции вида:</p>
<pre>Dim Output as double
Dim pCurve as ICurve
Set pCurve = [shape]
Output = pCurve.Length</pre>
            <p>Выражение для спроектированного вида (данные в географической системе координат, проекция вида - установлена): </p>
<pre>Dim pMxDoc As IMxDocument
Set pMxDoc = ThisDocument
Dim pMap As IMap
Set pMap = pMxDoc.FocusMap
Dim pSR As ISpatialReference
Set pSR = pMap.SpatialReference
Dim pCurve As ICurve
Set pCurve = [Shape]
pCurve.Project pSR
Output = pCurve.Length</pre>
            <p>В последней области ввода, в заголовке которой значится &quot;<b>perimeter =&quot; </b>ввести <b>output</b></p>
            <p>где Perimeter - название поля, где будет размещен результат вычисления (название поля может быть любым).</p>
            <p><b>Центроид (точка - центр масс полигона) </b></p>
            <p>Выражение для получения данных в системе координат и единицах измерения самой темы. Данные как и вид могут в любой системе координат, получаемый результат НЕ будет зависеть от проекции вида:</p>
<pre>Dim Output as double
Dim pArea as IArea
Set pArea = [shape]
Output = pArea.centroid.x</pre>
            <p>Выражение для спроектированного вида (данные в географической системе координат, проекция вида - установлена): </p>
<pre>Dim pMxDoc As IMxDocument
Set pMxDoc = ThisDocument
Dim pMap As IMap
Set pMap = pMxDoc.FocusMap
Dim pSR As ISpatialReference
Set pSR = pMap.SpatialReference
Dim pPolygon As IPolygon
Dim pArea as IArea
Set pPolygon = [Shape]
pPolygon.Project pSR
Set pArea = pPolygon
Output = pArea.centroid.x</pre>
            <p>В последней области ввода, в заголовке которой значится &quot;<b>centerx =</b>&quot; ввести <b>output</b>. Для получения координаты Y - заменить в последней строке x на y. </p>
            <p>Сenterx, centery- название предварительно созданных полей, где будут размещены результаты вычисления (название полей могут быть любыми).</p>
            <p><b>2. <a name="line" id="line"></a>Линейный объект:</b></p>
            <p><b>Длина</b></p>
            <p>Выражение для получения данных в системе координат и единицах измерения самой темы. Данные как и вид могут в любой системе координат, получаемый результат НЕ будет зависеть от проекции вида:</p>
<pre>Dim Output as double
Dim pCurve as ICurve
Set pCurve = [shape]
Output = pCurve.Length</pre>
            <p>Выражение для спроектированного вида (данные в географической системе координат, проекция вида - установлена): </p>
<pre>Dim pMxDoc As IMxDocument
Set pMxDoc = ThisDocument
Dim pMap As IMap
Set pMap = pMxDoc.FocusMap
Dim pSR As ISpatialReference
Set pSR = pMap.SpatialReference
Dim pCurve As ICurve
Set pCurve = [Shape]
pCurve.Project pSR
Output = pCurve.Length</pre>
            <p>В последней области ввода, в заголовке которой значится &quot;<b>length =&quot; </b>ввести <b>output</b></p>
            <p>где Length - название поля, где будет размещен результат вычисления (название поля может быть любым).</p>
            <p><b>3. <a name="point" id="point"></a>Точечный объект:</b></p>
            <p>Для получения координат точек, нужно создать 2 поля и ввести 2 выражения.</p>
            <p>Выражение для получения данных в системе координат и единицах измерения самой темы. Данные как и вид могут в любой системе координат, получаемый результат НЕ будет зависеть от проекции вида:</p>
            <p>Для долготы (longitude): </p>
            <p><b><img src="../images/shapecalc3.gif" width="351" height="323" align="right" /></b></p>
<pre>Dim pPoint As IPoint
Set pPoint = [Shape]
output = pPoint.x</pre>
            <p>В последней области ввода, в заголовке которой значится &quot;<b>lat =&quot; </b>ввести <b>output</b> </p>
            <p>Для широты (latitude):</p>
            <tcode>Dim pPoint As IPoint<br />
                    Set pPoint = [Shape]<br />
                    output = pPoint.y
                  </tcode>
            <p>В последней области ввода, в заголовке которой значится &quot;<b>lat =&quot; </b>ввести <b>output</b></p>
            <p>Выражение для спроектированного вида (данные в географической системе координат, проекция вида - установлена):</p>
<pre>Dim pMxDoc As IMxDocument
Set pMxDoc = ThisDocument
Dim pMap As IMap
Set pMap = pMxDoc.FocusMap
Dim pSR As ISpatialReference
Set pSR = pMap.SpatialReference
Dim pPoint As IPoint
Set pPoint = [Shape]
pPoint.Project pSR</pre>
            <p>В последнем поле, в заголовке которого значится <strong>&quot;</strong><b>long =&quot; </b>или <strong>&quot;</strong><b>lat =&quot;</b> ввести <b>pPoint.x</b> или <b>pPoint.y </b>соответственно.</p>
            <p>где Long, Lat - название полей, где будет размещен результат вычисления (название поля может быть любым).</p>
            <p>Для того, чтобы координаты в dd.dddddd разложить на ddmmss необходимо добавить в скрипт следующее выражение:</p>
            <pre>ff = pPoint.X
			
dd = Int(ff)
mm = Int((ff - dd) * 60)
ss = Round(ff * 3600 - dd * 3600 - mm * 60, 1)
sdd = Format(dd, "##")
If dd < 10 Then sdd = "0" + sdd
smm = Format(mm, "##")
If mm < 10 Then smm = "0" + smm
sss = Format(ss, "##.#")
If ss < 10 Then sss = "0" + sss
If Len(sss) = 3 Then sss = sss + "0"
DDD2DMS = sdd + "° " + smm + "' " + sss + "'</pre>
            <p>Поле куда записывается результат должно быть строковым, а в строке ff = pPoint.X ставим X или Y.</p>
            <h2>Заключение</h2>
            <p>Эти выражения являются реализацией запросов к пространственным данным на языке  VBA через инструмент Calculate. С помощью этого инструмента и модифицированных запросов можно
              получать и другие пространственные характеристики объекта(ов).</p>
            <p class="discuss">
				<span><!--#include virtual="/scripts/forum-comments-num.php?i=875"--></span>
			</p>
			<div class="links">
			<h2>Ссылки по теме</h2>
			<ul>
               <li><a href="/qa/shapecalc.html">Получение основных пространственных характеристик объектов в Arcview GIS</a></li>
			</ul>
			</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 20.02.2006
<br>Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=2" target="_blank">Максим Дубинин</a></span></p>
<!--#include virtual="/inc/footer2.php" -->
