<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Сборка PostgreSQL + PostGIS + WKT Raster для Windows</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Сборка PostgreSQL + PostGIS + WKT Raster для Windows</h1>
<p class="ann">Краткое описание действий по установке "с нуля".</p>
            <p>Руководство содержит пошаговые инструкции по сборке связки PostgreSQL + PostGIS +
			WKT Raster в системе Windows XP "с нуля".</p>
			<p>При описании действий предполагается, что MinGW и MSYS установлены в каталоги,
			предлагаемые по умолчанию (C:\MinGW и C:\MSYS\1.0 соответственно), а исходные тексты
			располагаются на диске D:\ в подкаталогах папки src (например, D:\src\libtool-2.2).</p>
            <p><strong>Оглавление</strong></p>
            <ol>
                  <li><a href="#mingw">Установка MinGW</a></li>
                  <li><a href="#msys">Установка MSYS</a></li>
                  <li><a href="#gnuwin32">Дополнительные пакеты GnuWin32</a></li>
                  <li><a href="#m4">Макропроцессор m4</a></li>
                  <li><a href="#envvars">Переменные окружения</a></li>
                  <li><a href="#autotools">Пакет autotools</a></li>
                  <li><a href="#pgsql">Собираем PostgeSQL</a></li>
                  <li><a href="#geos">Собираем GEOS</a></li>
                  <li><a href="#proj">Собираем Proj</a></li>
                  <li><a href="#postgis">Собираем PostGIS</a></li>
                  <li><a href="#wkt">Собираем WKT Raster</a></li>
                  <li><a href="#usage">Настройка и использование</a></li>
            </ol>


            <h2>
              <!-- Первый раздел -->
              <a name="mingw" id="mingw"></a>1. Установка MinGW</h2>
            <p>MinGW (Minimalist GNU for Windows, бывший mingw32) - порт компилятора GNU Compiler Collection
		(GCC) для Microsoft Windows включающий набор свободных библиотек и заголовочных файлов для
		Windows API. MinGW позволят разработчикам создавать приложения Microsoft Windows.
		В MinGW включены расширения для Microsoft Visual C++ runtime library поддерживающие C99
		(современный диалект C).</p>
		<p><a href="http://sourceforge.net/project/showfiles.php?group_id=2435">Скачайте</a> MinGW Installer
		(текущая версия 5.1.4). Не удивляетесь малому размеру полученного файла - это онлайн-установщик,
		размер полной установки составит около 170 Мб.</p>
		<ol>
			<li>запустите установку</li>
			<li>выберите пункт "Download and Install"</li>
			<li>когда дойдете до выбора компонент - выбирайте все, кроме Ады. Хотя Аду тоже можно
			установить, вреда не будет</li>
		</ol>
		<p>Устанавливать лучше в каталог предлагаемый по умолчанию (C:\MinGW). В дальнейшем будем
		предполагать, что MinGW установлен именно так.</p>
        <h2><a name="msys" id="msys"></a>2. Установка MSYS</h2>
        <p>MSYS (Minimal SYStem). Предоставляет пользователю POSIX-совместимую среду и набор консольных
		утилит, использующихся при сборке UNIX-программ. Изначально MSYS была разработана чтобы сделать
		возможным выполнение скриптов конфигурации и сборки (Makefiles), используемых при компиляции
		ПО с открытым кодом. Позже многие стали использовать ее как альтернативу интерфейсу командной
		строки Windows cmd.exe.</p>
		<h3>2.1 MSYS</h3>
		<p>Загрузить Msys Installer можно <a href="http://sourceforge.net/projects/mingw/files/MSYS%20Base%20System/Previous%20Release%20-%20msys-1.0.10/MSYS-1.0.10.exe/download">здесь</a>.		</p>
		<ol>
			<li>запускаем установку и следуем указаниям мастера</li>
			<li>каталог назначения (C:\msys\1.0) оставляем без изменений</li>
			<li>после установки появится окно с предложением провести послеустановочную настройку - соглашаемся</li>
			<li>на вопрос о наличии MinGW отвечаем положительно</li>
			<li>указываем каталог MinGW (если вы не меняли предлагаемые по умолчанию пути, пишите c:/mingw)</li>
		</ol>
		<h3>2.2 MSYS DTK</h3>
		<p>Далее скачиваем и устанавливаем стабильную сборку <a href="http://downloads.sourceforge.net/mingw/msysDTK-1.0.1.exe">MSYS Development Toolkit</a>. Установка не должна вызвать вопросов, просто следуем указаниям мастера.</p>
		<h3>2.3 MSYS Core</h3>
		<p>Кроме того, нужно скачать пакет <a href="http://downloads.sourceforge.net/mingw/msysCORE-1.0.11-2007.01.19-1.tar.bz2">MSYS Core 1.0.11</a>. Архив распаковываем в c:\msys\1.0 с заменой файлов.</p>
        <h2><a name="gnuwin32" id="gnuwin32"></a>3. Дополнительные пакеты GnuWin32</h2>
        <p>Полный перечень пакетов можно посмотреть на странице <a href="http://gnuwin32.sourceforge.net/packages.html">gnuwin32.sourceforge.net/packages.html</a>. Нам же для успешной компиляции необходимо скачать и
		установить только</p>
		<ul>
			<li><a href="http://kent.dl.sourceforge.net/sourceforge/gnuwin32/bison-2.1.exe">Bison</a>
			- парсер-генератор общего назначения, конвертирующий аннотированное контекстно-независимое
			описание в LALR- или GLR-парсер этого описания. Bison может использоваться для широкого
			круга языковых парсеров, начиная с простых для настольных калькуляторов и заканчивая
			языками программирования</li>
			<li><a href="http://kent.dl.sourceforge.net/sourceforge/gnuwin32/zlib-1.2.3.exe">zlib</a>
			- свободно распространяемая, zip-совместимая библиотека компрессии общего назначения</li>
			<li><a href="http://kent.dl.sourceforge.net/sourceforge/gnuwin32/flex-2.5.4a-1.exe">Flex</a>
			- быстрый лексический анализатор-генератор. Flex является инструментом для разработки
			программ осуществляющих поиск по шаблонам текста. Существует множество применений Flex,
			включая написание компиляторов совместно с Bison</li>
			<li><a href="http://kent.dl.sourceforge.net/sourceforge/gnuwin32/gettext-0.14.4.exe">GetText</a>
			- набор инструментов для облегчения интернационализации приложений</li>
			<li><a href="http://kent.dl.sourceforge.net/sourceforge/gnuwin32/libiconv-1.9.2-1.exe">libiconv</a>
			- библиотека обеспечивающая конвертацию текстов в различные кодировки.</li>
		</ul>
		<p>При установке этих пакетов в качестве каталога назначения указываем C:\MinGW.</p>
		<p><strong>Замечание</strong>: авторы англоязычной инструкции по компиляции PostGIS рекомендуют
		не ставить бинарный пакет, а собирать libiconv из исходников. Однако никаких проблем при
		использовании бинарного пакета я не заметил. Если есть желание - можете скачать <a href="http://ftp.gnu.org/gnu/libiconv">исходники</a>
		этой библиотеки (я брал версию 1.13.1), распаковать во временную папку (например, D:\src\libiconv-1.13.1)
		и собрать ее самостоятельно. Для этого</p>
		<ol>
			<li>открываем консоль MSYS используя ярлык на рабочем столе или пункт в меню "Пуск"</li>
			<li>последовательно вводим команды, завершая каждую из них нажатием клавиши Enter</li>
			<li><pre>cd /d/src/libiconv-1.13.1</pre></li>
			<li><pre>./configure --prefix=/c/mingw &amp;&amp; make &amp;&amp; make install</pre></li>
		</ol>

<!-- Четвертый раздел -->
            <h2><strong><a name="m4" id="m4"></a></strong>4. Макропроцессор m4</h2>
            <p>Как показала практика, макропроцессор из состава MSYS довольно старый. Для успешной сборки
		его необходимо обновить. Поэтому скачиваем <a href="http://downloads.sourceforge.net/mingw/m4-1.4.7-MSYS.tar.bz2">m4-1.4.7-MSYS.tar.bz2</a>,
		распаковываем архив в папку исходников и копируем файл m4.exe в C:\msys\1.0\bin.</p>

<!-- Пятый раздел -->
            <h2><strong><a name="envvars" id="envvars"></a></strong>5. Переменные окружения</h2>
            <p>Чтобы командный интерпретатор знал где искать инструменты из состава MinGW и/или GnuWin32,
		необходимо обновить переменные окружения. Процедура эта не обязательная и направлена
		исключительно на повышение удобства работы.</p>
		<ol>
			<li>кликните правой кнопкой мыши по значку "Мой компьютер" и выберите "Свойства"</li>
			<li>откройте вкладку "Дополнительно", нажмите кнопку "Переменные среды"</li>
			<li>в списке "Системные переменные" найдите строку PATH и двойным щелчком на ней начните
			редактирование</li>
			<li>появится диалоговое окошко с двумя поля ввода, в нижнем поле содержится значение
			переменной. Будьте осторожны, не удаляйте существующие записи. Перейдите в конец строки
			и добавьте ;C:\MinGW\bin. Не забудьте начальную точку с запятой - она там не для красоты
			стоит. После окончания редактирования нажмите Ok</li>
			<li>создайте переменную HOME. Для этого нажмите на кнопку "Создать", в верхнее поле
			введите HOME, а в нижнее - C:\msys\1.0\home</li>
			<li>закройте все окна последовательно нажимая Ok</li>
		</ol>

<!-- Шестой раздел -->
            <h2><strong><a name="autotools" id="autotools"></a></strong>6. Пакет autotools</h2>
            <p>Широко используется разработчиками и включает в себя autoconf, automake и libtool. Выкачиваем
		исходники с сервера gnu.org</p>
		<ul>
			<li><a href="http://ftp.gnu.org/gnu/autoconf">autoconf 2.63</a></li>
			<li><a href="http://ftp.gnu.org/gnu/automake">automake 1.9</a></li>
			<li><a href="http://ftp.gnu.org/gnu/libtool">libtool 2.2</a></li>
		</ul>
		<p>Архивы распаковываем в каталог исходных текстов, каждый в отдельную папку. Запускаем консоль
		MSYS, если она еще не запущена, и по очереди собираем</p>
		<ol>
			<li><pre>cd /d/src/autoconf-2.63</pre></li>
			<li><pre>configure --prefix=/c/mingw &amp;&amp; make &amp;&amp; make install</pre></li>
			<li><pre>cd /d/src/automake-1.9</pre></li>
			<li><pre>configure --prefix=/c/mingw &amp;&amp; make &amp;&amp; make install</pre></li>
			<li><pre>cd /d/src/libtool-2.2</pre></li>
			<li><pre>configure --prefix=/c/mingw &amp;&amp; make &amp;&amp; make install</pre></li>
		</ol>

<!-- Седьмой раздел -->
            <h2><strong><a name="pgsql" id="pgsql"></a></strong>7. Собираем PostgeSQL</h2>
            <p>Скачиваем исходные тексты последней стабильной версии PostgreSQL с <a href="http://www.postgresql.org/ftp/source/">http://www.postgresql.org/ftp/source/</a>. Распаковав архив в d:\src\postrgesql, обнаружим в нем три папки: backend,
		postgresql-8.3.7 и src. Для успешной компиляции необходимо из папки D:\src\postgresql\backend\utils\mb\conversion_procs\euc_jis_2004_and_shift_jis_2004\ перенести
единственный лежащий там файл в D:\src\postgresql\postgresql-8.3.7\src\backend\utils\mb\conversion_procs\euc_jis_2004_and_shift_jis_2004\. Таким же образом поступаем и с папкой src: переносим файлы из D:\src\postgresql\src\backend\utils\mb\conversion_procs\utf8_and_shift_jis_2004\ в D:\src\postgresql\postgresql-8.3.7\src\backend\utils\mb\conversion_procs\utf8_and_shift_jis_2004\.
Теперь можно компилировать. Запускаем MSYS и выполняем</p>
<pre>cd /d/src/postgresql/postgresql-8.3.7
./configure --prefix=/c/postgres &amp;&amp; make &amp;&amp; make install</pre>
		<p>По окончанию процесса PostgreSQL будет находиться в c:\postgres.</p>

<!-- Восьмой раздел -->
            <h2><strong><a name="geos" id="geos"></a></strong>8. Собираем GEOS</h2>
            <p>GEOS (Geometry Engine - Open Source) - порт на язык C++ пакета топологии Java - Java
		Topology Suite (JTS). GEOS предоставляет доступ к функциональности JTS с помощью C++. Это
		включает пространственные функции операторы определенные спецификацией OpenGIS Simple
		Features для SQL, а также специфические функции работы с топологией JTS.</p>
		<p>Скачиваем последнюю версию GEOS с сервера <a href="http://download.osgeo.org/geos/geos-3.1.1.tar.bz2">trac.osgeo.org/geos/</a>,
		и разворачиваем архив в каталог исходных текстов. В консоли MSYS переходим в созданный каталог
		и выполняем</p>
		<pre>cd /d/src/geos-3.1.0
configure --prefix=/c/postgres &amp;&amp; make &amp;&amp; make install</pre>
		<p>При желании можно удалить отладочную информацию из скомпилированной библиотеки командой</p>
		<pre>strip /c/postgres/bin/libgeos-3-1-1.dll</pre>

<!-- Девятый раздел -->
            <h2><strong><a name="proj" id="proj"></a></strong>9. Собираем Proj</h2>
            <p>Proj - свободная библиотека и набор инструментов, являющихся де-факто стандартом в области
		трансформации координат и проекционных преобразований</p>
		<p>Последнюю версию proj можно взять <a href="http://download.osgeo.org/proj/proj-4.6.1.zip">здесь</a>.
		Получив архив, выполняем уже знакомую последовательность действий: извлекаем файлы из архива,
		переходим в каталог с иходниками и компилируем</p>
		<pre>cd /d/src/proj-4.6.1
configure --prefix=/c/postgres &amp;&amp; make &amp;&amp; make install</pre>

<!-- Десятый раздел -->
            <h2><strong><a name="postgis" id="postgis"></a></strong>10. Собираем PostGIS</h2>
            <p>Компилировать будем версию из svn, графическую оболочку для shp2pgsql собирать не будем.
		Загружаем архив <a href="http://postgis.refractions.net/download/postgis-1.4.0SVN.tar.gz">PostGIS-1.4.0SVN.tar.gz</a>, распаковываем его содержимое в каталог
		исходных текстов, открываем консоль MSYS и выполняем</p>
		<pre>cd /d/src/postgis-1.4.0SVN
configure --prefix=/c/postgres --with-pgconfig=/c/postgres/bin/pg_config --with-geosconfig=/c/postgres/bin/geos-config --with-projdir=/c/postgres
make &amp;&amp; make install
		</pre>
<!-- Одиннадцатый раздел -->
            <h2><strong><a name="wkt" id="wkt"></a></strong>11. Собираем WKT Raster</h2>
            <p>Скачиваем <a href="http://postgis.refractions.net/download/wktraster-0.1.6SVN.tar.gz">архив</a> с последней svn версией, распаковываем в D:\src\wktraster-0.1.6SVN,
		открываем окно MSYS и выполняем</p>
		<pre>cd /d/src/wktraster-0.1.6SVN
./configure --with-postgis-sources=/d/src/postgis-1.4.0SVN --with-pgconfig=/c/postgres/bin/pg_config --with-geosconfig=/c/postgres/bin/geos-config
make &amp;&amp; make install
		</pre>

<!-- Двенадцатый раздел -->
            <h2><strong><a name="usage" id="usage"></a></strong>12. Настройка и использование</h2>
            <p>Самое сложное позади, осталось скопировать все dll файлы из папки c:\postgres\lib в
		c:\postgres\bin, добавить c:\postgres\bin в переменную PATH и можно приступать к настройке
		сервера.</p>
		<p>Прежде всего необходимо создать пользователя, от имени которого будет стартовать сервер
		PostgreSQL. Правой кнопкой мыши щелкаем по значку "Мой компьютер", выбираем "Управление",
		открываем раздел "Служебные программы-Локальные пользователи и группы-Пользователи". Создаем
		пользователя postgres и задаем ему пароль.</p>
		<p>Открываем командную строку Windows "Пуск-Выполнить" в окне вводим текст
		<pre>runas /user:postgres cmd.exe</pre>
		и дальнейшие действия выполняем в открывшемся окне консоли.</p>
		<ol>
			<li>инициализируем каталог баз данных (кодировку и путь указывайте по своему усмотрению)
			<pre>initdb -E win1251 -D:\pg_data</pre>
			</li>
			<li>запускаем сервер
			<pre>postmaster -D:\pg_data</pre>
			После старта он откроется в отдельном окне
			</li>
			<li>создаем базу данных postgis
			<pre>createdb -U postgres postgis</pre>
			</li>
			<li>включаем поддержку процедурного языка PL/pgSQL
			<pre>createlang plpgsql -U postgres -D:\pg_data</pre>
			</li>
			<li>загружаем функции и объекты, необходимые для работы с пространственными данными
			<pre>psql -а c:\postgres\share\contrib\postgis.sql -U postgres -d postgis</pre>
			</li>
			<li>загружаем описания систем координат
			<pre>psql -а c:\postgres\share\contrib\spatial_ref_sys.sql -U postgres -d postgis</pre>
			</li>
			<li>загружаем функции и объекты, необходимые для работы растровыми данными
			<pre>psql -а c:\postgres\share\contrib\rtpostgis.sql -U postgres -d postgis</pre>
			</li>
		</ol>
		<p>Остановить сервер можно выполнив от имени пользователя postgres
		<pre>pg_ctl.exe stop -D D:\pg_data</pre></p>
		<p>При желании можно настроить запуск сервера в качестве службы. Для этого</p>
		<ol>
			<li>останавливаем сервер, если он запущен
			<pre>pg_ctl.exe stop -D D:\pg_data<pre></li>
			<li>регистрируем службу
			<pre>pg_ctl.exe register -N "PostgreSQL_8.3.7" -U postgres -D:\pg_data<pre></li>
			<li>правой кнопкой мыши щелкаем по значку "Мой компьютер", выбираем "Управление",
			открываем раздел "Службы и приложения-Службы", двойным кликом по названию только что
			созданной службы открываем ее свойства, закладка "Вход в систему"</li>
			<li>задаем имя пользователя ".\postgres" (без кавычек)</li>
			<li>в окне ввода пароля указываем правильный пароль, жмем применить</li>
			<li>получаем сообщение, что пользователю postgres разрешен вход в качестве службы,
			закрываем окно свойств и стартуем службу</li>
		</ol>
		<p>Созданная в процессе сборки среда MSYS/MinGW может использоваться и в дальнейшем, например,
		при обновлении или для сборки другого ПО. Если же вы не планируете еще что-либо собирать или
		обновляться по мере выхода новых версий - можно смело удалить каталоги d:\src, c:\MinGW и
		c:\MSYS, для функционирования собранных нами компонент они уже не нужны.</p>

        <!-- Конец текста статьи, начало ссылок -->
        <p class="discuss">
		   <span><!--#include virtual="/scripts/forum-comments-num.php?i=3760"--></span>
		</p>
            <div class="links">
				<h2>Ссылки по теме</h2>
					<ul>
						<li><a href="http://trac.osgeo.org/postgis/wiki/UsersWikiWinCompile" target="_blank" class="external">Compiling PostGIS under Windows using MinGW/Msys</a></li>
						<li><a href="http://trac.osgeo.org/postgis/wiki/UsersWikiWinCompileWithgui" target="_blank" class="external">Install GTK and PostGIS 1.4 with GUI</a></li>
						<li><a href="http://trac.osgeo.org/postgis/wiki/WKTRaster/Documentation01" target="_blank" class="external">PostGIS WKT Raster Beta 0.1.6 Documentation</a></li>
						<li><a href="http://mateusz.loskot.net/2009/06/03/crunching-overviews/" target="_blank" class="external">Mateusz Loskot: Crunching overviews</a></li>
						<li><a href="http://gis-lab.info/docs/postgis/manual" target="_blank" class="external">Руководство пользователя PostGIS 1.3.4</a></li>
						<li><a href="http://gis-lab.info/qa/postgis-install.html" target="_blank" class="external">Установка PostgreSQL/PostGIS для Windows</a></li>
						<li><a href="http://gis-lab.info/qa/postgis-work.html" target="_blank" class="external">Основы работы с PostGIS</a></li>
					</ul>
			</div>
			<!--#include virtual="/scripts/date.php" -->
<!--Contents end-->
<!--#include virtual="/inc/footer2.php" -->
