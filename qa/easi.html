<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Основы макроязыка EASI (PCI Geomatica)</title>
<!--#include virtual="/inc/header2.txt" -->
	      <!--Contents start-->
		  <div class="cont">
		  <div class="col1">

		  <ul class="path">
		     <li class="first"><a href="/">Главная</a></li>
		     <li><a href="/qa.html">Вопросы и ответы</a></li>
		  </ul>
	      <h1>Основы макроязыка EASI (PCI Geomatica)</h1>
                    <p class="ann">Приводится краткое описание и основные команды языка по работе с растровыми данными</p>
                    <p><strong>Содержание</strong></p>
                    <ul>
                        <li><a href="#intro">Введение</a></li>
                      <li><a href="#begin">Начало работы с  языком EASI</a></li>
                      <li><a href="#basics">Основы создания скриптов</a></li>
                      <li><a href="#pcidsk">Особенности работы с файлами PCIDSK</a></li>
                      <li><a href="#createfiles">Команды создания файлов</a></li>
                      <li><a href="#import">Команды импорта/экспорта растровых данных</a></li>
                      <li><a href="#adddelete">Команды удаления/добавления каналов и сегментов</a></li>
                      <li><a href="#exchange">Команды обмена данными между файлами PCIDSK</a></li>
                      <li><a href="#struct">Команды чтения информации о структуре фалов PCIDSK</a></li>
                    </ul>
                    <p><strong><a name="intro" id="intro"></a>Введение</strong></p>
                    <p>Критерии практической ценности различных систем обработки  дистанционных данных постоянно меняются, особенно в России. Еще несколько лет  назад основным критерием выбора был набор функциональных возможностей и  алгоритмов обработки данных. Однако в последние годы две тенденции: усиление  контроля за лицензированием  ПО и  лавинообразный рост количества доступных данных требуют изменить сложившиеся  представления. Возможно, специалистам, ранее пользовавшимся дорогими (но не  лицензированными) системами «высшего уровня», типа ERDAS Imagine, следует подумать о  приобретении легальных копий более дешевых систем, а вместо ориентации на  индивидуальную обработку снимков, возможно, стоит подумать об автоматизации  процесса обработки. </p>
                    <p>Одной из достаточно дешевых полнофункциональных систем  обработки изображения является канадская   PCI Geomatica  (<a href="http://www.pcigeomatics.com/" target="_blank" class="external">http://www.pcigeomatics.com</a>). Пользователям продуктов ESRI и ERDAS  интерфейс программы может не понравиться своей необычностью и небольшим набором  встроенных функций. Однако именно опора на использование языка командной строки в Geomatica делает  автоматизацию процессов чрезвычайно простой. Большинство операций обработки данных осуществляются с  использованием инструмента моделирования (Modeler)  и встроенного макроязыка EASI.  Дополнительный плюс языка EASI –  возможность запуска интерпретатора из командной строки с именем фала скрипта в  качестве параметра (easi r myscript.eas). Это позволяет с  легкостью создавать длинные цепочки операций, в которых скрипты EASI могут создаваться и  запускаться из других оболочек (<a href="/qa/perl.html">из, например, PERL</a>).  Geomatica поставляется как для ОС Windows, так и для Linux, что позволяет использовать ее на мощных серверах обработки  данных.</p>
                    <p>В данной статье рассмотрены особенности работы с языком EASI и  приведено описание основных команд по созданию и управлению данными. В  следующих статьях мы остановимся на анализе данных, работе с проекциями и возможностях  автоматизации работы.</p>
                    <p><strong><a name="begin" id="begin"></a>Начало работы с  языком EASI</strong></p>
                    <p>Запуск и правила использования команд в языке EASI чрезвычайно  простые. Интерпретатор запускается как из оболочки (панель задач Geomatica) так и из командной  строки. Мы предлагаем по возможности использовать второй путь, не загромождая  память компьютера интерфейсом оболочки системы. Итак, из рабочей директории  набираем:</p>
                    <pre>easi</pre>
                    <p> Первое сообщение при запуске EASI из новой директории «отсутствует  файл параметров!» Чтобы скопировать файл параметров в рабочую директорию,  набираем</p>
                    <pre>r copprm</pre>
                    <p>В рабочей директории будет создан файл параметров PRM.PRM.</p>
                    <p>Собственно, теперь можно выполнять команды. Для выполнения команд могут используются три ключа, добавляемых перед именем команды: </p>
                    <ul>
                        <li>h (help) – вызов справки о команде</li>
                      <li>s (status) – вызов списка параметров команды</li>
                      <li>r (run) – запуск команды на выполнение </li>
                    </ul>
                    <p>Параметры команд вводятся до их запуска. Например:</p>
                    <p> file=”new – имя файла «new.pix» (расширение собственных файлов PCI можно опускать всегда,  когда нет файлов других типов но с тем же именем в той же директории)<br />
                      dbsz=10,10  – размер файла 10х10 пикселей<br />
                      dbnc=1,0,0,0  – один 8-битный канал <br />
                      dblayout=”file – разделять каналы по  отдельным файлам</p>
                    <p>Теперь запустим команду. Она будет использовать  параметры, введенные заранее.</p>
                    <pre>r cim</pre>
                    <p>Следует обратить внимание, что значения параметров сохраняются в созданном файле параметров PRM.PRM. Это может сильно сэкономить время для ввода параметров к последующим командам. Однако всегда будьте внимательны и проверяете значения параметров перед запуском команд. Для этого набираем:</p>
                    <pre>s cim</pre>
                    <p>На экран будут выведены параметры команды и их значения. </p>
                    <p>Для выхода из интерпретатора наберите exit. </p>
                    <p><strong><a name="basics" id="basics"></a>Основы создания скриптов</strong></p>
                    <p>Скрипты представляют собой последовательность параметров и команд языка – в точности так же, как они вводились бы в командной строке. В начале скрипта полезно вставлять «r copprm» на случай, если вы запускаете скрипт в новой директории. Скрипт EASI имеет расширение .eas. Например: myscript.eas. Содержание скрипта может быть следующим:</p>
                    <pre>file=”new
dbsz=10,10
dbnc=1,0,0,0
dblayout=”file
r cim</pre>
                    <p>Никаких специальных команд начала и завершения скрипта не используется. </p>
                    <p>Запуск скрипта из среды интерпретатора выглядит как запуск команды:</p>
                    <pre>r “myscript.eas</pre>
                    <p>В среде Windows можно опустить кавычки и расширение:</p>
                    <pre>r myscript</pre>
                    <p>Запуск из командной строки (или из среды другой программы) выглядит так: </p>
                    <pre>easi r myscript</pre>
                    <p>Подробнее на использовании скриптов и специальных функций языка в скриптах мы остановимся в специально статье.</p>
                    <p><strong><a name="pcidsk" id="pcidsk"></a>Особенности работы с файлами PCIDSK</strong></p>
                    <p>Работать с данными в PCI Geomatica удобнее, используя собственный стандарт данных PCIDSK. Файлы PCIDSK включают в себя собственно  растровые изображения (каналы, raster layers, image channels) и дополнительные данные  в виде сегментов (segments). </p>
                    <p>Каналы характеризуются радиометрическим разрешением (8 bit, 16 bit unsigned, 16 bit signed, 32 bit real). В одном файле могут  содержаться каналы с разным радиометрическим разрешением (сравните с системой ERDAS Imagine). В файле данных  каналы могут храниться в основном файле с расширением .pix или во внешних файлах, имеющих то же  имя и расширение .001, .002 и т.д. Если каналы хранятся в одном файле, то  возможны два варианта хранения каналов: разбивка по пикселям (формате BIP) или разбивка по каналам (формат BSQ).  Следует заметить, что при хранении каналов в одном файле могут возникать сбои  при попытках создания или удаления каналов. Мы советуем всегда использовать внешние  файлы для хранения каналов.</p>
                    <p>Сегменты хранятся в основном файле с расширением .pix. Сегменты отличаются  порядковыми номерами (нумерация сегментов непрерывная) и трехбуквенными кодами,  обозначающими тип сегмента (трехбуквенные коды эквивалентны численным кодам,  которые используют некоторые команды). И каналы, и сегменты имеют текстовые  метки имени и описания. Существую следующие типы сегментов:</p>
                    <ul>
                        <li>Georeferencing [Type 150:GEO]  Этот тип сегментов хранит информацию о привязке и проекции изображения. Сегмент №1 всегда является сегментом привязки. Однако могут быть созданы и дополнительные сегменты, которые могут включать информацию о проекциях, в которые будет трансформировано изображение.</li>
                      <li>Bitmaps [Type 101:BIT]  Растровые маски имеют такое же пространственное разрешение и привязку, что и каналы изображения, однако имеют значения только 1 и 0 (аналогичны 1-битному изображению в ERDAS Imagine). Это один из наиболее часто используемых типов сегментов.</li>
                      <li>Vectors [Type 116:VEC] Сегменты, содержащие векторные данные. Подразумевается, что проекция векторных сегментов совпадает с проекцией растровых каналов. </li>
                    </ul>
                    <p>Дополнительные типы сегментов: </p>
                    <ul>
                        <li>Signatures [Type 121:SIG]  Спектральные сигнатуры классов для классификации.</li>
                      <li>Look up Table [Type 170:LUT]  Таблицы радиометрической коррекции.</li>
                      <li>Pseudo-Colour Table [Type 171:PCT] Таблицы кодирования цветов.</li>
                      <li>Ground Control Points [Type 214:GCP]  Наборы точек привязки.</li>
                      <li>Text [Type 140:TEX] Текстовые примечания. </li>
                    </ul>
                    <p>Файл PCIDSK  с каналами, разделенными по отдельным файлам (в данном случае 3 канала), выглядит следующим образом:
                      <pre>myfile.pix
myfile.001
myfile.002
myfile.003</pre>
                      Для обработки все файлы с одним именем должны храниться в  одной директории. Файлы каналов, «оторванные» от основного файла, могут быть  импортированы в PCI,  если известна структура данных и привязка. Основной файл с расширением .pix может быть использован  для операций над сегментами даже в случае отсутствия файлов каналов.</p>
                    <p><strong><a name="createfiles" id="createfiles"></a>Команды создания файлов</strong></p>
                    <p><strong>CIM</strong> – создание файла PCIDSK</p>
                    <p> Использование:<br />
                      file=&quot; имя файла<br />
                      dbsz= размер файла в пикселях (x,y)<br />
                      dbnc= число каналов каждого типа 8U,16S,16U,32R<br />
                      dblayout= тип хранения каналов в файле pixel/band/file</p>
                    <p>Пример:<br />
                      file=”new (расширение можно  опустить)<br />
                      dbsz=10,10  (10х10 пикселей)<br />
                      dbnc=1,0,3,1  (создать 1 8-битный. 3 16-битных и 1 32-битный канал. Каналы будут созданы  именно в такой последовательности)<br />
                      dblayout=”file (разбивка по отдельным  файлам) </p>
                    <pre>run cim</pre>
                    <p><strong>CIMPRO2</strong> – создание файла и назначение ему проекции</p>
                    <p> Использование:<br />
                      file=&quot;  (имя файла)<br />
                      dbnc=  (число каналов  - см. выше)<br />
                      dblayout=  (тип хранения каналов - см. выше)<br />
                      project=&quot;(имя  проекции)<br />
                      zone=(зона  проекции UTM)<br />
                      ellips=&quot;(эллипсоид  или датум)<br />
                      llbound=&quot;(координаты  углов – географические или метрические)<br />
                      ulx=&quot;  (координаты углов)<br />
                      uly=&quot;<br />
                      lrx=&quot;<br />
                      lry=&quot;<br />
                      bxpxsz=&quot;  (размер пикселя по осям. Число пикселей будет определено автоматически)<br />
                      bypxsz=&quot;<br />
                      extrainf=  (дополнительная информация по проекции. Команда включает множество дополнительных  параметров для разных проекций. Все эти параметры могут быть объявлены «по  умолчанию»)</p>
                    <pre>r cimpro2</pre>
                    <p><strong><a name="import" id="import"></a>Команды импорта/экспорта растровых данных</strong></p>
                    <p><strong>FIMPORT</strong> – импорт файла. Если импортируемый файл растровый,  будет создан канал в новом файле. Если импортируется векторный формат – будет  создан файл с векторным сегментом. Информация о привязке, если может быть  прочитана, будет внесена в сегмент №1.</p>
                    <p>fili=&quot; входной файл (с расширением!)<br />
                      filo=&quot; (новый файл PCIDSK)<br />
                      dbiw= (опционно: может быть задано окно для автоматической  обрезки изображения. Окно задается в пикселях изображения. Для векторных  форматов не используется)<br />
                      dblayout= (тип хранения каналов - см. выше)</p>
                    <pre>run fimport</pre>
                    <p>При экспорте в растровые форматы нельзя указывать векторные сегменты и наоборот.</p>
                    <p>Другие полезные команды (смотрите описание в справочной  системе EASI):<br />
                          <strong>NUMWRIT</strong> – выгрузка растровых данных в виде текстового файла.<br />
                          <strong>NUMREAD</strong> – чтение текстового файла в растровое изображение.<br />
                          <strong>IMAGERD</strong> – импорт бинарных файлов.</p>
                    <p><strong><a name="adddelete" id="adddelete"></a>Команды удаления/добавления каналов и сегментов</strong></p>
                    <p><strong>PCIADD2</strong> – добавление нового канала. </p>
                    <p>file=&quot;  (имя файла)<br />
                      datatype=&quot;  (радиометрическое разрешение. Возможные значения: 8u/16s/16u/32r)<br />
                      addmode=&quot; (create – будет создан пустой канал, exist –  канал будет добавлен из другого файла)<br />
                      ifile=&quot; (Имя файла, который будет добавлен в качестве  канала с опцией exist.  Например, если существуют два файла с одинаковыми размерами и привязкой, то  каналы одного из них (файлы с расширением *.001, *.002 и т.д.) могут быть  привязаны в качестве дополнительных каналов к другому файлу PCIDSK. При этом копирование  производиться не будет, что позволит сэкономить место на диске).</p>
                    <pre>r pciadd2</pre>
                    <p><strong>PCIDEL2</strong> – удаление канала.</p>
                    <p>file=&quot; (имя файла)<br />
                      delmode=&quot; (yes  - канал будет физически стерт с диска, no – канал (в виде отдельного  файла) сохраниться, будет удалена только привязка этого канала к файлу PCIDSK. Эту опцию следует  всегда использовать, если Вы использовали каналы другого снимка). <br />
                      dbic= (список каналов)</p>
                    <pre>r pcidel2</pre>
                    <p>Специальной команды создания сегментов типа растровых масок или векторов не существует. Однако часто бывает нужно создать пустую растровую маску для последующего использования в ходе обработки. Обходной путь здесь – использование команды пороговых значений со значениями, заранее превосходящими амплитуду значений в пределах канала. Например:</p>
                    <p>file=&quot;  (имя файла)<br />
                      dbic=  (номер пустого канала или канала с известной амплитудой значений)<br />
                      dbob=  (оставим пустым – этот сегмент будет создан)<br />
                      tval=  (минимальное и максимальное пороговые значения, заранее больше известной  амплитуды данных. Например, если канал, указанный в dbib, пустой, достаточно указать 1,1)<br />
                      dbsn=&quot;  (имя нового сегмента – обязательное поле)</p>
                    <pre>r thr</pre>
                    <p>Подробнее команда THR будет рассмотрена в следующей статье.</p>
                    <p><strong>DAS</strong> – Удаление  сегмента. Номер сегмента останется в базе данных, однако сегмент будет помечен &quot;Deleted&quot;, и его номер  будет свободным – то есть достанется следующему созданному сегменту.</p>
                    <p>file=&quot; (имя файла)<br />
                      dbsl= (номера сегментов) </p>
                    <pre>r das</pre>
                    <p><strong><a name="exchange" id="exchange"></a>Команды обмена данными между файлами PCIDSK</strong></p>
                    <p><strong>IIA </strong>– Перенос  сегмента (обычно используется для неграфических сегментов – сегментов привязки,  таблиц радиометрической коррекции и пр.)</p>
                    <p>fili=&quot;  (имя исходного файла)<br />
                      filo=&quot; (имя файла, куда будет перенесен сегмент)<br />
                      dbsl= (номера сегментов)<br />
                      dbos= (номера сегментов, на место которых будут записаны  перенесенные сегменты. Если поле оставить пустым, будут созданы новые сегменты)</p>
                    <pre>r iia </pre>
                    <p><strong>IIB </strong>– Перенос  растровых масок</p>
                    <p>fili=&quot;  (имя исходного файла)<br />
                      filo=&quot;  (имя файла, куда будут перенесены маски)<br />
                      dbib=  (номера исходных сегментов)<br />
                      dbob=  (номера сегментов, на место которых будут записаны перенесенные сегменты. Если  поле оставить пустым, будут созданы новые сегменты)</p>
                    <pre>r iib</pre>
                    <p>При переносе растровых данных необходимо, что бы оба файла  имели одинаковый размер (в пикселях). Желательно (но не обязательно) что бы  привязка была одинаковой. Если привязка и размер пикселей совпадают, но  линейный размер различается, можно использовать дополнительные параметры:<br />
                      dbiw=  (размер исходного окна. Размер задается как Xoffset,Yoffset,Xsize,Ysize. Офсет  отсчитывается от верхнего левого пикселя изображения. Все размеры в пикселях)<br />
                      dbow= (размер конечного окна. Задается также, как и размер  исходного окна)<br />
                      Данный параметр удобен, когда необходимо собрать мозаику  изображений без перекрытия.</p>
                    <p><strong>III </strong>– Перенос канала изображения</p>
                    <p>fili=&quot;  (имя исходного файла)<br />
                      filo=&quot; (имя файла, куда будут перенесены каналы)<br />
                      dbic= (список исходных каналов)<br />
                      dboc= (список каналов в выходном файле. Каналы должны быть  уже созданы, параметр обязательно должен иметь такое же число каналов, как  число исходных каналов)</p>
                    <pre>r iii</pre>
                    <p>Так же, как и при переносе растровых масок, изображения должны иметь одинаковый размер в пикселях. Возможно использование параметров dbiw и dbow (см. выше).</p>
                    <p><strong>IIIAVG</strong> – Перенос канала изображения с усреднением значений в соответствии с различием в размере пикселей исходного и выходного растров. Параметры команды аналогичны III:</p>
                    <p>fili=&quot;  (имя исходного файла)<br />
                      filo=&quot; (имя файла, куда будут перенесены каналы)<br />
                      dbic= (список исходных каналов)<br />
                      dboc= (список каналов в выходном файле)</p>
                    <pre>r iiiavg</pre>
                    <p>Для получения корректного результата, растровые сетки должны  быть вложенными, т.е. в пределах пикселя выходного файла должно размещаться  целое число пикселей исходного файла. Вложенные растровые сетки должны иметь  одинаковый размер. Возможно использование параметров dbiw и dbow (см. выше).</p>
                    <p>Данная команда удобна для расчета процентного содержания одного  класса в пределах пикселей растра с меньшим пространственным разрешением. Для расчета  % целевого класса, задайте всем пикселям данного класса значение 100, а прочим  пикселям значение 0 в исходном изображении. После выполнения команды IIIAVG выходное изображение  будет содержать % класса в пределах каждого пикселя. Команда выполняет округление  значения до ближайшего целого в случае использования 8-битного канала. Если Вы  хотите сохранить точные значения, канал выходного файла должен быть  целочисленным (32r).</p>
                    <p><strong><a name="struct" id="struct"></a>Команды чтения информации о структуре фалов PCIDSK</strong></p>
                    <p><strong>CDL</strong> – Вывод  на экран (или в файл) списка каналов изображения с кратким описанием (тип  данных, имя канала и др.)</p>
                    <p>file=”  (имя файла)<br />
                      report=” (по умолчанию = term (вывод на экран). Вместо этого может быть задано имя файла: report=”report.txt)</p>
                    <pre>r cdl</pre>
                    <p><strong>ASL</strong> - Вывод  на экран (или в файл) списка сегментов файла PCIDSK с кратким описанием (тип данных, имя сегмента и др.)</p>
                    <p>file=”  (имя файла)<br />
                      report=”  (term или имя файла)</p>
                    <pre>r asl</pre>
                    <p>IHR – Чтение  и запись в набор переменных информации о структуре файла и привязке.</p>
                    <p>file=&quot; (имя файла)</p>
                    <pre>r ihr</pre>
                    <p>Список создаваемых в памяти переменных:<br />
                      IMSTAT(1)  = размер в пикселях, Х<br />
                      IMSTAT(2)  = размер в пикселях, Y<br />
                      IMSTAT(3)  = число каналов<br />
                      IMSTAT(4)  = число каналов 8-bit<br />
                      IMSTAT(5)  = число каналов 16-bit signed<br />
                      IMSTAT(6)  = число каналов 16-bit unsigned<br />
                      IMSTAT(7)  = число целочисленных каналов 32-bit <br />
                      IMSTAT(8)  = число сегментов<br />
                      IMSTAT(9)  = размер пикселя, X (м)<br />
                      IMSTAT(10)  = размер пикселя, Y (м)<br />
                      IMSTAT(11)  = единицы растра  (0=PIXEL,1=UTM,2=METRE,3=LONG/LAT, 4=other,-1=error)<br />
                      IMSTAT(12)  = Верхний левый угол,  X (единицы растра)<br />
                      IMSTAT(13)  = Верхний левый угол,  Y (единицы растра)<br />
                      IMSTAT(14)  = Нижний правый угол,  X (единицы растра)<br />
                      IMSTAT(15)  = Нижний правый угол,  Y (единицы растра)</p>
                    <p>Команда IHR  удобна, если Вы хотите создать «чистую» копию растра с сохранением размеров и  привязки. Вот как будет выглядеть последовательность команд:</p>
                    <p>file=&quot;old (имеющийся растр)</p>
                    <pre>r ihr</pre>
                    <p>file=&quot;new (создаваемый растр)<br />
                      dbsz=imstat(1),imstat(2) (используем переменные из  памяти)<br />
                      dbnc=  10,0,0,0 (число каналов по типам)<br />
                      dblayout=&quot;file</p>
                    <pre>r cim</pre>
                    <p>fili=&quot;old<br />
                      filo=&quot;new<br />
                      dbsl=1<br />
                      dbos=1</p>
                    <pre>r iia</pre>
                    <p>Последняя команда – копирование сегмента привязки. Поскольку  создаваемый файл имеет такой же размер, что и исходный, сегменты привязки у них  будут идентичными.</p>
                    <p class="discuss">
						<span><!--#include virtual="/scripts/forum-comments-num.php?i=852"--></span>
					</p>
			<div class="links">
			<h2>Ссылки по теме</h2>
			<ul>
               <li><a href="perl.html">Использование языка PERL для автоматизации работы с пространственными данными в среде Windows</a></li>
               <li><a href="http://www.pcigeomatics.com/services/support_center/quickguides/EASI%20Modelling%20in%20Focus.pdf" target="_blank" class="external">EASI Modelling in Focus</a></li>
			</ul>
			</div>
                    <p class="status">
   						<span><!--#include virtual="/scripts/date.php" --></span>
					</p>
<!--Contents end-->
<!--#include virtual="/inc/footer2.php" -->
