<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Пакетное склеивание shape-файлов в MergeShapes/OGR</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Пакетное склеивание shape-файлов в MergeShapes/OGR </h1>
<p class="ann">Описание инструмента и операции, которую он производит </p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=2832"--></span></p>
<h2>Склеивание shape-файлов в OGR </h2>
<p>Сначала остановимся на том, как выполнить операцию склеивания файл за
файлом. Подразумевается что GDAL/OGR уже установлен и как его запускать
читатель знает. Если нет, то сначала нужно его установить
(<a href="/qa/qgis-osgeo4w.html">подробнее про установку</a>) и научиться
с ним работать (<a href="/qa/ogr2ogr-examples.html">подробнее про начало работы</a>).</p>
<p>Принцип работы заключается в следующем, склеивание итерационное, т.е.
shape-файлы &quot;приклеиваются&quot; к основному (merged.shp) по-очереди
командами -update -append. Первой командой из первого shape-файла можно
создать этот основной файл. </p>
<pre>ogr2ogr merged.shp shapefile1.shp
ogr2ogr -update -append merged.shp shapefile2.shp -nln merged
ogr2ogr -update -append merged.shp shapefile3.shp -nln merged
...</pre>

<h2>Пакетное склеивание  </h2>
<p>Склеивание сотен или тысяч shape-файлов практически невозможно без
дополнительного программирования. В Arcview GIS склеивание большого
количества shape-файлов неизбежно приводит рано или поздно к переполнению
памяти, в ArcGIS это более удобно, но так же вызывает затруднения связанные
с ограничениями реализации диалогов программы.</p>
<p>Mergeshapes-gdal&nbsp;&mdash; программа-оболочка для программы
gdal_merge.py из пакета GDAL/OGR. Работает только под Windows.</p>
<p>Перед началом работы, нужно установить GDAL/OGR, например через
<a href="http://fwtools.maptools.org/" target="_blank" class="external">пакет FWTools</a>.</p>
<p>Для начала работы нужно задать:</p>
<p>1. Папку содержащую все shape-файлы</p>
<p>2. Месторасположение ogr2ogr.exe</p>
<p>И нажать Make batch. В результате работы программы будет создан batch-файл
merge.bat в папке с shape-файлами, содержащий все необходимые команды для
склеивания. Его необходимо запустить, результатом работы будет единый
shape-файл merge.shp.</p>
<p>Примечание: подразумевается, что структура атрибутивной информации
(типы и названия полей) shape-файлов идентична.</p>
<p align="center"><img src="/images/merge-shapes-01.gif" width="215" height="158"></p>
<p align="center"><a href="/programs/vb/mergeshapes-gdal.zip">Скачать программу</a></p>
<p align="center"><a href="/other/libraries.zip">Скачать библиотеки</a></p>

<h3>Инструменты для QGIS</h3>
<strong>MergeShapes</strong>
<p>Расширение MergeShapes доступно из
<a href="http://gis-lab.info/programs/qgis/qgis-repo.xml">репозитория ГИС-Лаб</a>.</p>
<p>MergeShapes разработан для QGIS версии 1.0.0 и старше, для работы не
требует наличия дополнительных модулей. Вызывается нажатием на кнопку:
<img src="/images/merge-shapes-02.png" width="31" height="31"></p>
<p align="center"><img src="/images/merge-shapes-03.png" width="387" height="343"></p>
<p>В поле «Исходный каталог» указывается папка с шейпами, которые необходимо
объединить, а в «Выходной файл», соответственно, куда будет записан результат.
При выборе выходного файла можно задать желаемую кодировку атрибутивных данных.
Выпадающий список «Тип shape-файлов» позволяет выполнять обработку каталогов
с shape-файлами разных типов (геометрией), при этом склеиваться будут только
файлы с заданной геометрией. Если объединять надо не все  файлы из папки,
а только некоторые&nbsp;&mdash; нужно установить флаг «Выбрать файлы в каталоге»
и вместо папки можно будет выбирать файлы. При выборе отдельных файлов можно
задать кодировку атрибутивных данных (применяется ко всем выбранным файлам).</p>
<p>Если атрибутивные таблицы исходных shape-файлов отличаюся, результирующий
файл будет содержать все уникальные поля всех исходных файлов.</p>
<p>По окончанию процесса склейки созданный файл можно сразу же добавить
на карту, для этого достаточно установить флаг «Добавить результать к карте».</p>
<p>Верхний индикатор отображает прогресс обработки текущего файла, а
нижний показывает общий прогресс.</p>
<strong>fTools</strong>
<p>Ранняя версия MergeShapes была интегрирована в состав fTools. Новый
инструмент находится в меню «Вектор&nbsp;&rarr; Управление данными&nbsp;&rarr;
Объединение shape-файлов».</p>
<p align="center"><img src="/images/merge-shapes-04.png" width="385" height="300"></p>
<p>Работа с инструментом объединения во многом аналогична работе с
расширением MergeShapes. В поле «Исходный каталог» указывается папка с shape-файлами,
которые необходимо объединить. Если необходимо выбрать несколько файлов
в папке, устанавливается флаг «Select by layers in the folder». Результат
объединения будет сохранен в файл, заданный полем «Сохранить результат в shape-файл».
Есть возможность автоматической загрузки результатов в QGIS.</p>
<p>Объединение shape-файлов с разными атрибутивными таблицами может
приводить к непредсказуемым результатам, а при обработке папок необходимо
следить чтобы в них были файлы с одинаковым типом геометрии.</p>

<p class="discuss">
<span><!--#include virtual="/scripts/forum-comments-num.php?i=2832"--></span>
</p>

<div class="links">
  <h2>Ссылки по теме</h2>
    <ul>
      <li><a href="/qa/layerstack-tool.html">Пакетная обработка данных ETM+ в Layerstack/ERDAS</a></li>
    </ul>
</div>

<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 31.01.2009
<br>Автор(ы): <a href="forum/memberlist.php?mode=viewprofile&u=2">Максим Дубинин</a>, <a href="forum/memberlist.php?mode=viewprofile&u=5325" target="_blank">Александр Бруй</a></span></p>
<!--#include virtual="/inc/footer2.php" -->
