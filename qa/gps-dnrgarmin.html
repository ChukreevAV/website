<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Загрузка данных с GPS в нужной системе координат (DNRGarmin)</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Загрузка данных с GPS в нужной системе координат (DNRGarmin) </h1>
<p class="ann">Удобное получение точек и треков из GPS с помощью бесплатной программы</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=199"--></span></p>
<p>Задача: Получить данные из GPS настроенного на работу
              в одной из систем координат, отличной от системы принятой по умолчанию,
              которой является международная геоцентрическая система координат WGS-84
              (World Geodetic System, 1984) базирующаяся на эллипсоиде WGS-84.</p>
            <p>Как пример, будет рассматриваться прибор GPS настроенный
              на работу в системе координат 1942 года (Pulkovo-1942, СК-42), основанной
              на референц-эллипсоиде Красовского, центр которого смещен с центра
              масс Земли более, чем на 155м.</p>
            <p>О том, как настроить GPS на работу с картами в системе
              координат 1942 года можно <a href="/qa/gps.html">прочитать здесь</a>.
              Далее будет идти речь о получении данных именно в этой системе координат.</p>
            <p><b>Главная особенность загрузки данных с GPS (и типичная
              ошибка новичка в том, что он не учитывает этот факт)</b> заключается в том, что несмотря на то, настроен
              ли GPS на систему координат отличную от WGS-84 или не настроен, передача
              данных в программу осуществляется в системе координат WGS-84. Убедиться
              в правильности такого утверждения просто, достаточно взглянуть на
              цифры, которые показываются на экране GPS, для определенной точки
              и координаты этой же точки загруженной с помощью одной из распространенных
              программ (OziExplorer, DNRGarmin, GPS-Expert и т.д.). </p>
            <p>Особенностью работы с любыми программами позволяющими
              загружать данные с GPS, является их предварительная специальная настройка,
              для конвертации данных пост-фактум, после загрузки их с GPS. С помощью
              такой конвертации данные &quot;возвращаются&quot; в нужную систему
              координат.</p>
            <p><strong>Внимание:</strong> для корректной работы пересчета координат, необходимо, чтобы разделитель целой и дробной части в операционной системе был точкой, а не запятой, иначе перерасчет произведен не будет. </p>
            <p>Таким образом, задача разделяется на три: загрузка данных
              из GPS, их конвертация и сохранение.</p>
            <p>Наиболее удобной для данных операций является программа
              DNR Garmin, доработанная авторами при тесном сотрудничестве с GIS-Lab. <a href="http://www.dnr.state.mn.us/mis/gis/tools/arcview/extensions/DNRGarmin/DNRGarmin.html">Загрузить
              программу</a> (программа может интегрироваться с ПО ГИС и использоваться отдельно).</p>
            <p><b>Внимание:</b> после установки программы, если Arcview
              установлен не в директорию по умолчанию (<b>C:\ESRI\</b>), вам
              нужно вручную взять файл avx из директории, куда был установлен DNR
              Garmin, и переместить его в папку Ext32 каталога установки Arcview,
              например <b>c:\Gis\Arcview3\AV_GIS30\ARCVIEW\EXT32\</b>.</p>
            <p><img src="/images/1.gif" width="33" height="41" align="left" /><b>Загрузка
              данных</b></p>
            <p>Подключив с помощью кабеля ваш прибор к COM или USB-порту
              компьютера, включите GPS, выберите через меню GPS в качестве интерфейса <b>GRMN/GRMN Host</b> (<b>Setup menu\Interface\</b>, в серии Garmin Etrex название интерфейса - <strong>Garmin</strong>). Загрузите Arcview 3.x, подключите
              расширение DNRGarmin (<b>File\Extensions\DNR Gramin - Arcview</b>)</p>
            <p align="center"><img src="/images/gps-dnrgarmin1.gif" width="375" height="91" border="1" /></p>
            <p align="left">В новом меню, добавшемся в меню Вида, выберите <b>DNR Garmin\Open Garmin GPS</b></p>
            <p align="center"><img src="/images/gps-dnrgarmin2.gif" width="403" height="95" border="1" /></p>
            <p align="left">После этого, будет вызвано внешнее приложение
              (которое, кстати, может работать и без Arcview, загружая и сохраняя
              данные). Приложение произведет опрос всех портов компьютера и определит
              модель GPS, версию прошивки и другую информацию о GPS.</p>
            <p align="center"><img src="/images/gps-dnrgarmin3.gif" width="467" height="127" /></p>
            <p align="left">После первой загрузки программа предложит на выбор установить проекцию использующуюся создателями программы или другую, можно выбрать любой ответ - <strong>Нет</strong>, а потом в окне выбора проекции нажать на <strong>None</strong>. В строке статуса
              программы появится: <strong>Projection: No Projection</strong>, что означает, что никакой
              проекции (или системы координат в нашем случае) программе не задано
              и она не будет пересчитывать полученные данные на лету. </p>
            <p align="left">Для загрузки данных, выберите из меню Waypoint\Download,
              через некоторое время данные будут загружены. <b>GPS при этом должен
              быть включен. </b>Загруженные данные будут загружены в специальную
              таблицу. </p>
            <p align="center"><img src="/images/gps-dnrgarmin4.gif" width="671" height="206" border="1" /></p>
            <p align="left">Так как систему координат мы пока не задали,
              исходные данные (полученные с GPS, красная рамка), равны пересчитанным
              (зеленая рамка). Остальные поля являются дополнительными, вы можете
              отключить их с помощью меню <b>Waypoint\Waypoint Properties...</b> </p>
            <p align="left">В дальнейшем, задав один раз нашу систему
              координат, делать это снова не придется. </p>
            <p><img src="/images/2.gif" width="33" height="41" align="left" /><b>Пересчет
              данных полученных с GPS</b></p>
            <p>После того, как данные получены в специальную таблицу,
              необходимо один раз настроить программу DNR Garmin, чтобы в дальнейшем
              она на лету пересчитывала полученные данные в нужную нам систему координат.
              Для примера рассмотрим конвертацию в систему координат 1942 года (Pulkovo-1942,
              СК-42) c параметрами трансформации датума приведенными в <a href="/qa/gps.html">этой
              статье</a>.</p>
            <p>Для этого, необходимо найти файл <b>epsg </b>в одной
              из поддиректорий директории, куда был установлен DNR Garmin (<b>\proj\nad\</b>),
              например полный путь к файлу может выглядеть так: <b>c:\Gis\DNRGarmin\proj\nad\epsg. </b>Файл необходимо открыть в любом текстовом редакторе и добавить
              в конец файла такой текст:</p>
<pre># SK42-GOST / SK-42 (3-param, GOST)
&lt;200097&gt; +proj=latlong +ellps=krass +towgs84=23.92,-141.27,-80.9,0,0,0,0 </pre>
            <p align="left">Где:<br />
              <b>SK42-GOST - </b>название<b> </b>для наших параметров трансформации
              датума (произвольное);<b><br />
              SK-42 (3-param, GOST) - </b>описание <b> </b>для нашей системы координат (произвольное),
              в нашем случае проекция как таковая отсутствует в принципе, но название
              ей все равно надо задать;<br />
              <b>&lt;200097&gt; - </b>уникальный код для наших настроек (см. далее); <strong>Внимание: </strong>этот код должен быть уникальным, то есть файл epsg не должен содержать других записей с таким кодом, иначе будут использованы они, а не данная настройка. <br />
              +proj=latlong - </b>проекция - географическая;<b><br />
              +ellps=krass - </b>эллипсоид Красовского;<b><br />
              <b>+towgs84=23.92,-141.27,-80.9,0,0,0,0</b></b> - линейные и угловые элементы перехода от WGS-84 к
              СК-42 (трансформация датума) взятые из <a href="../docs/law/gost51794-2001.zip">ГОСТ 51794-2001</a>;</p>
            <p align="left">Далее необходимо показать программе, что
              нам необходимо использовать именно эти настройки для пересчета координат.
              Для этого необходимо выбрать <b>File\Set Projection</b> и в поле <b>POSC
              Codes</b> ввести наш уникальный номер настроек, в данном случае <b>200097</b> и нажать <b>Enter</b>. Сделанные нами настройки загрузятся в окно
              настроек проекции.</p>
            <p align="center"><img src="/images/gps-dnrgarmin9.gif" width="318" height="476" /></p>
            <p align="left">После принятия настроект, загруженные в
              данный момент в таблицу данные будут пересчитаны, за исходные будут
              приняты данные из полей <b>lat, long</b>, пересчитанные значения будут
              помещены в поля <b>x_proj, y_proj</b>.</p>
            <p align="center"><img src="/images/gps-dnrgarmin6.gif" width="525" height="184" /></p>
            <p align="left">Получаемые таким образом данные до 6 знака
              после запятой соответствуют пересчету проводимому самим прибором GPS
              (то что он, собственно показывает на экране) и пересчету в пакете
              Arcinfo Workstation c <a href="/other/wgs2pul-3param.sml">такими настройками
              перепроектировки</a>, что говорит об отсутствии ошибок в данной ситуации
              и о том, что программе можно доверить данную операцию. Используемое
              преобразование для GPS, DNR Garmin и Arcinfo Workstation одинаково
              - <a href="datum-transform-methods.html">3-х параметрическое преобразование Молоденского</a>.</p>
            <p><img src="/images/3.gif" width="33" height="41" align="left" /><b>Сохранение
              данных</b></p>
            <p>После сохранения данных и их конвертации, их можно сохранить
              в shape-формате, при этом, если DNR Garmin был запущен из Arcview
              - созданный shape-файл сразу будет добавлен как тема Arcview в Вид.
              Точки можно сохранить как в спроектированном виде (Arcview Shapefile
              (Projected)), так и в исходном в WGS-84 (Arcview Shapefile (Unprojected)).</p>
            <p align="center"><img src="/images/gps-dnrgarmin7.gif" width="326" height="168" /></p>
            <p><img src="/images/4.gif" width="33" height="41" align="left" /><b>Проверка</b></p>
            <p>Если у вас есть сомнения в правильности цифр, которые
              вы получаете после перепроектировки, создайте новую точку выбрав Edit\Add
              record, дважды нажать на 0 в поле lat, набрать 50 и также набрать
              50 в поле long, затем, выбрать из меню Edit\Project coordinates и
              сравните то что получается у вас и то, что получается у нас (об этих
              цифрах выше говорится, что они на 20-30см отличаются от спроектированных
              с помощью Arcinfo Workstation).</p>
            <p align="center"><img src="/images/gps-dnrgarmin8.gif" width="406" height="35" /></p>
            <p class="discuss">
				<span><!--#include virtual="/scripts/forum-comments-num.php?i=199"--></span>
			</p>
			<div class="links">
			<h2>Ссылки по теме</h2>
			<ul>
               <li><a href="/qa/gps.html">Настройка GPS для работы с российскими картами</a></li>
			   <li><a href="/qa/wgs84-sk42-wgs84-formula.html">Формулы пересчета данных GPS-измерений из WGS-84 в СК-42 и обратно</a></li>
			   <li><a href="/docs/legislation.html">ГОСТ 51794-2001 Аппаратура радионавигационная глобальной навигационной спутниковой системы и глобальной системы позиционирования. Системы координат. Методы преобразования координат определяемых точек.</a></li>
			</ul>
			</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 17.11.2004
<br>Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=2" target="_blank">Максим Дубинин</a></span></p>
<!--#include virtual="/inc/footer2.php" -->
