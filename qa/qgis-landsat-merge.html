<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Как собрать и показать снимок Landsat из отдельных каналов в QGIS</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Как собрать и показать снимок Landsat из отдельных каналов в QGIS</h1>
<p class="ann">Собираем Landsat из отдельных файлов-каналов</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=8009"--></span></p>
<p>Эта статья&nbsp;&mdash; пособие для новичков в ГИС, объясняющая как
решить данную конкретную задачу. Подразумевается что QGIS у читателя уже
установлена, если это не так&nbsp;&mdash; установите её используя
<a href="/qa/qgis-osgeo4w.html">инструкцию</a>.</p>
<p>Также предполагается, что вы знаете как доставать данные Landsat из архива Glovis. Если это не так - ознакомьтесь со статьей <a href="landsat-glovis.html">Получение бесплатных космических снимков Landsat TM,ETM+ через Glovis</a>.</p>
<p>Если вы хотите потренироваться в создании снимка из отдельных каналов,
  то можно использовать <a href="/data/samples/lt51700282007141mor00.7z">этот архив</a> (полная сцена 170/28, 7 каналов, формат TIF, UTM zone 38, Калмыкия, оригинал с Glovis).</p>
<h2><strong><a name="01" id="01"></a></strong>1. Подготовка</h2>
<p>Для работы нам необходимо расширение GDALTools, которое входит в состав
QGIS начиная с версии 1.5. Проверить, установлено ли оно можно вызвав
&laquo;Менеджер модулей&raquo; из меню &laquo;Модули&nbsp;&rarr; Управление
модулями&raquo; и поискав расширение там. Если расширение есть и не активно,
необходимо его включить.</p>

<p align="center"><img src="/images/qgis-landsat-merge-01.png" alt="GDALTools в Менеджере модулей" width="670" height="344"></img></p>

<p>Если расширения нет в списке доступных, необходимо его установить. Для
этого:</p>
<ol>
  <li>Откройте &laquo;Установщик модулей&raquo; (в меню &laquo;Модули&nbsp;&rarr;
  Загрузить модули&raquo;)</li>
  <li>В окне установщика выберите вкладку &laquo;Репозитории&raquo; и проверьте
  подключен ли репозиторий &laquo;Faunalia Repository&raquo;. Если репозиторий
  подключен переходим к пункту 5.</li>
  <li>Если нет, нажимаем кнопку &laquo;Добавить сторонние репозитории&raquo;, читаем
  и принимаем к сведению предупреждение.</li>
  <li>Переходим на вкладку &laquo;Параметры&raquo; и в группе &laquo;Разрешённые
  модули&raquo; выставляем переключатель в положение &laquo;Показывать все модули,
  кроме помеченных как экспериментальные&raquo;</li>
  <li>Переходим на вкладку &laquo;Модули&raquo; и при помощи фильтра или используя
  полосу прокрутки находим в списке GDALTools, выделяем его и нажимаем &laquo;Установить
  модуль&raquo;</li>
  <li>После загрузки модуля он будет автоматически активирован.</li>
</ol>
<p>Установленный и активированный модуль создает еще один пункт в главном меню
QGIS (если он отсутствует)&nbsp;&mdash; &laquo;Растр&raquo;. Или добавляет
свои инструменты в существующее меню.</p>

<p align="center"><img src="/images/qgis-landsat-merge-02.png" alt="GDALTools в меню Растр" width="317" height="597"></img></p>

<h2><strong><a name="02" id="02"></a></strong>2. Собираем растр из каналов</h2>
<p>Итак, у нас имеется снимок Landsat в виде растров, представляющих отдельные
каналы изображения, всего 7 файлов. Нам же необходимо получить один файл
с 7 каналами.</p>
<p>Чтобы было удобнее работать, все 7 файлов складываем в одну папку. Набор файлов может выглядеть следующим образом, в зависимости от того, какой это Landsat, может добавляться еще файл _B80 значительно большего размера. </p>
<p align="center"><img src="/images/qgis-landsat-merge-09.png" alt="Набор файлов Landsat" width="605" height="325"></p>
<p> Открываем
  меню &laquo;Растр&raquo; и выбираем пункт &laquo;Объединение&raquo;. Начинаем
  заполнять поля диалога:</p>
<ul>
  <li>в поле &laquo;Исходные файлы&raquo; через запятую указываются полные
  имена файлов-каналов. Так как все растры у нас лежат в одной папке, можно
  поступить проще: нажать &laquo;Выбрать...&raquo; и выделить все файлы,
  нажав Shift. <strong><br>
  Примечание</strong>: Если указываются не все файлы (например исключается 6 канал, что обычно делается так как он тепловой), то необходимо выбрать файлы с первого по последний зажав Ctrl.</li>
  <li>в поле &laquo;Целевой файл&raquo; указываем полный путь к результирующему
  файлу. Как и в предыдущем случае, кнопка &laquo;Выбрать...&raquo; облегчает
  эту задачу. <strong><br>
  Примечание</strong>: сохранить результат можно в любой,
  поддерживаемый GDAL, формат. Выбрать формат можно при помощи выпадающего
  списка &laquo;Типы файлов&raquo;. Обычный формат для такого случая GeoTIFF. Имя файлу лучше давать осмысленное, например для случая выше: 170028_070521, первые цифры обозначают номенклатуру снимка в системе WRS-2, последние 6 - дату в формате ГГММДД. </li>
  <li>так как нам нужен растр с 7 каналами, ставим флажок &laquo;Склеить
  поканально&raquo;. Если не поставить его, то получим одноканальный растр.</li>
  <li>если полученный растр нужно использовать в дальнейшей работе, можно
  установить флажок &laquo;Добавить результат на карту&raquo;</li>
</ul>
<p>Отдельно стоит сказать о группе &laquo;Параметры создания&raquo;. С ее
помощью можно выполнить &laquo;тонкую&raquo; настройку создаваемого файла,
например, включить использование сжатия, генерацию world-файла и др. У
каждого формата свой набор возможных параметров, ознакомиться с ними можно
на странице описания формата (<a href="http://www.gdal.org/formats_list.html" target="_blank" class="external">список форматов</a>).</p>
<p>Например, для формата TIFF можно установить следующие параметры: COMPRESS=LZW,
TILED=YES, TFW=YES и BIGTIFF=IF_NEEDED. Этим мы включим сжатие результата
алгоритмом Лемпеля — Зива — Велча (Lempel-Ziv-Welch), создадим world-файл,
при необходимости будет задействован режим BIGTIFF, а сам растр будет
создан с разбивкой на тайлы, что в некоторых случаях повышает скорость
загрузки и отрисовки.</p>
<p>Вообще же использование дополнительных параметров требует предварительного
исследования, так как параметры, оптимальные для одних задач, могут оказаться
неприемлимыми при выполнении других. В конце статьи приведена ссылка на
небольшое исследование различных алгоритмов сжатия.</p>
<p>Если у вас нет особенных требований, не устанавливайте дополнительные параметры создания. </p>
<p align="center"><img src="/images/qgis-landsat-merge-03.png" alt="Настройка инструмента Объединение" width="429" height="539"></img></p>

<p>После того как все необходимые поля заполнены нажимаем OK и ждем окончания
процесса.</p>
<p><strong>Примечание</strong>: в нижней части диалогового окна отображается
командная строка, используемая для операции. При необходимости ее можно
скопировать, отредактировать и выполнить отдельно.</p>

<h2><strong><a name="03" id="03"></a></strong>3. Настройка отображения растра</h2>
<p>Результатом предыдущей операции был новый файл и теперь мы хотим на него посмотреть. </p>
<p>По умолчанию растр загружается с использованием стандартной комбинации
  каналов 1-2-3, что не всегда удобно. Изменить комбинацию каналов и некоторые
  другие параметры отображения растра можно в диалоговом окне &laquo;Свойства
  слоя&raquo; (вызывается из контекстного меню слоя, по правой кнопке мыши, пункт &laquo;Свойства&raquo;).</p>
<p>Комбинация каналов и алгоритм улучшения контраста настраиваются на вкладке
&laquo;Стиль&raquo;.</p>

<p align="center"><img src="/images/qgis-landsat-merge-04.png" alt="Вкладка Стиль" width="844" height="690"></img></p>

<p>Ниже показан один и тот же растр, с разными комбинациями каналов и алгоритмом
улучшения контраста.</p>

<p align="center"><img src="/images/qgis-landsat-merge-05.png" alt="Каналы 1-2-3, без растяжения" width="800" height="579"></img><br>
<i>Комбинация каналов 1-2-3, улучшение контраста не используется</i></p>
<p align="center"><img src="/images/qgis-landsat-merge-06.png" alt="Каналы 5-4-3, растяжение до мин/макс, станд. отклонение 2.0" width="800" height="578"></img><br>
<i>Комбинация каналов 5-4-3, растяжение до мин/макс + стандартное отклонение 2.0</i></p>


<p>В этом же окне, на вкладке &laquo;Прозрачность&raquo; можно указать
какое значение растра используется как NODATA. В нашем примере черные
области вокруг растра имеют значение 0 (ноль), поэтому чтобы убрать
их мы установили 0 в качестве значения &laquo;нет данных&raquo;</p>

<p align="center"><img src="/images/qgis-landsat-merge-07.png" alt="Вкладка Прозрачность" width="844" height="690"></img></p>

<p>Результат применения этой настройки ниже.</p>

<p align="center"><img src="/images/qgis-landsat-merge-08.png" alt="Настройка инструмента Объединение" width="800" height="578"></img></p>

<p>Если вы хотите потренироваться в создании снимка из отдельных каналов,
то можно использовать <a href="/data/samples/lt51700282007141mor00.7z">этот архив</a>
(полная сценаа 170/28, 7 каналов, формат TIF, UTM zone 38, Калмыкия, оригинал с Glovis).</p>

<p class="discuss"><span><!--#include virtual="/scripts/forum-comments-num.php?i=8009"--></span></p>
<div class="links">
<h2>Ссылки по теме</h2>
  <ul>
    <li><a href="/qa/landsat-bandcomb.html">Интерпретация комбинаций каналов данных Landsat TM / ETM+</a></li>
    <li><a href="http://linfiniti.com/2011/05/gdal-efficiency-of-various-compression-algorithms/" target="_blank" class="external">GDAL: efficiency of various compression algorithms</a></li>
  </ul>
</div>

<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 06.06.2011
<br>Автор(ы): <a href="forum/memberlist.php?mode=viewprofile&u=5325" target="_blank">Александр Бруй</a></span></p>
<!--#include virtual="/inc/footer2.php" -->
