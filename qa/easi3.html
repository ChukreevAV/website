<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Основы макроязыка EASI (PCI Geomatica) - Географическая привязка и проекции</title>
<!--#include virtual="/inc/header2.txt" -->
<!--Contents start-->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<h1>Основы макроязыка EASI (PCI Geomatica)<br />Часть 3. Географическая привязка и проекции.</h1>
<p class="ann">Третья часть серии статей о языке EASI, основные команды для географической привязки и работы проекциями, системами координат.</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=1662"--></span></p>
<p><strong>Содержание</strong></p>
            <ul>
              <li><a href="#support">Поддерживаемые проекции, эллипсоиды и датумы</a></li>
              <li><a href="#describe">Вывод информации о проекции</a></li>
              <li><a href="#define">Назначение параметров привязки и проекции растровой базе данных</a></li>
              <li><a href="#change">Изменение проекции</a></li>
              <li><a href="#calc">Калькулятор координат</a></li>
              <li><a href="#list">Краткий перечень команд привязки изображений по набору контрольных точек (GCP)</a></li>
            </ul>
            <p><strong><a name="support" id="support"></a>Поддерживаемые проекции, эллипсоиды и датумы</strong></p>
            <p>Стандартные программы EASI поддерживают ограниченный набор проекций и эллипсоидов. Тем не менее, он обычно бывает достаточным для работы с большинством типов данных. Для того, что бы назначить проекцию, используется ее код. Список кодов проекций приводится ниже:</p>
            <p> Проекции, поддерживаемые на эллипсоиде<br />
              ACEA - Albers Conical Equal-Area<br />
              CASS - Cassini<br />
              EC - Equidistant Conic<br />
              KROV - Krovak<br />
              LCC - Lambert Conformal Conic<br />
              MER - Mercator
              <br />
              MSC - Mod. Stereographic Conformal (Alaska)<br />
              OM - Oblique Mercator
              <br />
              PC - Polyconic<br />
              PS - Polar Stereographic<br />
              RSO - Rectified Skew Orthomorphic<br />
              SOM - Space Oblique Mercator<br />
              SPAF - State Plane (U.S. Feet)<br />
              SPCS - State Plane (Metres)<br />
              SPIF - State Plane (International Feet)<br />
              TM - Transverse Mercator<br />
              UPS - Universal Polar Stereographic<br />
              UTM - Universal Transverse Mercato</p>
            <p>Кроме того, географические координаты - LONG/LAT.</p>
            <p> Проекции, поддерживаемые ТОЛЬКО на сфере:<br />
              AE - Azimuthal Equidistant<br />
              ER - Equirectangular<br />
              GNO - Gnomonic<br />
              GOOD - Goode's Homolosine<br />
              GVNP - Gen. Vertical Near-Side Perspective<br />
              LAEA - Lambert Azimuthal Equal-Area<br />
              MC - Miller Cylindrical<br />
              OG - Orthographic<br />
              ROB - Robinson<br />
              SG - Stereographic<br />
              SIN - Sinusoidal<br />
              VDG - Van der Grinten<br />
              (Если в параметрах проекции указан другой эллипсоид, этот параметр игнорируется и выполняется пересчет со сферы).</p>
            <p> Эллипсоиды обозначаются кодами, начинающимися с буквы «Е». Буква может быть опущена (тогда предполагается, что используется эллипсоид). Список эллипсоидов довольно большой. Вы можете сами найти код нужного Вам эллипсоида в справочной системе EASI. Приведем лишь наиболее часто используемые:<br />
              Е000 (или просто 0) - Сlarke 1866 (этот эллипсоид будет подразумеваться в том случае, если никакого эллипсоида и датума не указано!)<br />
              Е008 - GRS 1980<br />
              Е012 - WGS 84<br />
              Е015 - Krassovsky<br />
              Е019 - Sphere of Radius 6370997 metres</p>
            <p> Эллипсоид может быть задан полуосями ("6378206.4 6356583.8").</p>
            <p>Датум задается числовым кодом, начинающимся с буквы «D». Информация о проекции содержит только что-то одно: или имя эллипсоида (тогда подразумевается геоцентрический датум) или имя датума (тогда имя эллипсоида однозначно определено кодом датума). Некоторые распространенные датумы:<br />
D800 – геоцентрический датум для сферы (=Е019)<br />
D000 – WGS 84 (=Е012)<br />
D203 – Pulkovo 1942 (для России)<br />
D-01 - NAD27 (USA, NADCON)<br />
D-02 - NAD83 (USA, NADCON)</p>
            <p> Пользовательские датумы могут быть добавлены в таблицу датумов, хранящуюся в текстовом формате ($PCIHOME/etc/datum.txt). Обратите внимание, что бы номер нового датума не совпадал с уже имеющимися в таблице!</p>
            <p><strong> <a name="describe" id="describe"></a>Вывод информации о проекции</strong></p>
            <p> Информация о привязке и проекции файла хранится в специальном сегменте данных, имеющем номер 1. Вывести на экран или в файл информацию о проекции можно с помощью команды GEOREP:</p>
            <p> <strong>GEOREP</strong> – вывод информации о привязке.<br />
              file=" (имя файла)<br />
              report= (“term или имя файла для вывода)</p>
            <pre>r georep</pre>
            <p>На экране (или в файл) будет выведена следующая таблица с информацией:</p>
            <table width="534" border="0">
              <tr>
                <td width="195"><p>Georeference Units:<br />
                  Projection:<br />
                  Datum - Ellipsoid:<br />
                Grid units:                                         </p></td>
                <td width="329"><p>UTM    33    D000<br />
                  Universal Transverse  Mercator<br />
                  WGS 1984 (Global  Definition) - WGS 84<br />
                METRE</p></td>
              </tr>
            </table>
            <p>&nbsp;</p>
            <table width="611" border="0">
              <tr>
                <td width="173"><p>Upper Left Corner<br />
                  Upper Right Corner<br />
                    Image Centre<br />
                    Lower Left  Corner<br />
                    Lower Right Corner</p>
                  <p>Pixel Size</p>
                  <p>Upper Left Corner<br />
Upper Right Corner<br />
Image Centre<br />
Lower Left  Corner<br />
Lower Right Corner</p>
                  <p>                    </p></td>
                <td width="259" valign="top"><p align="center">288804.750  E<br />
                  533106.750  E<br />
                    410955.750  E<br />
                    288804.750  E<br />
                    533106.750  E</p>
                  <p align="center">
                57.000  E</p>
                <p align="center">13d06'07.60&quot; E  Lon<br />
                15d17'51.23&quot; E  Lon<br />
                14d11'59.31&quot; E  Lon<br />
                13d06'07.60&quot; E  Lon<br />
                15d17'51.23&quot; E  Lon </p></td>
                <td width="165" valign="top"><p>108912.750  N<br />
                  108912.750  N<br />
                    -99.750  N<br />
                    -109112.250  N<br />
-109112.250  N                    </p>
                  <p>57.000  N</p>
                <p>0d59'05.36&quot; N  Lat<br />
                0d59'07.27&quot; N  Lat<br />
                0d00'03.25&quot; S  Lat<br />
                0d59'11.86&quot; S  Lat<br />
                0d59'13.77&quot; S  Lat</p></td>
              </tr>
            </table>
            <p>Формат таблицы стандартный, что позволяет ее использовать при автоматизации процессов с помощью языка PERL (см. статью 4). Следует обратить внимание на замеченные проблемы с выводом таблицы. В ряде случаев (по неизвестной причине) координаты углов могут быть перепутаны (обычно правый и левый углы меняются местами).</p>
            <p><strong><a name="define" id="define"></a>Назначение параметров привязки и проекции растровой базе данных</strong></p>
            <p>Импорт из другого формата.<br />
Существуют несколько способов задания проекции для файла PCIDSK. Прежде всего, проекция может быть автоматически импортирована при импорте данных из другого формата командой FIMPORT. Следует обратить внимание на две замеченные проблемы, возникающие при импорте информации о проекции и привязке:</p>
            <ol>
              <li> При импорте из формата GeoTIF PCI подразумевает, что координаты верхнего левого угла являются координатами границ углового пикселя, в то время как ряд программ подразумевает, что это координаты центра углового пикселя. Ошибка легко может быть замечена при импорте файла GeoTIF одновременно в ERDAS Imagine и PCI, с последующим экспортом обратно в GeoTIF. При этом файл, экспортированный из PCI, будет смещен на пол-пикселя по обеим осям относительно оригинала и файла, экспортированного из ERDAS. Возможные пути решения проблемы: смещение импортированного в PCI файла или импорт в PCI через другие форматы (например, *.img).                </li>
              <li> В ряде случаев параметры проекции могут быть прочитаны неправильно. Особенно часто проблема проявляется при импорте данных из южного полушария в проекции UTM. Для устранения ошибки, проекция может быть переписана в EASI или исправлена через другие приложения PCI (Focus, ImageWorks).</li>
            </ol>
            <p> Создание нового файла с указанием проекции и привязки.<br />
              Создать новый файл и назначить ему параметры привязки и проекцию можно с помощью команды CIMPRO2. Использование команды рассмотрено в статье 1. Здесь мы приведем пример использования команды для создания нового файла в проекции UTM:<br />
              file="new (имя файла)<br />
              dbnc=10,0,0,0 (число каналов  - 10 8-битных каналов)<br />
              dblayout=”file (тип хранения каналов – по разным файлам)<br />
              project="UTM (имя проекции)<br />
              zone=33 (зона проекции UTM)<br />
              ellips="D000 (датум WGS1984)<br />
              llbound="n (координаты углов: если y – географические, если n - метрические)<br />
              ulx="288804.750<br />
              uly="108912.750<br />
              lrx="533106.750<br />
              lry="-109112.250<br />
              bxpxsz="57.000 (размер пикселя)<br />
              bypxsz="57.000<br />
              extrainf= (дополнительная информация о проекции по умолчанию)</p>
			  <pre>r cimpro2</pre>
              <p>Назначение проекции созданному файлу.<br />
Существует несколько команд задания проекции файлу PCIDSK. Мы рекомендуем по возможности всегда использовать команду SETRPO2. После ввода параметров и запуска команды, значения первого сегмента (сегмента привязки) файла PCIDSK будут изменены.</p>
              <p> <strong>SETPRO2</strong> – Ввод информации о привязке и проекции растрового файла.</p>
              <p> file=" (имя файла)<br />
                project=" (имя проекции)<br />
                zone= (зона проекции UTM)<br />
                ellips=" (эллипсоид или датум)<br />
                llbound=" (координаты углов: если y – географические, если n - метрические)<br />
                ulx=" (координаты углов)<br />
                uly="<br />
                lrx="<br />
                lry="<br />
                extrainf= (дополнительная информация по проекции. Команда включает множество дополнительных параметров для разных проекций. Все эти параметры могут быть объявлены «по умолчанию»)</p>
				<pre>r setpro2</pre>
                <p>Существуют другие команды для ввода информации о проекции и привязке:<br />
                  <strong>SETPRO</strong> – команда аналогичная SETPO2, но с меньшими возможностями при вводе параметров проекции.
            <strong>GEOSET</strong> – Простая команда, позволяющая назначить ограниченный набор проекций (UTM, LONG/LAT, State plane). Замечена следующая ошибка: при вводе координат углов значения по оси Y обычно округляются, что приводит к неправильному назначению информации о привязке.</p>
                <p> Создание дополнительного сегмента привязки с информацией о проекции.<br />
                  Для использования ряда программ (например, DBREPRO) бывает необходимым создание дополнительного сегмента с указанием проекции, в которую Вы хотите спроецировать данные. Для этого используем команду PROSET.</p>
                <p> <strong>PROSET</strong> – изменение значений или создание нового сегмента привязки с указанием проекции.</p>
                <p> file=" (имя файла)<br />
                  dbgeo= (номер сегмента. если номер=1, то будет изменена информация о проекции файла. Если номер не указан, будет создан новый сегмент)<br />
                  dbsn=" (имя нового сегмента – обязательный параметр)<br />
                  mapunits=" (Имя проекции. Если проекция зональная, так же и номер зоны. Например, “UTM 33”)<br />
                  ellips=" (эллипсоид или датум)<br />
                  prolat=" (стандартная параллель)<br />
                  prolong=" (центральный меридиан)</p>
				  <pre>r prosin</pre>
            <p>Команда включает множество дополнительных параметров для разных проекций. Для упрощения ввода только параметров нужной проекции, используются специальные процедуры, основанные на команде PROSET. Имя процедур для каждой проекции Вы можете найти в справочной системе EASI. Например, для определения синусоидальной проекции используется процедура <strong>PROSIN</strong>:</p>
                  <p> file=" (имя файла)<br />
                    dbgeo=
                      <br />
                    dbsn=" (имя нового сегмента – обязательный параметр)<br />
                    ellips="19 (для синусоидальной проекции всегда сфера!)<br />
                    prolong="0.0 (стандартные параметры)</p>
					 <pre>r prosin</pre>
            <p><strong><a name="change" id="change"></a>Изменение проекции</strong></p>
            <p> Изменение проекции (перепроецирование) растровых данных в EASI решено в виде серии команд:</p>
            <ol>
              <li> Создание нового сегмента с информацией о требуемой проекции (PROSET).</li>
              <li> Пересчет координат растрового файла и определение размеров выходного файла в требуемой проекции (DBREPRO).                </li>
              <li>Создание файла с рассчитанными параметрами (CIM, CIMPRO2).</li>
              <li> Трансформация каналов растра из одной проекции в другую (REGPRO, MOSAIC).</li>
            </ol>
            <p> <strong>DBREPRO</strong> – расчет параметров перепроецирования. Данная команда имеет дополнительные параметры, позволяющие вводить ограниченное число проекций для трансформации. Для трансформации в пользовательскую проекцию обычно бывает удобным сначала создать новый сегмент с параметрами проекции с помощью команды PROSET, а затем использовать в параметрах только имя нового сегмента:</p>
            <p> file=" (имя файла)<br />
              project= (оставляем пустым – этот параметр будет замещен информацией из нового сегмента)<br />
              ellips= (оставляем пустым – этот параметр будет замещен информацией из нового сегмента)<br />
              outgeo= (номер нового сегмента с параметрами проекции)<br />
              report=" (вывод параметров трансформации на экран или в файл) </p>
			  <pre>r dbrepro</pre>
            <p>Дополнительно можно указать размер пикселя выходной базы данных (параметры bxpxsz и bypxsz).</p>
              <p> После запуска команды DBREPRO в параметрах EASI сохраняются границы и параметры проекции, в которую Вы хотите перепроецировать Ваши данные. Вы можете воспользоваться командой CIMPRO2 для создания новой базы данных, в которую будет произведена трансформация. Рассчитанные с помощью DBREPRO параметры нового файла будут автоматически использованы командой CIMPRO2. Обратите внимание, чтобы число каналов создаваемого файла соответствовало числу каналов, которые Вы хотите перепроецировать! Другой возможный вариант – вывод параметров в файл (опция report) и обработка файла программой на языке PERL. Этот путь может быть необходим, если Вы, допустим, хотите, что бы новый файл был «привязан» к стандартной растровой сетке.</p>
              <p> После создания нового файла Вы можете произвести трансформацию исходного растра в полученный пустой файл с помощью команды REGPRO.</p>
              <p> <strong>REGPRO</strong> – трансформация растрового изображения.</p>
              <p> fili=" (имя исходного файла)<br />
                dbic= (список каналов для трансформации)<br />
                ingeo= (номер сегмента привязки исходного файла – по умолчанию 1)<br />
                filo=" (имя выходного файла)<br />
                dboc= (список каналов выходного файла)<br />
                outgeo= (номер сегмента привязки выходного файла – по умолчанию 1)<br />
              resample=" (тип пересчета near/bilin/cubic) </p>
			  <pre>r regpro</pre>
            <p>(дополнительные параметры программы смотрите в справочной системе EASI).</p>
              <p> Вместо команды REGPRO для трансформации изображения может использоваться команды MOSAIC. Эта команда всегда будет использовать первые сегменты файлов для расчета параметров трансформации, и пересчет всегда будет производиться методом ближайшего соседа (см. статью 1).</p>
              <p> Пример использования команд для перепроецирования снимка:<br />
                Исходный снимок Landsat имеет проекцию UTM. Мы перепроецируем снимок в проекцию Albers Conical Equal Area с параметрами, настроенными для Европейской России.</p>
              <ol>
                <li>Создаем новый сегмент привязки с параметрами требуемой проекции:<br />
  file="img.pix (имя исходного снимка)<br />
  dbgeo=
                  dbsn="albers (имя проекции)<br />
                ellips="D203 (датум – Пулково 1942)<br />
                prolong="45 (центральный меридиан)<br />
                prolat="0 (широта начала отсчета координат)<br />
                stpar1="52 (1 стандартная параллель)<br />
                stpar2="64 (2 стандартная параллель)<br />
                efalse="8500000 (смещение начала координат на запад)<br />
                nfalse=<br />
                  <pre>r proacea</pre>
                  <br />
                </li>
                <li>Вычисляем параметры трансформации:<br />
  file="img<br />
                  project=<br />
                  ellips=<br />
                  outgeo=2 (новый сегмент с информацией о проекции)<br />
                  report="<br />
                  bxpxsz="28.5 (требуемые размеры пикселя<br />
                  )
                bypxsz="28.5<br />
                <pre>r dbrepro</pre>
                <br />
                </li>
                <li>Создаем новый файл командой CIMPRO2. Все необходимые параметры команды будут прописаны автоматически:<br />
  file="img_alb (имя нового файла)<br />
                  dbnc=3,0,0,0 (число каналов нового файла)<br />
                  dblayout="file (способ хранения каналов)<br />
                 <pre>r cimpro2</pre>
                 <br />
                </li>
                <li> Выполняем трансформацию:<br />
                  fili="img (имя исходного файла)<br />
                  dbic=1,2,3 (список каналов для трансформации)<br />
                  ingeo=
filo="img_alb (имя выходного файла)<br />
dboc=1,2,3 (список каналов выходного файла)<br />
outgeo=
resample="near (тип пересчета)<br />
                <pre>r regpro</pre>
                </li>
              </ol>
              <p><strong><a name="calc" id="calc"></a>Калькулятор координат</strong></p>
            <p> <strong>PROCONV</strong> - простая команда EASI, позволяющая пересчитать координаты из одной проекции (или из географических координат) в другую проекцию (или географические координаты).</p>
            <p> Ввод координат для пересчета обычно осуществляется из тестового файла. Пары координат в текстовом файле разделяются запятыми:<br />
              288804.750,108912.750<br />
              Если вводятся географические координаты, то они могут иметь вид десятичных градусов или градусы-минуты-секунды:<br />
              -20.4560,35.4568 (десятичные градусы)
              <br />
              13 06 07.60 E ,0 59 05.36 N (градусы-минуты-секунды)</p>
            <p> Исходная и выходная проекции могут быть заданы по имеющимся сегментам привязки или как параметр команды (только для LONG/LAT, UTM и State Plane). Пример использования программы с заданием проекции из сегментов привязки:</p>
            <p> file=" (имя файла, содержащего сегменты привязки)<br />
              dbgeo=1,2 (номера сегментов, описывающих входную и выходную проекции)<br />
              tfile=" (имя текстового файла с парами координат)<br />
              ltyp="brief (вывод в короткой форме)<br />
              dmsform="off (если выходные координаты географические, то они будут представлены в десятичных градусах)<br />
              report=" (имя файла для сохранения результата) </p>
			  <pre>r proconv</pre>
              <p>Пример использования команды для пересчета координат с заданием проекции через параметры файла:
file= (пустой)<br />
dbgeo= (пустой)<br />
iunits=lon e012 (исходные координаты – географические)<br />
ounits="utm zone e012 (выходные координаты – UTM)<br />
tfile=" (имя текстового файла с парами координат)<br />
ltyp="brief (вывод в короткой форме)<br />
dmsform="off (если выходные координаты географические, то они будут представлены в десятичных градусах)<br />
report=" (имя файла для сохранения результата)</p>
<pre>r proconv</pre>
            <p><strong><a name="list" id="list"></a>Краткий перечень команд привязки изображений по набору контрольных точек (GCP)</strong></p>
            <p> Расстановка контрольных точек (GCP) для привязки изображения может проводиться как в PCI, так и в других программа. Контрольные точки хранятся в специальном сегменте в файле PCIDSK. Существует возможность загрузки-выгрузки таблицы контрольных точек в текстовый файл. В PCI существуют модули автоматической расстановки контрольных точек (основанные на расчете корреляции между изображениями). Правда, они продаются отдельно от основного пакета программы. Помимо алгоритма с использованием целого исходного снимка для привязки, реализован подход для создания набора модельных участков (image chips) для автоматической привязки. Ниже приведен краткий перечень команд для работы с наборами контрольных точек и автоматической привязки. Трансформация снимка на основе набора контрольных точек производится командой REGPRO (см. выше) или REG. Описание команд смотрите в справочной системе EASI.</p>
            <p> Работа с сегментом контрольных точек (GCP):<br />
              <strong>GCPREAD</strong> – Прочитать набор контрольных точек из текстового файла.<br />
              <strong>GCPWRIT</strong> – Записать набор контрольных точек в текстовый файл.<br />
              <strong>GCPREP</strong> – Вывод описания сегмента контрольных точек.<br />
              <strong>GCPPRO</strong> – Проецирование сегмента контрольных точек в другую проекцию.<br />
              <strong>GCPREFN</strong> – Автоматическое удаление контрольных точек с большой ошибкой.</p>
            <p> Автоматическая расстановка контрольных точек и привязка снимка:<br />
              <strong>AUTOGCP</strong> – Создание набора контрольных точек путем корреляционного анализа.<br />
              <strong>AUTOREG</strong> – Автоматическая ко-регистрация изображений.<br />
              <strong>CHIPEXT</strong> – Создание набора модельных участков на основе привязанного снимка.<br />
              <strong>CHIPMAT</strong> – Автоматический поиск контрольных точек на основе библиотеки модельных участков. </p>
            <p class="discuss">
							<span><!--#include virtual="/scripts/forum-comments-num.php?i=1662"--></span>
			</p>
			<div class="links">
			<h2>Ссылки по теме</h2>
			<ul>
               <li><a href="easi1.html">Основы макроязыка EASI (PCI Geomatica). Часть 1. Управление данными</a></li>
			   <li><a href="easi2.html">Основы макроязыка EASI (PCI Geomatica). Часть 2. Анализ данных</a></li>
			   <li><a href="easi4.html">Основы макроязыка EASI (PCI Geomatica). Часть 4. Примеры автоматизации процессов</a></li>
			</ul>
			</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 15.08.2007
<br>
Автор(ы): Пётр Потапов</span></p>
<!--#include virtual="/inc/footer2.php" -->