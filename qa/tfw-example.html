<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Пример  географической регистрации изображения с помощью world-файла</title><!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Статьи</a></li>
</ul>
<!--Contents start-->
<h1>Пример  географической регистрации изображения с помощью world-файла </h1>
<p class="ann">Разбираем создание world-файла по шагам на примере. </p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=8965"--></span></p>

<p>Эта статья на простом примере иллюстрирует как зарегистрировать географически растровый слой - картинку. В этой статье мы используем термин &quot;зарегистрировать&quot;, а не &quot;привязать&quot;, чтобы учесть некоторое тонкое отличие. Обычно под географической привязкой понимают процесс сбора контрольных точек на изображении и опорных данных. В нашем случае, ничего собирать мы не будем, а просто изучим размеры изображения и зарегистрируем растр с помощью так называемого world-файла. Его устройство подробно рассматривается в <a href="tfw.html">отдельной статье</a>. На самом деле, это не общепринятое терминологическое различие.</p>
<p>Суть работы заключается в создании специального файла регистрации примерно такого вида. Это обычный текстовый файл, который имеет такое же название как картинка и расширение wld. </p>
<table width="217" align="center" bordercolor="#999999" bgcolor="#E6E6E6" height="32">
  <tr>
    <td><p>20.0000000000000<br />
      0.00000000000000<br />
      0.00000000000000<br />
      -20.000000000000<br />
      424178.117<br />
      4313415.907</p></td>
    <td><p>A<br />
      C<br />
      D<br />
      B<br />
      E<br />
      F</p></td>
  </tr>
</table>
<p>Для примера возьмем одну из картинок из набора данных по хлорофиллу (<a href="http://oceancolor.gsfc.nasa.gov/cgi/l3">источник</a>). Эти данные в явном виде не имеют географической привязки. Это означает, что если мы загрузим их в ГИС, то ГИС ничего не будет знать о том, где они находятся на самом деле.</p>
<p>Попробуем (для примера будем использовать свободную ГИС QGIS, но действия дальше могут выполняться и где угодно еще).</p>
<p align="center"><img src="/images/tfw-example-01.gif" width="642" height="466"></p>
<p>Абстрактные координаты 1763,-699 в строке статуса говорят нам, что QGIS не знает где географически находятся наши данные, чтоб обычно означает, что у них отсутствует правильный файл привязки (<a href="qa/proj-sk-faq.html#4">подробнее</a>).</p>
<p>Но мы можем легко узнать на изображении очертания континентов. Как же сделать так, чтобы ГИС показывала правильные координаты и чтобы мы смогли наложить на нее свои, уже привязанные, данные?</p>
<p>Создадим файл привязки.</p>
<p>Для начала поймем каковы размеры растра в пикселях по ширине и высоте или другими словами, сколько у него рядов и колонок. </p>
<p>Чтобы это узнать можно использовать любой графический редактор или мы можем сделать это в самой ГИС. В QGIS для этого достаточно открыть свойства растра. </p>
<p align="center"><img src="/images/tfw-example-02.gif" width="543" height="302"></p>
<p>Информация о свойствах растра говорит, что наш растр шириной 4320 пикселей и высотой 2160. Зная это легко расчитать географический размер пикселя по широте и долготе. Мы предполагаем, что растр на самом деле находится в географической системе координат. </p>
<p>Расчитаем для начала размер пикселя, для этого разделим расстояние по долготе на количество пикселей:</p>
<pre>360/4320 = 0.08333333</pre>
<p>обычно пиксель квадратный, т.е. по широте он должен иметь тоже значение, но пиксель бывает и прямоугольным, поэтому убедимся какого он все-таки размера в нашем случае:</p>
<pre>180/2160 = 0.08333333</pre>
<p>Таким образом, пиксель все-таки квадратный и размер его  0.08333333 на 0.08333333 градуса, что, кстати примерно соответствует разрешению в 1 км.</p>
<p>Итак, первые четыре параметра у нас определились, они выглядят так:</p>
<pre>0.08333333
0.00000000000000
0.00000000000000
-0.08333333
?
?</pre>
<p>Определимся с последними двумя, показывающими привязку верхнего правого пикселя. Судя по тому, что у нас изображение показывающее весь земной шар, то резонно будет предположить, что верхний правый пиксель будет иметь координаты -180 по долготе и 90 по широте. Попробуем их подставить в наш world-файл:</p>
<pre>0.08333333
0.00000000000000
0.00000000000000
-0.08333333
-180
90</pre>
<p>Удалим и перезагрузим растр в QGIS:</p>
<p align="center"><img src="/images/tfw-example-03.gif" width="642" height="466"> </p>
<p>Как видим, координаты приобрели осмысленные значения похожие на широту-долготу. Чтобы окончательно убедиться, что растр зарегистрирован правильно, добавим еще один слой, например береговые линии (bnd-coast-l) из <a href="vmap0.html">VMap0</a>.</p>
<p>Вот как выглядит северная оконечность о-ва Мадагаскар. </p>
<p align="center"><img src="/images/tfw-example-04.gif" width="642" height="466"></p>
<p>Вполне прилично и растр уже можно считать географически зарегистрированным. Но есть еще одно улучшение, которое можно сделать.</p>
<p>Обратим внимание на верхний левый пиксель, для этого наложим какой-нибудь слой, охватывающий весь земной шар, например <a href="/other/grid1dg.zip">разграфку данных SRTM</a> (северные широты в ней также присутствуют).</p>
<p>Вот как это будет выглядеть:</p>
<p align="center"><img src="/images/tfw-example-05.gif" width="642" height="466"></p>
<p>Как можно видеть, растр смещен. Это произошло потому, что привязка world-файлов на самом деле осуществляется к центру пиксела, а не к его вернему левому углу (-180, 90), соответственно, для последних двух значений файла регистрации нужно взять их же, но уменьшенные на половину пикселя:</p>
<pre>180-0.08333333/2 = 179.9583<br>90-0.08333333/2 = 89.95833</pre>
<p>Таким образом результирующий файл регистрации будет таким:</p>
<pre>0.08333333
0.00000000000000
0.00000000000000
-0.08333333
-179.9583
89.95833</pre>
<p>Это окончательно зарегистрирует данные там, где нужно. Вот наш верхний левый угол: </p>
<p><img src="/images/tfw-example-06.gif" width="642" height="466">   </p>
<p>А вот наш Мадагаскар:</p>
<p><img src="/images/tfw-example-07.gif" width="642" height="466"> </p>
<p class="discuss"><span><!--#include virtual="/scripts/forum-comments-num.php?i=8965"--></span></p>
<!-- ссылки -->
<div class="links">
	<h2>Ссылки по теме</h2>
		<ul>
			<li><a href="tfw.html">Формат файла привязки Arcview (world-файл)</a></li>
			</ul>
</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 11.11.2011
<br>
Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=2" target="_blank">Максим Дубинин</a></span></p>
<!--#include virtual="/inc/footer2.php" -->
