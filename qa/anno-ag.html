<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Работа со слоем подписей в ArcGIS</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Работа со слоем подписей в ArcGIS</h1>
<p class="ann">Описание удобного способа работы с подписями (annotations) на карте.</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=949"--></span></p>
<p>Аннотации (annotation) – удобный способ хранения подписей к карте в ArcMap, позволяющий сохранять их на карте не в графическом слое (т.е. непосредственно в проекте), а как картографические объекты. При этом их значительно легче редактировать, перемещать, изменять, привязывать к базовой линии; их можно хранить в географической проекции и подгружать в спроектированный Вид, при этом они будут трансформированы в нужную проекцию «на лету», как и обычные данные. Преимущества такого хранения текстовых данных очевидно. </p>
            <p>Слой аннотаций (annotation layer) можно создать двумя способами – экспортом обычных подписей или непосредственным вводом. И в том и в другом случае начинать работу следует с создания базы геоданных – пакетного файла с расширением . mdb, в котором могут храниться аннотации.</p>
            <p>Для этого необходимо вызвать приложение ArcCatalog (файл-менеджер ГИС-данных, по структуре организованный как Проводник Windows, рис.1) – либо напрямую, через Пуск-Программы-ArcGis-ArcCatalog, либо кнопкой с панели инструментов ArcMap. Затем выбрать нужный каталог слева, щелкнуть правой кнопкой мыши на его имени, выбрать в меню New – Personal Geodatabase. Она появится в окне справа, тут же ее можно переименовать (например <strong>annotation.mdb</strong>, рис.2).</p>
            <p align="center"><img src="../images/anno-ag-01.gif" width="500" height="318" /><br />
              Рис.1. Окно ArcCatalog </p>
            <p align="center"><img src="../images/anno-ag-02.gif" width="285" height="123" /><br />
              Рис.2. Значок базы геоданных</p>
            <p>Вариант 1 – ручной ввод надписей на карту.</p>
            <p>Двойным щелчком нужно открыть только что созданную базу геоданных. Она пуста. Выбираем в меню File-New-Feature class. В появившемся диалоговом окне, будет предложено ввести название класса объектов и его тип (рис.3). Здесь нужно ввести название, отметить &quot;This feature class will store annotation features.....&quot; (нижний) и выбрать в списке ESRI Annotation Feature, поле Alias можно оставить пустым. Перейдите к следующему окну (рис.4). Здесь будет предложено выбрать базовый масштаб слоя подписей, это очень важно, если вы предполагаете, что при масштабе 1 : 5000000 надпись должна быть сделана шрифтом размером 10 пт, то отображаться шрифтом именно этого размера при выводе на экспорт или печать она будет ТОЛЬКО в этом масштабе, в более крупном будет больше, в более мелком – меньше. Map Units надо поменять на метры. Переходим к следующему окну.</p>
            <p align="center"><img src="../images/anno-ag-03.gif" width="495" height="563" /><br />
              <span>Рис. 3. Создание класса объектов Annotation Layer – 1 диалоговое окно</span> </p>
            <p align="center"><img src="../images/anno-ag-04.gif" width="495" height="563" /> <br />
              <span>Рис. 4. Установка базового масштаба Annotation Layer.</span> </p>
            <p align="left">Если все надписи в слое будут одного формата, то можно оставить один Annotation class, изменив только его формат инструментами форматирования текста в середине окна. Но, предположим, в данном случае нужно подписать реки так, чтоб крупные и мелкие объекты были подписаны по разному. В этом случае необходимо создать несколько классов аннотаций при помощи кнопки New… и изменения формата шрифта соответствующего класса (рис.5, - создано 2 класса). В нижней части окна можно задать максимальный и минимальный масштабы, при которых надписи будут отображаться. </p>
            <p align="center"><img src="../images/anno-ag-05.gif" width="495" height="563" /><br />
              Рис.5. Окно редактирования легенды Annotation Layer – создание разных стилей текста для разных объектов </p>
            <p align="left">В следующих двух диалоговых окнах можно все оставить без изменений. Annotation Class создан. Теперь надо задать его систему координат. Для этого в контекстном меню, открывающемся по нажатию правой кнопкой мыши на слое, выбираем Preferences – Fields – поле Shape в списке полей (вверху) – Spatial reference в открывшемся списке свойства поля внизу (рис.6). Для России выбираем систему координат Geographic – Europe – Pulkovo 1942 (или иную в зависимости от  того, какова ваша рабочая система координат).</p>
            <p align="center"><img src="../images/anno-ag-06.gif" width="465" height="581" /><br />
              Рис.6. Установка проекции Annotation Layer </p>
            <p align="left">Добавляем созданный Annotation Layer в проект и переходим в режим его редактирования. Открываем панель инструментов Annotation: View – Toolbars – Annotation (рис. 7). </p>
            <p align="center"><img src="../images/anno-ag-07.gif" width="700" height="60" /><br />
              Рис. 7. Панель инструментов Annotation, подписи см. ниже.</p>
            <ol>
              <li>Инструмент Edit.  При работе с аннотациями следует пользоваться именно им, а не аналогичным инструментом панели Editor</li>
              <li>Кнопки и поле типа расположения текста</li>
              <li>Поле, куда вводится текст надписи </li>
              <li>Поле выбора класса подписи (легенды слоя) </li>
            </ol>
            <p>При ручном вводе подписей работает только расположение текста Curved (текст вдоль кривой). Вводим текст подписи, выбираем нужный класс символа и ведем (рисуем) базовую линию, вдоль которой будет расположен текст (рис. 8).</p>
            <p align="center"><img src="../images/anno-ag-08.gif" width="379" height="340" /><br />
              Рис.8. Подписывание по кривой базовой линии.</p>
            <p>В дальнейшем можно редактировать положение подписи, преобразовывать ее в горизонтальную или прямую наклонную, изменять базовую линию при помощи контекстного меню, вызываемого правой кнопкой мыши на редактируемом объекте. </p>
            <p>Необходимо обратить внимание на редактировании узлов (Sketch) базовой линии. Если предполагается, что впоследствии слой будет экспортирован в графический редактор ( Adobe Illustrator и др.) как текст, а не как кривые, нужно внимательно следить за расположением «рычагов» поворота сегментов линии, у них не должно быть резких отклонений; кроме того, не рекомендуются перегибы линии более 45, максимум 60 градусов. Если не соблюдать эти правила, текст в Adobe Illustrator , весьма вероятно, будет частично «завален» или вообще перевернут. Пример правильного и неправильного форматирования – на рис.9</p>
            <p align="center"><img src="../images/anno-ag-09.gif" width="491" height="221" /><br />
              Рис. 9. Baseline Sketch – слева – корректная, справа – некорректная. Зеленые квадраты – узлы базовой линии, лиловые – «рычаги» поворота сегментов.</p>
            <p align="left">Многие параметры подписи можно изменить, вызвав атрибутивную таблицу Annotation Layer. Если понадобилось изменить параметры подписей какого-либо класса, это можно сделать через свойства Annotation Layer в ArcCatalog.</p>
            <p>Вариант 2 – экспорт подписей из атрибутивной таблицы темы.</p>
            <p>Для создания Annotation Layer на основе атрибутивной таблицы темы, необходимо, чтобы  файл базы геоданных был срздан заранее (<a href="#gbd">описано выше)</a>. Также необходимо сначала подписать объекты темы в обычном режиме – Layer properties – вкладка Labels – установить флажок на Labell All the features …. (рис. 10).</p>
            <p align="center"><img src="../images/anno-ag-10.gif" width="590" height="447" /> <br />
              Рис.10. Подписывание объектов слоя.</p>
            <p align="left">Так как при экспорте в Annotation Layer необходимо, как правило, выведение всех имеющихся подписей, необходимо также выбрать Placement Properites - Conflict Definition и установить флажок Place Overlapping Labels – разрешить перекрывающиеся подписи, рис. 11, потом их можно будет «развести» вручную. Результат – на рис. 12 - подписана тема городов.</p>
            <p align="center"><img src="../images/anno-ag-11.gif" width="390" height="494" /><br />
              Рис 11. Окно свойств расположения подписей, обведен флажок, разрешающий перекрытие подписей.</p>
            <p align="center"><img src="../images/anno-ag-12.gif" width="700" height="608" /><br />
              Рис. 12. Фрагмент окна карты с подписями городов</p>
            <p align="center">&nbsp; </p>
            <p>Правой кнопкой мыши щелкаем на названии подписанной темы и выбираем Convert Labels To Annotation. Появится диалоговое окно, показанное на рис. 13. Необходимо выбрать текущую базу геоданных, нажав на значок, обведенный на рис. 13, и задать имя Annotation Layer. </p>
            <p align="center"><img src="../images/anno-ag-13.gif" width="495" height="471" /><br />
              Рис. 13. Окно конвертации подписей объектов темы в Annotation Layer, обведена кнопка выбора места сохранения.</p>
            <p> После нажатия Convert происходит генерация Annotation Layer (рис. 14). </p>
            <p align="center"><img src="../images/anno-ag-14.gif" width="300" height="260" /><br />
              Рис. 14. Процесс конвертации подписей в Annotation. </p>
            <p align="left">По окончании конвертации в содержании вида появится новый слой, в котором и находятся теперь подписи. Перейдя в ArcCatalog, можно поменять свойства нового слоя, в частности, установить другую легенду (из нескольких классов подписей) и указать проекцию слоя. Эти операции надо производить при закрытом проекте, в который загружен слой, иначе опции настройки слоя будут недоступны.</p>
            <p align="left"> Дальнейшие операции с подписями производятся так же, как и было описано выше, кроме того, можно добавлять и новые подписи.</p>
            <p class="discuss">
				<span><!--#include virtual="/scripts/forum-comments-num.php?i=949"--></span>
			</p>
            <!--#include virtual="/scripts/date.php" --><br>
<p class="status"><span>Дата создания: 07.03.2006
    <br>
    Автор: <a href="/forum/memberlist.php?mode=viewprofile&u=3" target="_blank">Игорь Поспелов</a></span></p>
<!--Contents end-->
<!--#include virtual="/inc/footer2.php" -->
