<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Начало работы с SpatiaLite</title><!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Начало работы с SpatiaLite</h1>
<p class="ann">Краткая аннотация</p>
            <p><strong>Оглавление</strong></p>
            <ol>
              <li><a href="#01">Первый раздел</a></li>
              <li><a href="#02">Второй раздел</a></li>
            </ol>
            <!-- Первый раздел -->
            <p><strong></strong>1. Подготовка </p>
            <p>Это учебное пособие предназначено для быстрого знакомства с SpatiaLite и его возможностями по работе с пространственными данными. Вы не должны быть программистом, системным администратором или администратором базы данных для того чтобы начать работу со SpatialLite [но если вы один из них, он все равно будет полезен]. Учебное пособие пытается избежать использования слишком сложной терминологии и объяснения абсолютно всех деталей обработки пространственных данных SQL и т.д. Задача этого учебного пособия просто провести читателя по шагам знакомства с функциями SpatiaLite и тому, как их использовать. Каждая функция будет объяснена на простом, но реалистичном примере, для иллюстрация используется база данных примера test.db, которую вы можете загрузить с этим примером. </p>
            <p>1.1. Что нужно, чтобы начать </p>
            <p>Предполагается, что Читатель имеет представление о компьютерах, например о том как посмотреть содержимое директории, установить ПО и т.д., знание командной строки так же будет полезно. Дальнейшие примеры иллюстрируют работу в операционной системе Windows, но легко адаптируются и для Linux, MacOS.</p>
            <p>SpatiaLite существует в нескольких разновидностях необходимо выбрать одну из них перед началом.<br />
</p>
            <ol>
              <li>Самый простой способ - использовать выполняемый файл spatialite.exe; он содержит все, что необходимо для начала работы.<br />
                  <ul>
                    <li>spatialite.exe не требует установки.<br />
                    You simply have to create an empty folder (e.g. C:\SpatiaLite)  and just copy the executable file inside; then put the test.db sample database  in the same folder. Now you are ready to start.</li>
                  </ul>
              </li>
              <li>Alternatively, you may wish to load SpatiaLite as a dynamic extension  into the basic, standard sqlite.exe.<br />
                You can do such a thing, but it's a  little harder to do, and you may easily encounter some configuration headache.
                <ul>
                    <li>In order to start using SpatiaLite as a SQLite's loadable extension   you must have the libspatialite-2.dll somewhere on your local hard disk.</li>
                  <li>You need to have the SQLite front end sqlite3.exe as well, and sqlite3.dll  too, in order to use SpatiaLite. Note that you must have a recent version,  with a version number 3.3.6 or higher.<br />
                    If not, please download them at <a href="http://www.sqlite.org/download.html">www.sqlite.org</a><br />
                    Important notice: many SQLite's binary distributions are built disabling the option  to load any dynamic extension; if this is your case, any attempt to load SpatiaLite will  obviously fail.</li>
                  <li>Depending on the configuration you've chosen, others DLL's may be required, such as  the libproj-0.dll, libgeos_c-1.dll and libgeos-3.0.0.dll</li>
                  <li>Neither sqlite3.exe nor libspatialite-2.dll  requires an installation.<br />
                    You simply have to create an empty folder (e.g. C:\SpatiaLite)  and just copy the files inside; put the test.db sample database  in the same folder.</li>
                  <li>It's very easy you'll fall into the DLLs hell; you are warned [and discouraged to do such a thing].<br />
                    Use the spatialite.exe all-included binary instead, and don't involve yourself into this DLLs  nightmare.</li>
                </ul>
              </li>
              <li>If you don't have any GIS tool already installed, may be a  good idea to install the open source QuantumGis;  it can be useful in order to display at a glance the shapefiles   we are going to produce among this tutorial.<br />
                You can download it from <a href="http://www.qgis.org/">www.qgis.org</a>;  it has an ordinary Windows Installer that creates a Desktop icon and so on.</li>
            </ol>
            <p>1.2. База данных test.db</p>
            <p>Пример представлен простой, небольшой, но вполне реальной базой данных содержащей свободные геоданные (<a href="http://www.rigacci.org/wiki/doku.php/tecnica/gps_cartografia_gis/download">www.rigacci.org</a>). База содержит следующие данные:            </p>
            <ol>
              <li><strong>районы</strong> table contains 109 rows; each  entity has a geometry, that is a POLYGON.</li>
              <li><strong>города</strong>  table contains 8101 rows; each  entity has a geometry, that is a POINT.</li>
              <li><strong>дорожная сеть</strong>  table contains 775 rows, ; each   entity has a geometry, that is a LINESTRING.</li>
            </ol>
            <p>1.3. Getting started with SQL and SQLite</p>
            <p>Этот раздел является небольшим быстрым введение в сам SQLite. Более подробную информацию можно найти в официальной <a href="http://www.sqlite.org/sqlite.html">документации по SQLite </a>.
Чтобы начать работать с SQLite, откройне новую командную оболочку (окнос командной строкой),  и перейдите в папку, которую вы создали для работы:</p>
            <p>Для вызова командного интерпретатора (оболочки) наберите:</p>
            <pre>cmd</pre>
            <p>Для смены папки:</p>
            <pre>cd c:\temp\spatiallite</pre>
            <p>Для вызова SQLite наберите следующую команду:</p>
            <pre>sqlite3</pre>
            <p>Вы только запустили свою первую сессию SQLite, которая установила соединение с базой данных test.db. Теперь введите следующие команды: </p>
            <pre>.nullvalue NULL
.headers on
.mode column</pre>
            <p>Чтобы определить, что конкретно значат эти команды, можно ввести:</p>
            <pre>.help</pre>
            <p>Все команды начинающиеся с точки  [.], такие как .mode или .headers интерпретируются SQLite как <em>внутренние команды</em>, а не SQL-выражения, они устанавливают некоторые опции или режимы в SQLite и никак не связаны с обработкой данных. </p>
            <p>Так как мы уже запустили сессию SQLite, мы можем запустить наше первое SQL-выражение:</p>
            <pre>SELECT * FROM towns LIMIT 5;</pre>
            <p align="center"><img src="/images/spatiallite-01.gif" alt="spatiallite" width="639" height="193" /></p>
            <p>Разберем введенную команду:</p>
            <ol>
              <li>операция SELECT просит SQLite выполнить выборку</li>
              <li>и получить все колонки [*]</li>
              <li>FROM из таблицы с названием towns</li>
              <li>retrieving only the first five rows [LIMIT 5]</li>
              <li>note the any SQL statement must end with a semicolon  [;]</li>
            </ol>
            <p>Теперь, попробуем второй SQL-запрос :</p>
            <pre>select name AS Town, peoples as Population from towns ORDER BY name LIMIT 5;</pre>
            <p align="center"><img src="/images/spatiallite-02.gif" alt="spatiallite" width="638" height="120" /> </p>
            <ol>
              <li>в SQL-выражениях, можно использовать команды как в верхнем, так и нижнем регистре; <strong>SELECT</strong> это тоже самое что и <strong>select</strong>, <strong>FROM</strong> равно <strong>from</strong> и т.д.</li>
              <li>you can freely choose which one columns has to be  fetched, determine at your will their order, and even rename then if  you want to do so by using the <strong>AS</strong> clause.</li>
              <li>you can order the fetched rows by using the <strong>ORDER  BY</strong> clause.</li>
            </ol>
            <p>Более сложный запрос будет выглядеть вот так:</p>
            <pre>select name, peoples from towns WHERE peoples &gt; 350000 order by peoples DESC;</pre>
            <p align="center"><img src="/images/spatiallite-03.gif" alt="spatiallite" width="636" height="157" /></p>
            <ol>
              <li>Можно <em>отфильтровать</em> некоторый набор записей используя команду <strong>WHERE</strong>; only those rows that  satisfies the logical expression you specify will be fetched.<br />
              In this example only Towns with a population greater than <strong>350000</strong> peoples has been fetched.</li>
              <li>можно расположить записи <em>в порядке убывания</em> используя команду <strong>DESC</strong>.</li>
            </ol>
            <p>Попробуем использовать другой режим ввода SQL-запросов:</p>
            <pre>select COUNT(*) as '# Towns',<br /> MIN(peoples) as Smaller,<br /> MAX(peoples) as Bigger,<br /> SUM(peoples) as 'Total peoples',<br /> SUM(peoples) / COUNT(*) as 'mean peoples for town'<br /> from towns;</pre>
            <p align="center"><img src="/images/spatiallite-04.gif" alt="spatiallite" width="585" height="121" /></p>
            <ol>
              <li>Сложные запросы можно разделять на несколько; SQLite  начинает выполнять запрос только после того, как он находит строку заканчивающуюся <strong>точкой с запятой</strong> [;]  In other words, until you enter a [;] as the last character in a line,  you are always continuing to type the same query, and  SQLite waits until you have finished to complete the query.</li>
              <li>В запросе можно использовать <strong>функции</strong>.<br />
                  Команды <strong>COUNT()</strong>, <strong>MIN()</strong>, <strong>MAX()</strong> и <strong>SUM()</strong> являются функциями.
                  <ul>
                    <li><strong>COUNT(()</strong> returns the total number of rows.</li>
                  <li><strong>MIN()</strong> returns the minimum value for the given column.</li>
                  <li><strong>MAX()</strong> returns the maximum value for the given column.</li>
                  <li><strong>SUM()</strong> returns the total of all values for the given column.</li>
                </ul>
              </li>
              <li>even more, you can do <strong>calculations</strong> in your query.<br />
                e.g. we have calculated the <strong>mean</strong> of peoples per  village dividing the <strong>SUM()</strong> by the <strong>COUNT()</strong> values. </li>
            </ol>
            <p>note that a valid SQL query may simply consists of <em>expressions</em> and <em>functions</em> to be evaluated:</p>
            <pre>select (10 - 11) * 2 as Number, ABS((10 - 11) * 2) as AbsoluteValue;</pre>
            <p align="center"><img src="/images/spatiallite-05.gif" alt="spatiallite" width="613" height="62" /></p>
            <ol>
              <li><u><em>(10 - 11) * 2</em></u> - пример  <strong>выражения</strong></li>
              <li>функция <strong>ABS()</strong> возвращает  <em>абсолютное значение</em> числа.</li>
              <li>note that in this example we have not used any DB column or  DB table at all.</li>
            </ol>
            <p>now we'll repeat an SQL query we have already performed, but with a small variation:</p>
            <pre>select name, peoples, HEX(GaiaGeometry)<br />    from Towns where peoples &gt; 350000 order by peoples DESC;</pre>
            <p align="center"><img src="/images/spatiallite-06.gif" alt="spatiallite" width="638" height="277" /></p>
            <ol>
              <li>функция <strong>HEX()</strong> возвращает <em>16тиричное </em>представление содержимого поля BLOB .</li>
              <li>в самом первом примере поле <strong>GaiaGeometry</strong> показывалось как пустое; теперь используя функцию <strong>HEX()</strong>, мы видим, что оно содержит много странных данных.<br />
              </li>
              <li><strong>GaiaGeometry</strong><strong> </strong>содержит значения геометрии, хранимые как BLOBы и закодированные в <em>внутреннем представлении </em> используемом SpatiaLite.<br />
                SQLite сама по себе не имеет никакого представления о том, что такое геометрия и не может выполнять с ней никаких операций.<br />
                Чтобы использовать эти данные, нужно использовать расширение SpatiaLite.</li>
            </ol>
            <p>2. Начало работы со SpatiaLite </p>
            <p>Этот раздел демонстрирует самые распространенные операции с над пространственными данными. Для того, чтобы заставить SQLite обрабатывать такие данные, нужно использовать расширение SpatiaLite.<br />
SpatiaLite [произносится как спэйшиал лайт - <em>spatial light</em>] очень простая библиотека, которая поддерживает набор SQL функций согласованных со стандартизованными спецификациями <em>Open Gis Consortium (OGC)</em> для работы с пространственными данными.<br />
If you are interested on this, you can obtain a copy of OGC specification from the <a href="http://www.opengeospatial.org/standards/sfs">OGC web site</a></p>
            <p>2.1 Как загружать SpatiaLite [для пользователей sqlite3]</p>
            <p>Загрузим расширение SpatiaLite:</p>
            <pre>.load SpatiaLite.dll</pre>
            <p>Альтернативный способ загрузить SpatiaLite:</p>
            <pre>SELECT load_extension('libspatialite-2.dll');</pre>
            <p>Если вы используете spatialite.exe, загружать SpatiaLite дополнительно не нужно, он загружается автоматически. </p>
            <p>2.2 Первое знакомство с геометрией</p>
            <p>Еще раз запустим последнее выражение, немного его модифицировав:</p>
            <pre>select name, peoples, AsText(GaiaGeometry)<br />    from Towns where peoples &gt; 350000 order by peoples DESC;</pre>
            <p align="center"><img src="/images/spatiallite-07.gif" alt="spatiallite" width="530" height="158" /></p>
            <ol>
              <li>Функция <strong>AsText()</strong> является одной из функций SpatiaLite,  она возвращает представление данных из поля геометрии в виде <em>Well Known Text - WKT</em>.<br />
                  <strong><em>WKT</em></strong> это название стандартизованное относительно спецификаций <em>OpenGIS</em>.</li>
              <li>В предыдущем исполнении, функция <strong>HEX()</strong> вернула большое количество странных данных.<br />
                Сейчас, <strong>AsText()</strong> показала полезную и легко читаемую информацию о геометрии.<br />
              </li>
              <li>POINT (точка) является простейшим классом геометрии, имеющим только пару координат [<strong>X,Y</strong>].</li>
            </ol>
            <p>Еще раз немного модифицируем запрос:</p>
            <pre>SELECT name, X(GaiaGeometry), Y(GaiaGeometry) FROM Towns<br />     WHERE peoples &gt; 350000<br />     ORDER BY peoples DESC;</pre>
            <p align="center"><img src="/images/spatiallite-08.gif" alt="spatiallite" width="517" height="168" /></p>
            <ol>
              <li>Функция SpatiaLite <strong>X()</strong> возвращает <em>X координату</em> для POINT.</li>
              <li><strong>Y()</strong> возвращает <em>Y координату</em> для POINT.</li>
            </ol>
            <p>Можно использовать следующие функции конвертирующие геометрию:</p>
            <pre>SELECT HEX(GeomFromText('POINT(10 20)'));</pre>
            <p align="center"><img src="/images/spatiallite-09.gif" alt="spatiallite" width="641" height="98" /></p>
            <p>Или:</p>
            <pre>SELECT HEX(AsBinary(GeomFromText('POINT(10 20)')));</pre>
            <p align="center"><img src="/images/spatiallite-10.gif" alt="spatiallite" width="477" height="62" /></p>
            <p>Или, подставив бинарный результат последнего запроса:</p>
            <pre>SELECT AsText(GeomFromWKB(X'010100000000000000000024400000000000003440'));</pre>
            <p align="center"><img src="/images/spatiallite-11.gif" alt="spatiallite" width="639" height="74" /></p>
            <ol>
              <li>Функция <strong>GeomFromText()</strong> возвращает <em>внутреннее BLOB представление</em> геометрии.</li>
              <li>Функция <strong>AsBinary()</strong> возвращает <em>Well Known Binary - WKB</em> представление геометрии, которое также совместимо со спецификациями <em>OpenGIS</em>.</li>
              <li>Функция <strong>GeomFromWKB()</strong> конвертирует значение WKB в <em>внутреннее BLOB представление</em>.</li>
            </ol>
            <p>2.3. Классы геометрии</p>
            <p>Этот раздел описывает различные классы геометрии поддерживаемые SpatiaLite так как они описаны в спецификациях <em>OpenGIS</em>; simply speaking, any GEOMETRY CLASS is a peculiar kind  of GEOMETRY.<br />
You have already met the POINT class in the preceding paragraph;  that's time you'll become accustomed to her sister classes too.</p>
            <p>a simple SQL query to explore a new GEOMETRY class:</p>
            <p>&nbsp;            </p>
            <p>&nbsp;</p>
            <p>&nbsp;</p>
            <p>&nbsp;</p>
            <p>&nbsp;</p>
            <div align="center"><pre class="preoverflowx">ЕслитекствыходитзарамкиЕслитекствыходитзарамкиЕслитекствыходитзарамкиЕслитекствыходитзарамкиЕслитекствыходитзарамки</pre>
        </div>
        <p>&nbsp;        </p>
        <p class="discuss">
			<span><!--#include virtual="/scripts/forum-comments-num.php?i=852"--></span>
		</p>
		<div class="links">
		<h2>Ссылки по теме</h2>
		<ul>
               <li><a href="spatiallite-install.html">Установка SQLite и SpatiaLite для Windows</a></li>
               <li><a href="http://cran.r-project.org/web/packages/rgdal/index.html" target="_blank" class="external">Ссылка на дополнительный источник информации внешняя</a></li>
		</ul>
		</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<!--#include virtual="/inc/footer2.php" -->
