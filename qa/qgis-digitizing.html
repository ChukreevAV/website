<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Векторизация полигональных объектов в QGIS на примере лесных выделов</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Векторизация полигональных объектов в QGIS на примере лесных выделов</h1>
<p class="ann">Методика векторизации сложных полигональных объектов на примере лесных выделов и других объектов.</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=3728"--></span></p>
<p>&copy;<a href="http://www.nextgis.ru/">NextGIS</a>, разрешено для публикации на <a href="/qa/qgis-digitizing.html">GIS-Lab.info</a>. Авторы: Рыков Д.А., Маниша А.?., Дубинин М.Ю. Лицензия: <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Лицензия Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-nd/3.0/80x15.png" /></a></p>
<p>В  статье изложена инструкция по векторизации выделов, в том числе лесопатологических, очагов вредителей и болезней в программе QGIS версии 1.5.0. Порядок векторизации в других программах или в QGIS версии, отличной от 1.5.0, может отличаться от представленного.</p>
<p align="left"><strong>Оглавление</strong></p>
<ul class="empty">
  <li><a href="#1">1 Общие принципы векторизации</a></li>
  <ul>
    <li><a href="#1.1">1.1 Порядок векторизации</a></li>
    <li><a href="#1.2">1.2 Требования к векторизуемым растрам</a></li>
    <li><a href="#1.3">1.3 Топология</a></li>
    <li><a href="#1.4">1.4 Атрибутика и геометрия</a></li>
  </ul>
  <li><a href="#2">2 Процесс векторизации</a></li>
  <ul>
  <li><a href="#2.1">2.1 Добавление в проект векторизуемого растра</a></li>
  <li><a href="#2.2">2.2 Создание нового векторного слоя</a></li>
  <li><a href="#2.3">2.3 Установка масштаба векторизации</a></li>
  <li><a href="#2.4">2.4 Включение режима редактирования</a></li>
  <li><a href="#2.5">2.5 Векторизация</a></li>
  <li><a href="#2.6">2.6 Активирование режима прилипания</a></li>
  <li><a href="#2.7">2.7 Векторизация объектов  низкого уровня</a></li>
  <li><a href="#2.8">2.8 Заполнение атрибутики слоя</a></li>
  <li><a href="#2.9">2.9 Завершение процесса векторизации</a></li>
  </ul>
  <li><a href=#3>3 Проверка корректности результатов и исправление ошибок</a></li>
  <ul>
    <li><a href="#3.1">3.1 Проверка валидности объектов</a></li>
    <li><a href="#3.2">3.2 Проверка топологической корректности</a></li>
    <li><a href="#3.3">3.3 Сопоставление площадей из геометрий и из лесоустройства</a></li>
    <li><a href="#3.4">3.4 Контроль правильности атрибутов</a></li>
  </ul>
  <li><a href="#4">4 Векторизация лесопатологических выделов</a></li>
  <ul>
    <li><a href="#4.1">4.1 Объединение выделов по атрибутам</a></li>
  </ul>
</ul>
<h2><a name="1" id="1"></a>1. Общие принципы векторизации </h2>
<p>В нашем примере векторизация осуществляется в качестве подготовительного этапа для создания карты насаждений с нарушенной устойчивостью и утративших устойчивость насаждений, карт очагов, пространственной интерполяции данных учета численности вредителей, для использования данных дистанционного зондирования. В зависимости от задач векторизуются квартальная сеть, границы выделов, границы лесопатологических выделов, отдельные элементы топографических, почвенных и других карт. Наиболее распространенной задачей является создание карт насаждений с нарушенной устойчивостью, насаждений утративших устойчивость и карт очагов. В зависимости от плотности работ на территории целесообразно проводить векторизацию целых лесничеств (при наземном экспедиционном обследовании, при работе в районах сильно поврежденных определенным ослабляющим фактором или с очагами, охватывающими значительную часть насаждений), отдельных участков в границах лесничеств в которых проводились лесопатологические работы (урочищ), и отдельных кварталов и выделов. К векторизации отдельных выделов лучше прибегать в редких случаях, предпочитая векторизовать сразу крупные участки.</p>
<h3><a name="1.1" id="1.1"></a>1.1 Порядок векторизации</h3>
<p>Процесс векторизации  осуществляется в соответствии с принципом «от большого к малому». Согласно этому принципу, в первую очередь отрисовываются границы более общей единицы (лесхоза), которая после этого разбивается на вложенные полигоны (границы лесничеств). Далее, лесничество, в свою очередь, разрезается на кварталы, а кварталы на выделы.</p>
<p align="center"><img src="../images/qgis-digitizing-01.png"></p>
<p>Если граница между лесхозами проходит по границе соседних субъектов федерации, то в этом случае оба таких лесхоза обязательно должны быть состыкованы с этой границей. В противном случае могут возникнуть топологические ошибки (щели или перехлесты). В связи с чем, для работы необходимо  иметь слой административного деления РФ.</p>
<p>Границу соседних лесхозов следует рисовать по привязанным растрам планов их лесонасаждений. Если загрузив оба растра, невооруженным глазом видно, что граница одного лесхоза не совпадает с границей другого, то это говорит о том, что как минимум один из растров привязан не правильно. В этом случае необходимо перепривязать растры таким образом, чтобы границы лесхозов находились максимально близко друг к другу.</p>
<p>Наиболее сложной является ситуация, когда существует растровый план лесонасаждений одного из соседствующих лесхозов, в то время как план второго отсутствует. В этом случае приступать к векторизации можно только в случае 100% уверенности, что цифруемый растр привязан верно. Иначе все усилия могут быть потрачены впустую. Когда же появится растр на соседний лесхоз (также качественно привязанный), то оцифровав его, не забудьте «сбить» границы векторного слоя с соседним. Как это делается - будет показано позже.</p>
<h3><a name="1.2" id="1.2"></a>1.2 Требования к векторизуемым растрам</h3>
<p>На заре ГИС, пользователями, создающими данные (особенно начинающими) относительно мало внимания уделялось их системе координат. Зачастую, отсканированные материалы, минуя процесс географической привязки сразу отправлялись на оцифровку, такое явление нередко и в наши дни и является типичной ошибкой начинающих пользователей. Результатом такого подхода обычно являются данные, не имеющие географической системы координат.</p>
<p>Векторизацию имеет смысл осуществлять только для качественно привязанных растров. Если же растр будет не привязан или привязан не качественно, то оцифрованный по нему векторный слой не будет представлять никакой ценности, его невозможно будет наложить на другие - привязанные данные. Кроме того, его нельзя будет трансформировать в другую систему координат, по нему невозможно производить вычисления длин, углов, площадей, координат объектов и т. д.</p>
<p>Конечно существуют методики, позволяющие привязать и векторные данные, но это довольно сложный процесс и не всегда дающий необходимый результат, поэтому не стоит на него полагаться.</p>
<h3><a name="1.3" id="1.3"></a>1.3 Топология</h3>
<p>При векторизации растровых данных могут возникать так называемые ошибки топологии. В случае полигональных объектов наиболее часто встречаются ошибки двух видов - это щели и перехлесты.</p>
<p>Перехлест возникает в случае, когда некоторая область принадлежит одновременно нескольким полигонам:</p>
<p align="center"><img src="../images/qgis-digitizing-02.png"></p>
<p>Щели же образуются при не полном совпадения границ соседних полигонов:</p>
<p align="center"><img src="../images/qgis-digitizing-03.png"></p>
<p>Допустим, что в перехлест попали два соседних квартала. В этом случае становится невозможным однозначно ответить на вопрос какому кварталу принадлежит область перекрытия.</p>
<p>Щели также противоречат логике разбиения лесничества на кварталы, в соответствии с которой каждая область лесничества должна однозначно идентифицировать квартал, в который она попадает.</p>
<p>Пример фрагмента топологически корректного полигонального слоя:</p>
<p align="center"><img src="../images/qgis-digitizing-04.png"></p>
<p><strong>Важно:</strong> При векторизации необходимо тщательно отслеживать появление вышеописанных ошибок и избегать их. Поскольку исправление этих ошибок очень сложно автоматизировать, то зачастую приходится все исправлять вручную. Работа  по исправлению порой бывает сравнима по времени с работой, затраченной на саму векторизацию.</p>
<h3><a name="1.4" id="1.4"></a>1.4 Атрибутика и геометрия</h3>
<p>Процесс создания векторного слоя зачастую разделяют на две части: отрисовку контуров (геометрических объектов) и наполнение атрибутивной таблицы. Такой подход очень удобен в тех случаях, если какие-то из полей редактируемого слоя содержат одинаковые данные (например, при отрисовке кварталов внутри лесничества значение поля, содержащего название лесничества, будет одинаковым для всех записей). Такие поля можно заполнить автоматически с помощью калькулятора полей по завершению отрисовки геометрий, а не делать это каждый раз по окончанию их ввода.</p>
<h2><a name="2" id="12"></a>2. Процесс векторизации</h2>
<p>Рассмотрим процесс векторизации кварталов на основе предварительно привязанного растрового плана лесонасаждений, находящегося в географической системе координат.</p>
<h3><a name="2.1" id="1.5"></a>2.1 Добавление в проект векторизуемого растра</h3>
<p>Откройте геопривязанный растр, который необходимо векторизовать. Для этого на панели инструментов нажмите кнопку <strong>Добавить растровый слой</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-05.png"></p>
<p>После чего в выпадающем списке укажите его тип и выберите необходимый файл:</p>
<p align="center"><img src="../images/qgis-digitizing-06.png"></p>
<p>Выбранный растр появится в рабочей области QGIS:</p>
<p align="center"><img src="../images/qgis-digitizing-07.png"></p>
<h3><a name="2.2" id="1.6"></a>2.2 Создание нового векторного слоя</h3>
<p>На панели инструментов нажмите кнопку <strong>Новый векторный слой</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-08.png"></p>
<p>В открывшемся окне выберите тип создаваемого слоя. При векторизации лесонасаждений чаще всего используется полигональный тип:</p>
<p align="center"> <img src="../images/qgis-digitizing-09.png" alt=""></p>
<p>Далее необходимо определить атрибутивную таблицу. В области настройки свойств поля задайте его имя, оно не должно превышать 10 символов. В случае превышения этого порога лишние символы будут отброшены. Затем выберите тип поля. При создании векторного слоя доступно три типа: Текст, Целое число и Десятичное число.</p>
<p>Текстовый тип рекомендуется использовать для тех полей, в которых планируется хранение всевозможных названий, адресов, комментариев и т. д., вообщем строк, в которых одновременно могут использоваться всевозможные алфавитно-цифровые символы. Максимальный размер текстового поля составляет 255 символов. Если заранее неизвестно, в каком формате будут храниться данные, то для таких полей рекомендуется использовать строковый тип. </p>
<p>Целочисленный тип поля как следует из названия используется для хранения данных, представленных целыми числами. Данный тип может быть использован, например, для хранения информации о номерах кварталов. Охват данного типа: -999 999 999 … 999 999 999.</p>
<p>И, наконец, десятичный тип используется для хранения данных, представленных дробным числом - например, для хранения информации о площадях объектов. При выборе этого типа становится активным текстовое поле <strong>Точность</strong>, в котором можно указать количество значащих символов после запятой. Отметьте, что <strong>Размер</strong> в этом случае складывается из размера целой части и размера дробной части плюс 1 (разделитель дробной и целой частей). То есть, размер числа 123,321 равен 7.</p>
<p>После того, как были заданы имя, тип и размер поля, его следует добавить в атрибутивную
  таблицу. Для этого нажмите кнопку:</p>
<p align="center"><img src="../images/qgis-digitizing-10.png"></p>
<p>Для удаления поля из таблицы выберите его и нажмите кнопку:</p>
<p align="center"><img src="../images/qgis-digitizing-11.png"></p>
<p>Создадим таблицу, содержащую 5 полей: NOMLESN – номер лесничества, NOMKVR – номер квартала, NOMLESX – номер лесхоза, NAMELESX – название лесхоза, NAMELESN – название лесничества.</p>
<p align="center"><img src="../images/qgis-digitizing-12.png"></p>
<p>После того, как структура атрибутивной таблицы была определена, нажмите кнопку <strong>OK</strong> и в открывшемся окне укажите имя и путь до создаваемого слоя.</p>
<h3><a name="2.3" id="1.7"></a>2.3 Установка масштаба векторизации</h3>
<p>Определите и установите масштаб векторизации. Он должен быть не меньше рабочего масштаба на котором в дальнейшем будет производится работа с векторным слоем. Рекомендуемые масштабы векторизации:</p>
<div align="center">
  <table width="85%" align="center">
    <tr>
      <th>Масштаб исходного растра</th>
      <th>Масштаб оцифровки</th>
    </tr>
    <tr>
      <td><p align="center">1: 10 000</p></td>
      <td><p align="center">Не менее 1:2 000</p></td>
    </tr>
    <tr>
      <td><p align="center">1: 25 000</p></td>
      <td><p align="center">Не менее 1: 5 000</p></td>
    </tr>
    <tr>
      <td><p align="center">1: 50 000</p></td>
      <td><p align="center">Не менее 1: 10 000</p></td>
    </tr>
  </table>
</div>
<p>Выбранный масштаб необходимо указать на панели состояния, при этом он не должен уменьшаться в процессе векторизации.</p>
<p align="center"><img src="../images/qgis-digitizing-13.png"></p>
<p>При векторизации мелких объектов бывает необходимым увеличить масштаб. Это очень удобно делать без отрыва от инструмента отрисовки простым вращением колесика мыши. Если границы отрисовываемого объекта не входят в экран, в этом случае изображение может быть сдвинуто с помощью клавиш стрелок, расположенных на клавиатуре.</p>
<h3><a name="2.4" id="1.8"></a>2.4 Включение режима редактирования</h3>
<p>Для создания нового или редактирования имеющегося слоя необходимо включить режим редактирования. Для этого на панели инструментов нажмите кнопку:</p>
<p align="center"><img src="../images/qgis-digitizing-14.png"></p>
<p>При включенном режиме редактирования отображаются узлы объектов слоя. Перетягивая эти узлы на новое место, можно изменять форму объектов. Также можно воспользоваться специальными инструментами редактирования для перемещения, копирования или удаления объектов целиком.</p>
<p align="center"><img src="../images/qgis-digitizing-15.png"></p>
<h3><a name="2.5" id="1.9"></a>2.5 Векторизация</h3>
<p>Приступим непосредственно к векторизации. Согласно принципу «от большого к малому» отрисуем прежде всего границу лесничества. Для этого:</p>
<ol>
  <li>В списке слоев выберите редактируемый слои и на панели инструментов нажмите кнопку <strong>Создать полигон</strong>:<br>
      <div align="center"><img src="../images/qgis-digitizing-16.png"></div>
  </li>
  <li>Последовательно щелкая левой клавишей мыши по вершинам границы лесничества, отрисуем ее контур. Отмена ошибочно введенной вершины осуществляется клавишей <strong>Backspace</strong>.</li>
  <li>По достижению последней вершины — щелкните не левой, как до этого, а правой кнопкой мыши — это будет признак окончания ввода объекта.</li>
</ol>
<p align="center"><img src="../images/qgis-digitizing-17.png"></p>
<p>После завершения ввода полигона появится окно, в котором предлагается заполнить поля таблицы атрибутов для вновь созданного объекта:</p>
<p align="center"><img src="../images/qgis-digitizing-18.png"></p>
<p>Как уже было отмечено ранее процесс отрисовки границ и наполнения атрибутивной таблицы данными следует разнести во времени. В появившемся окне нажмите кнопку <strong>ОК</strong>, а затем перейдите в меню <strong>Установки - Параметры - Оцифровка</strong> и отметьте следующий пункт:</p>
<p align="center"><img src="../images/qgis-digitizing-19.png" alt=""></p>
<p>Больше окно с предложением заполнить атрибутику не появится.</p>
<p>Чтобы отрисованный векторный слой полностью не перекрывал растровую подложку рекомендуется включить прозрачность. Правый щелчок мыши на имени слоя в таблице слоев  - <strong>Свойства  - Символика</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-20.png"></p>
<h3><a name="2.6" id="1.10"></a>2.6 Активирование режима прилипания</h3>
<p>Во избежании топологических ошибок обязательно следует использовать возможность прилипания – автоматического совмещения узлов объектов при редактировании. Можно задать один из трех режимов: к вершинам, к сегментам, к вершинам и сегментам. Помимо этого следует установить порог прилипания. Режим и порог прилипания работают следующим образом: при подведении курсора мыши на определенное расстояние (порог прилипания) от сегмента или вершины (в зависимости от режима прилипания), рисуемая линия автоматически продолжается до касания с ближайшим сегментом или вершиной. На рисунке представлен пример использования различных режимов прилипания:</p>
<p align="center"><img src="../images/qgis-digitizing-21.png"><br>
  Режимы прилипания (большой кружок – вершины существующей линии, маленький – последняя вершина создаваемой линии): а) к сегменту, б) к вершине</p>
<p>Для настройки прилипания выберите <strong>Установки - Свойства проекта - Общие</strong> и нажмите кнопку <strong>Параметры прилипания</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-22.png"></p>
<p>В открывшемся окне отметьте редактируемый слой и установите для него параметры прилипания. Рекомендуется использовать режим прилипания к сегментам и вершинам, порог прилипания подбирается индивидуально в каждом случае в зависимости от размера векторизуемого объекта и текущего масштаба. Если в ходе работы возникнут сложности с текущим порогом прилипания, его в любой момент можно уменьшить. Также рекомендуется единицы порога прилипания устанавливать в пикселях.</p>
<p align="center"><img src="../images/qgis-digitizing-23.png"></p>
<h3><a name="2.7" id="1.11"></a>2.7 Векторизация объектов  низкого уровня</h3>
<p>После того как была отрисована граница лесничества и настроены параметры прилипания, согласно принципу «от большого к малому» следует переходить к отрисовки объектов более низкого уровня — кварталов.</p>
<p>На этом и всех последующих этапах мы больше не будем рисовать полигоны, а будем только разбивать их на более мелкие части с помощью инструмента <strong>Разбить объекты</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-24.png"></p>
<ol>
  <li>В списке слоев выберите редактируемый слой и нажмите кнопку <strong>Разбить объекты</strong>;</li>
  <li>Щелкните курсором возле точки пересечения любой из границ квартала с границей лесничества на расстоянии, большим, чем порог прилипания:<br>
      <div align="center"><img src="../images/qgis-digitizing-25.png"><br>
        Исходное положение при разбивке объектов</div>
  </li>
  <li>«Прилипните» к границе лесничества в точке пересечения ее и границы квартала и щелкните левой кнопкой мыши:<br>
      <div align="center"><img src="../images/qgis-digitizing-26.png"><br>
        Прилипание к уже векторизованной границе</div>
  </li>
  <li>Последовательно щелкая по границам кварталов, в конечном итоге «прилипните» к одной из границ лесничества и снова щелкните левой кнопкой:<br>
      <div align="center"><img src="../images/qgis-digitizing-27.png"><br>
        Окончание разбивки</div>
  </li>
  <li>Переместите курсор за границу лесхоза на расстояние, большее чем порог прилипания и нажмите правую кнопку мыши.</li>
</ol>
<p>Таким образом мы отрезали небольшой кусок от исходного полигона. Повторяя данные действия, можно векторизовать все кварталы.</p>
<p>В конечном итоге должен получиться слой следующего вида:</p>
<p align="center"><img src="../images/qgis-digitizing-28.png"></p>
<h3><a name="2.8" id="1.12"></a>2.8 Заполнение атрибутики слоя</h3>
<p>После того, как геометрическая составляющая слоя была создана, необходимо провести ее атрибутивное наполнение.</p>
<p>Выберите <strong>Установки - Параметры - Общие</strong> и отметьте следующий пункт:</p>
<p align="center"><img src="../images/qgis-digitizing-29.png"></p>
<p>В списке слоев выберите создаваемый слой и убедитесь, что он открыт на редактирование. На панели инструментов нажмите кнопку:</p>
<p align="center"><img src="../images/qgis-digitizing-30.png"></p>
<p>Откроется атрибутивная таблица слоя. Отметьте пункт <strong>Показать только выбранные записи</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-31.png"></p>
<p>Затем с помощью инструмента:</p>
<p align="center"><img src="../images/qgis-digitizing-32.png"></p>
<p>выберите один из кварталов, атрибутивная таблица примет вид:</p>
<p align="center"><img src="../images/qgis-digitizing-33.png"></p>
<p>Значение NULL свидетельствует о том, что данные поля не заполнены. Заполните их нужными данными.</p>
<p><strong>Замечание 1</strong></p>
<p>Если какое-либо из полей атрибутивной таблицы для каждой записи имеет одинаковое значение, то для заполнения таких полей удобней всего воспользоваться калькулятором полей. Покажем как таким способом можно заполнить поле «NAMELESX» значением «Правдинский лесхоз».</p>
<p>Откроем атрибутивную таблицу слоя.</p>
<p align="center"><img src="../images/qgis-digitizing-34.png"></p>
<p>Нажмем кнопку <strong>Калькулятор полей</strong>. Чтобы эта кнопка была активна, режим редактирования слоя должен быть включенным. В открывшемся окне отметим пункт <strong>Обновить существующее поле</strong> и в выпадающем списке выберем поле «NAMELESX». В поле <strong>Выражение</strong> введем строку 'Правдинский лесхоз' (не забывайте про одинарные кавычки!):</p>
<p align="center"><img src="../images/qgis-digitizing-35.png"></p>
<p>Поле нажатия кнопки <strong>OK</strong>, атрибутивная таблица будет выглядеть следующим образом:</p>
<p align="center"><img src="../images/qgis-digitizing-36.png"></p>
<p><strong>Замечание 2</strong></p>
<p>При разбиении полигона на части инструментом <strong>Разбить объекты</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-37.png"></p>
<p>атрибутика разбиваемого полигона полностью переносится на вновь созданный.</p>
<p><strong>Замечание 3</strong></p>
<p>Зачастую имеются уже готовые векторные слои или всевозможные таблицы или файлы баз данных, содержащих атрибутивную информацию о векторизуемых объектах (таксационной характеристики, ведомости лп-таксации), позволяющие заполнить атрибутивную информацию создаваемого слоя в автоматическом режиме. Покажем как это делается.</p>
<p>Для присоединения атрибутивных данных одного shape-файла к другому или *.dbf таблицы к shape файлу служит инструмент <strong>Объединение атрибутов</strong>.</p>
<p>Выберите <strong>Инструменты - Управление данными - Объединение атрибутов</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-38.png"></p>
<p>Выберите целевой слой и слой (или *.dbf файл), атрибуты которого необходимо присоединить к целевому слою. Укажите поля, по которым будет производиться сравнение (<strong>должны быть одинакового типа — текстового или числового</strong>), отметьте пункт <strong>Сохранять все записи (включая не совпадающие)</strong>. Укажите имя результирующего shape- файла и нажмите <strong>OK</strong>.</p>
<p>Операция часто применяется при присоединении к слоям выделов и очагов таксации и лесопатологической таксации. Для корректного объединения и в слое и в таблице необходимо уникальное поле ключ. Dbf файл для объединения может быть получен экспортом из программы Excel или Access.</p>
<h3><a name="2.9" id="1.13"></a>2.9 Завершение процесса векторизации</h3>
<p>После того, как все контуры были отрисованы и заполнена атрибутика выключите режим редактирования кнопкой:</p>
<p align="center"> <img src="../images/qgis-digitizing-39.png"></p>
<p>В открывшемся окне нажмите <strong>Сохранить</strong>. На этом процесс векторизации закончен.</p>
<h2><a name="3" id="13"></a>3. Проверка корректности результатов и исправление ошибок</h2>
<p>Исправление ошибок — не тривиальный и довольно трудозатратный процесс, поэтому рекомендуется избегать ошибок еще в процессе векторизации. Однако это не всегда удается, поэтому необходимо быть готовым исправлять найденные ошибки. Рассмотрим некоторые наиболее часто встречающиеся ошибки.</p>
<h3><a name="3.1" id="3.1"></a>3.1 Проверка валидности объектов</h3>
<p>В первую очередь необходимо проверять геометрические объекты слоя на валидность, то есть на соответствие их форм определенным правилам, закрепленным в стандарте (OpenGIS® Implementation Specification for Geographic information - Simple feature access - Part 1: Common Architecture).</p>
<p>Для этого в QGIS есть специальный инструмент <strong>Проверка геометрии</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-40.png"></p>
<p>В окне инструмента выберите имя проверяемого слоя и нажмите <strong>OK</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-41.png"></p>
<p>Как видно из рисунка, в обработанном слое содержится один невалидный полигон, так как согласно стандарту полигон не должен иметь самопересечений. Находим этот объект на карте:</p>
<p align="center"><img src="../images/qgis-digitizing-42.png"></p>
<p>Открываем слой на редактирование и с помощью инструмента <strong>Редактирование узлов</strong>:</p>
<p align="center"> <img src="../images/qgis-digitizing-43.png"> </p>
<p>устраняем данное самопересечение:</p>
<p align="center"><img src="../images/qgis-digitizing-44.png"></p>
<p>Снова запускаем инструмент <strong>Проверка геометрии</strong> и убеждаемся, что ошибка исправлена:</p>
<p align="center"><img src="../images/qgis-digitizing-45.png"></p>
<p>Исправление формы отдельно стоящего полигона — не сложная задача, однако на практике полигон часто окружен другими объектами, что значительно усложняет процесс исправления, поэтому при векторизации слоя время от времени отключайте режим редактирования, сохраняйте изменения и проверяйте слой на валидность.</p>
<h3><a name="3.2" id="1.14"></a>3.2 Проверка топологической корректности</h3>
<h4><strong><a name="3.2.1" id="1.16"></a>3.2.1 Щепки</strong></h4>
<p>Следующие полигоны на первый взгляд выглядят вполне корректно:</p>
<p align="center"><img src="../images/qgis-digitizing-46.png"></p>
<p>Однако если увеличить слой в обведенной области, можно наблюдать следующую картину:</p>
<p align="center"><img src="../images/qgis-digitizing-47.png"></p>
<p>Данный полигон не является каким-либо объектом лесного хозяйства, а результат ошибки, так называемая «щепка». Конечно, вручную просматривать каждые места пересечения границ полигонов на предмет выявления щепок — непосильная задача, поэтому данный процесс можно автоматизировать. Главный признак щепок — это их малая площадь, поэтому будем поступать следующим образом. Добавим в атрибутивную таблицу слоя новое поле, содержащее значение площади объекта, затем отсортируем их по возрастанию и проверим на наличие щепок все объекты с маленькой площадью. Для этого откроем атрибутивную таблицу слоя, включим режим редактирования и запустим <strong>Калькулятор полей</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-48.png"></p>
<p>Создадим новое поле 'Area' типа real размером 20 и точностью 5 и нажмем кнопку площадь. Нажимаем OK – новое поле со значениями площадей объектов слоя будет добавлено в таблицу атрибутов:</p>
<p align="center"><img src="../images/qgis-digitizing-49.png"></p>
<p>Отсортируем таблицу поле 'Area' по возрастанию и убедимся в том, что объект с наименьшей площадью — действительно щепка (таких объектов может быть несколько).</p>
<p>Покажем как бороться со щепками. Очевидно, что площадь щепки должна принадлежать как минимум одному из окружающих ее объектов, допустим, одному. Включаем слой на редактирование и с помощью инструмента <strong>Выбрать объекты</strong>:</p>
<p align="center"><strong> <img src="../images/qgis-digitizing-50.png"></strong> </p>
<p>выделяем щепку и объект, к которому она должна быть присоединена:</p>
<p align="center"><strong><img src="../images/qgis-digitizing-51.png"></strong></p>
<p>Нажимаем кнопку <strong>Объединить выбранные объекты</strong>:</p>
<p align="center"> <strong><img src="../images/qgis-digitizing-52.png"></strong></p>
<p>Появляется диалоговое окно:</p>
<p align="center"><strong><img src="../images/qgis-digitizing-53.png"></strong></p>
<p>В таблице отмечаем объект,к которому мы хотим присоединить щепку и нажимаем кнопку <strong>Использовать атрибуты выбранного объекта</strong>. Жмем <strong>OK</strong> и получаем:</p>
<p align="center"><strong><img src="../images/qgis-digitizing-54.png"></strong></p>
<p>От щепки мы избавились, дальнейшее переконфигурирование форм полигонов выполняется стандартными средствами.</p>
<p>Если площади щепки одновременно принадлежит двум окружающим ее объектам, то в этом случае можно поступить следующим образом. Выделяем и удаляем щепку инструментом <strong>Удалить выделенное</strong>:</p>
<p align="center"> <strong><img src="../images/qgis-digitizing-55.png"></strong></p>
<p align="center"><strong><img src="../images/qgis-digitizing-56.png"></strong></p>
<p>Включаем режим топологического редактирования (<strong>Установки - Свойства проекта - Общие - Включить топологическое редактирование</strong>) и перемещаем узел:</p>
<p align="center"><strong><img src="../images/qgis-digitizing-57.png"></strong></p>
<p>В итоге мы избавились от щепки:</p>
<p align="center"><strong><img src="../images/qgis-digitizing-58.png"></strong></p>
<p><strong><a name="3.2.2" id="1.17"></a>3.2.2 Топологическое изменение границы</strong></p>
<p>При изменении общей границы нескольких полигонов во избежании возникновения щелей необходимо использовать режим топологического редактирования. Допустим, нам необходимо изменит общую границу следующих полигонов:</p>
<p align="center"><strong><img src="../images/qgis-digitizing-59.png"></strong></p>
<p>Включаем режим топологического редактирования (<strong>Установки - Свойства проекта - Общие - Включить топологическое редактирование</strong>):</p>
<p align="center"><strong><img src="../images/qgis-digitizing-60.png"></strong></p>
<p>И с помощью инструмента <strong>Редактирование узлов</strong>:</p>
<p align="center"> <strong><img src="../images/qgis-digitizing-61.png"></strong> </p>
<p>меняем форму границы:</p>
<p align="center"><strong><img src="../images/qgis-digitizing-62.png"></strong></p>
<p><strong><a name="3.2.3" id="1.18"></a>3.2.3 Щели</strong></p>
<p align="center"><strong><img src="../images/qgis-digitizing-63.png"></strong></p>
<p>Для устранения щелей настройте прилипание к вершинам с некоторым порогом, например, в 40 пикселей (см. шаг 6 п.2). С помощью инструмента <strong>Редактирование узлов:</strong></p>
<p align="center"><strong> <img src="../images/qgis-digitizing-64.png"></strong></p>
<p> добейтесь одинакового количества узлов на противоположных сторонах щели (двойной щелчок на ребре добавляет узел):</p>
<p align="center"><strong><img src="../images/qgis-digitizing-65.png"></strong></p>
<p>И все с помощью того же инструмента:</p>
<p align="center"> <strong><img src="../images/qgis-digitizing-66.png"></strong> </p>
<p>последовательно присоедините соответствующие узлы друг к другу:</p>
<p align="center"><strong><img src="../images/qgis-digitizing-67.png"></strong></p>
<p><strong><a name="3.2.4" id="1.19"></a>3.2.4 Перехлесты</strong></p>
<p>Для работы с перехлестами необходимо включить прозрачность слоя:</p>
<p align="center"><strong><img src="../images/qgis-digitizing-68.png"></strong></p>
<p>Как и в случае со щелями настройте прилипание и добейтесь одинакового количества узлов на противоположных границах перехлеста:</p>
<p align="center"><strong><img src="../images/qgis-digitizing-69.png"></strong></p>
<p>Последовательно соединяя соответствующие узлы, избавьтесь от перехлеста.</p>
<h3><a name="3.3" id="1."></a>3.3 Проверка корректности векторизации через сопоставление площадей из геометрии и из лесоустройства</h3>
<p>Суть метода проста: нужно сравнить площади выделов, получившиеся у вас после векторизации с площадью выделов, указанных в таксационных описаниях. Для выделов, расхождение в площади у которых более 10%, нужно сделать визуальную проверку.</p>
<h3><a name="3.4" id="1.15"></a>3.4 Контроль правильности атрибутов</h3>
<p>Для проверки того, что в процессе формирования атрибутики соседним областям (например, лесничествам или кварталам) не был по ошибки присвоен одинаковый признак, существует достаточно простой визуальный метод.</p>
<p>Откройте векторизованный слой лесоустройства. В окне <strong>Свойства слоя</strong> перейдите на вкладку <strong>Символика</strong>. Выберите <strong>Тип легенды</strong> <strong>- Уникальное значение</strong> и в <strong>Поле классификации</strong> выберите поле атрибутивной таблицы, корректность которого вы хотите проверить (в примере — поле NOMKVR, соответствующее номеру квартала). Нажмите кнопку <strong>Классифицировать</strong>, а затем <strong>OK</strong>.</p>
<p align="center"><strong><img src="../images/qgis-digitizing-70.png"></strong></p>
<p>Слой будет выглядеть следующим образом:</p>
<p align="center"><strong><img src="../images/qgis-digitizing-71.png"></strong></p>
<p>Внимательно изучите данный слой на предмет отсутствия соседних полигонов с одинаковыми цветами. Последнее соответствует случаю, когда разным кварталам проставлены одинаковые номера.</p>
<p>Отдельные неправильно пронумерованные полигоны вы таким образом можете и пропустить, но если ошибка носит массовый характер, вы ее непременно заметите.</p>
<p>Другую возможную ошибку, когда в номер квартала у вас вкрадывается ошибка, проверить еще проще. Нужно использовать классификацию по уникальным значениям и выбрать классификацию по полю с номером квартала. В таком варианте все выделы в пределах одного квартала получат один и тот же цвет. Если какой-то то выдел имеет неправильный номер квартала, он будет резко выделяться на фоне других.</p>
<p align="center"><strong><img src="../images/qgis-digitizing-72.png"></strong></p>
<h2><a name="4" id="1.20"></a>4 Векторизация лесопатологических выделов</h2>
<p>Координаты мест, в которых наблюдаются нарушения леса могут быть получены в ходе полевых работ с помощью GPS приемника. Однако зачастую размеры лесопатологических зон настолько велики, что обойти их границы не представляется возможным. В этом случае для полного описания лесопатологических выделов необходимо привлечение данных дистанционного зондирования. То есть, имея координаты места наблюдения нарушения и дату наблюдения, можно подобрать снимок по которому полностью определить размер и границы нарушений</p>
<p align="center"><img src="../images/qgis-digitizing-73.png"></p>
<p>Рассмотрим, как имея векторный слой лесоустройства и нанесенный по космическому снимку слой пожаров (или других нарушений), получить слой лесопатологических выделов.</p>
<p>Лесоустройство с нанесенными номерами выделов:</p>
<p align="center"><img src="../images/qgis-digitizing-74.png"></p>
<p>Совместим слой лесоустройства с границей оцифрованной по спутниковому снимку лесопатологической зоны:</p>
<p align="center"><img src="../images/qgis-digitizing-75.png"></p>
<p>Сформируем слой участков выделов, подвергшихся пожару. Для этого воспользуемся инструментом <strong>Пересечение</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-76.png"></p>
<p>В открывшемся окне укажем следующее:</p>
<p align="center"><img src="../images/qgis-digitizing-77.png"></p>
<p>Нажимаем OK. Получаем слой лесопатологических выделов:</p>
<p align="center"><img src="../images/qgis-digitizing-78.png"></p>
<p>Отметим, что вся атрибутика слоя границ пожара была присоединена к данному слою.</p>
<p>Исходя из значения точности привязки (векторизации) для выделов площадью менее 2 Га невозможно однозначно определить являются ли они ЛП или нет. Поэтому, после проведения вышеописанной процедуры получения слоя лесопатологических выделов необходимо исследовать каждый выдел на предмет определения его площади и удалить из слоя все полигоны, площадь которых менее 2 Га.</p>
<h3><a name="4.1" id="4.1"></a>4.1 Объединение выделов по атрибутам</h3>
<p>Одной из наиболее распространенных задач является объединение объектов векторного слоя по признаку. Например, объединение ЛП-выделов в один большой выдел в пределах квартала. Рассмотрим пример.</p>
<p>Откроем слой лесопатологических выделов:</p>
<p align="center"><img src="../images/qgis-digitizing-79.png"></p>
<p>Выберите <strong>Инструменты - Обработка - Объединение по признаку</strong>:</p>
<p align="center"><img src="../images/qgis-digitizing-80.png"></p>
<p>В открывшемся окне в поле <strong>Исходный векторный слой</strong> выберите слой лесопатологических выделов (в примере intersection) и укажите <strong>Признак классификации</strong> — поле, по которому будет производиться объединение (в примере поле, содержащее номера кварталов KV_T). Укажите имя результирующего shape-файла и нажмите <strong>OK</strong>.</p>
<p align="center"><img src="../images/qgis-digitizing-81.png"></p>
<p>Появится окно с предложением добавить созданный слой в текущий проект.</p>
<p align="center"><img src="../images/qgis-digitizing-82.png"></p>
<p>Нажмите <strong>Да</strong>, результирующий слой будет выглядеть следующим образом:</p>
<p align="center"><img src="../images/qgis-digitizing-83.png"><br>
</p>
<p>То есть все объекты с одинаковым значением поля KV_T были объединены.</p>
<p>Стоит отметить, что данная операция приводит к утрате большого количества атрибутивной информации. И хотя результирующий слой содержит такое же количество полей, что и исходный, однако корректная информация присутствует только в поле по которому было произведено объединение (KV_T), остальные поля следует игнорировать, так как они не соответствуют логике нового слоя.</p>
<p>&copy;<a href="http://www.nextgis.ru/" target="_blank" class="external">NextGIS</a>, разрешено для публикации на <a href="/qa/qgis-digitizing.html">GIS-Lab.info</a>. Авторы: Рыков Д.А., Маниша А.?., Дубинин М.Ю. Лицензия: <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Лицензия Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-nd/3.0/80x15.png" /></a></p>
<!-- обсуждение на форуме, цифра изменяется при публикации статьи -->   
<p class="discuss">
   <span><!--#include virtual="/scripts/forum-comments-num.php?i=852"--></span>
</p>
<!-- ссылки -->
<div class="links">
	<h2>Ссылки по теме</h2>
		<ul>
			<li><a href="/qa/qgis-vector.html">Создание и редактирование векторных слоев средствами QGIS</a></li>
			<li><a href="/qa/qgis-osgeo4w.html">Установка QGIS/GRASS с помощью OSGeo4W</a></li>
		</ul>
</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 22.07.2010
<br>
Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=6901" target="_blank">Денис Рыков</a></span></p>
<!--#include virtual="/inc/footer2.php" -->
