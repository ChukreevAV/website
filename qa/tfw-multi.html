<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Создание файлов привязки (world-файлов) в автоматическом режиме для мозаики растровых тайлов</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Создание файлов привязки (world-файлов) в автоматическом режиме для мозаики растровых тайлов</h1>
<p class="ann">Работа со скриптом на языке Perl, который позволяет в автоматическом режиме расчитывать и создавать файлы привязки для мозаики растровых тайлов</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=5015"--></span></p>

<p>Иногда необходимо создать большое число <a href="/qa/tfw.html">world-файлов</a> для некоторой матрицы растровых картинок. </br>
К примеру, такая задача может возникнуть, когда есть разрезанное на части (тайлы, плитки, фрагменты)  большое растровое изображение.  Чтобы избежать отдельной привязки каждого тайла может потребоваться:  </p>
<ol>
  <li>создать относительную привязку каждому тайлу (с помощью world-файлов)</li>
  <li>склеить тайлы в единое растровое изображение и лишь затем </li>
  <li>привязывать все растровое изображение целиком (если это необходимо). </br>
    </li>
  </ol>
<p>Представим ситуацию когда из имени тайлов нам известно их взаимное расположение в пространстве, ширина тайлов по оси Х одинакова для всех тайлов, высота тайлов по оси Y также одинакова для всех тайлов (может быть при этом не равна ширине). </br>
</p>
<p><img src="/images/tfw-multi-01.png" width="600" height="268"></p>
<p>В этом примере конечное растровое изображение должно состоять из 8 тайлов:  8 картинок в 2 ряда (4 картинки на 1 ряд).  Для простоты в данном примере размерность в пикселях по оси Х и Y одинакова и равна 1000 пикселей. </br>
</p>
<p>Чтобы сгенерировать относительные world-файлы зададим каждому тайлу 6 параметров  (<a href="/qa/tfw.html">подробнее о параметрах</a>). Первые четыре параметра в нашем случае будут неизменны и равны:</br>
  1 0 0 -1</br>.
  А вот последние два параметра – координаты Х и Y верхнего левого пикселя нам необходимо расчитать автоматически исходя из названия файла. Для этого, мы должны знать число колонок и строк такой  матрицы тайлов (т.е. число тайлов по оси Х и Y).  </p>
<p>К примеру: </p>
<ul>
  <li>первый тайл – Tile1.tif. Для него параметры файла привязки будут:</br>
    1 0 0 -1 0 1000 (так как мы считаем что именно этот верхний левый угол имеет начальные относительные координаты всего растра). </br>
  </li>
  <li>Для тайла Tile2.tif параметры будут уже иными:</br>
    1 0 0 -1 1000 1000 (1000 – это ширина тайла по оси Х – следовательно именно такой число пикселей нам надо прибавить к исходной координате).</li>
  <li>Для тайла Tile5.tif из второго ряда параметры будут уже иными:</br>
    1 0 0 -1 0 0 </li>
  <li>Для тайла Tile6.tif</br>
из второго ряда    1 0 0 -1 1000 0.</br>
    </li>
  <li>И так далее.</br>
    </li>
  </ul>
<p>В таблице приведены расчетные значения world файла для каждого растрового фрагмента (тайла):</br>
</p>
<table width="85%" align="center">
  <tr>
	<td><p>Tile 1: </br> 
	  <br>
	  1<br> 
	  0<br> 
	  0<br> 
	  -1<br> 
	  0<br> 
	  1000</p></td>
	<td><p>Tile 2:<br>
	  1<br> 
	  0<br> 
	  0<br> 
	  -1<br> 
	  1000<br> 
	  1000</p></td>
	<td><p>Tile 3: </br>
	  <br>
	  1<br> 
	    0<br> 
	    0<br> 
	    -1<br> 
	    2000<br> 
	    1000</p>
	  </td>
	<td><p>Tile 4: </br> 
	  <br>
	  1<br> 
	  0<br> 
	  0<br> 
	  -1<br> 
	  3000<br> 
	  1000</p></td>
  </tr>
    <tr>
	<td><p>Tile 5: </br> 
	  <br>
	  1<br> 
	  0<br> 
	  0<br> 
	  -1<br> 
	  0<br>
	  0
	</p></td>
	<td><p>Tile 6: </br> 
	  <br>
	  1<br> 
	  0<br> 
	  0<br> 
	  -1<br> 
	  1000<br> 
	  0</p></td>
	<td><p>Tile 7: <br>
	  1<br> 
	  0<br> 
	  0<br> 
	  -1<br> 
	  2000<br> 
	  0</p></td>
	<td><p>Tile 8: </br> 
	  <br>
	  1<br> 
	  0<br> 
	  0<br> 
	  -1<br> 
	  3000<br> 
	  0</p></td>
  </tr>
</table>
<p>Приведенный ниже скрипт на языке Perl позволяет автоматически создать такие world-файлы для всех тайлов (растровых фраментов) в папке. </br>
Скрипт должен быть запущен из той папки, где расположены все тайлы и строка запуска может иметь иметь  5 параметров:</br>
<pre>perl  worldfile_gen.pl  [raster_extension] [tiles_X] [tiles_Y] [size_X] [size_Y]</pre>
<p>Параметры:</p>
<ul>
  <li>[raster_extension] - расширение растровых изображений (может быть tif, jpg, img и др).</li>
  <li>[tiles_X]  - число тайлов по оси Х в мозаике.</li>
  <li>[tiles_Y] - числов тайлов по оси Y в мозаике.</li>
  <li>[size_X] - размер (в пикселях) тайла по оси Х.</li>
  <li>[size_Y] - размер (в пикселях) тайла по оси Y.</li>
</ul>
<p>Например:</br>
</p>
<pre>D:\misc\tiles>perl worldfile_gen.pl tif 20 30 1000 2000</pre>
В этом случае будут созданы tfw-файлы для всех файлов с расширением tif в директории, всего будет создано 600 файлов. Размер тайла по оси Х = 1000 пикселей, по оси Y = 2000 пикселей. Число тайлов по оси Х = 20, по оси Y = 30.</br>
Если параметры не будут указаны сразу, скрипт запросит их введение после запуска.</p>

<p>Узнать размер изображения в пикселях по Х и Y осям можно с помощью бесплатной библиотеки Gdal и команды gdalinfo (подробнее о библиотеке Gdal) или эту информацию можно получить  с помощью бесплатных графических редакторов (например IrfanView).</p>

<p>Дальнейшая склейка тайлов в единую мозаику может быть  проиведена с помощью библиотеки gdal.
  <!-- обсуждение на форуме, цифра изменяется при публикации статьи -->
  Если вы работаете в QGIS, можно не склеивать растр и использовать виртуальную мозаику VRT. </p>
<p><a href="/programs/perl/worldfile_gen.txt">Скачать скрипт</a></p>
<p class="discuss">
   <span><!--#include virtual="/scripts/forum-comments-num.php?i=5015"--></span>
</p>
<!-- ссылки -->
<div class="links">
	<h2>Ссылки по теме</h2>
		<ul>
			<li><a href="tfw.html">Формат файла привязки Arcview (world-файл)</a></li>
			<li><a href="georef-gdal.html">Использование GDAL для привязки растровых материалов</a></li>
			</ul>
</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 27.03.2010
<br>Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=31" target="_blank">Анна Костикова</a></span></p>
<!--#include virtual="/inc/footer2.php" -->