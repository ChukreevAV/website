<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Выделение растровых контуров объектов в GRASS</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Выделение растровых контуров объектов в  GRASS</h1>
<p class="ann">В статье рассматривается теоретические основы и практическая реализация процедуры оконтуривания объектов, представленных на растровых изображениях.</p>
<p>Предположим, что имеется растровое изображение, например, космоснимок, содержащее некоторое число "пятен" - объектов разной природы, расположенных на относительно однородном фоне. Объект выделяется на фоне изображения благодаря его большей или меньшей яркости относительно яркости фона. Таким образом, контур (граница) объекта характеризуется скачкообразным изменением функции яркости изображения. Требуется построить автоматизированную процедуру выделения контуров объектов по изменениям функции яркости. </p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=3961"--></span></p>
<p>Необходимо подчеркнуть, что задача получения векторного представления контуров объектов не ставится, в данном случаем нам достаточно построения  растрового изображения, на котором контуры объектов будут подчеркнуты.</p>
            <p><strong>Оглавление</strong></p>
            <ol>
                  <li><a href="#01">Основная идея</a></li>
                  <li><a href="#02">Реализация в ГИС GRASS</a></li>
            </ol>


<!-- Первый раздел -->
            <h2><strong><a name="01" id="01"></a></strong>1. Основная идея</h2>
            <p>Растровое изображение представляет собой модель некоторой 2.5-мерной поверхности, где каждый элемент помимо положения имеет координату Z, собственно значение, которое может быть представлено в виде высоты. Таким образом, участки относительно однородного фона на растре представляют собой более или менее плоские участки на моделирумой поверхности, а области, расположенные непосредственно на границах объектов, являются областями перепадов функции яркости растра. Следовательно, задача поиска контуров объектов на растровых изображениях - это задача поиска участков с относительно резкими перепадами высот (значений) моделируемой растром поверхности. Задача такого рода - хорошо изученная задача математического анализа, которая решается дифференциальными методами.</p>
	        <p>Прежде, чем приступать к описанию решения задачи, дадим необходимое определение:</p>
	    <p><strong>Градиент</strong> - это вектор, ориентированный по направлению наиболее быстрого возрастания и имеющий длину, пропорциональную этой максимальной скорости.</p>
	    <p>Следовательно, на участках с большим перепадом высот модуль градиента должен быть также большим, а на относительно плоских участках - приблизительно равным нулю. Таким образом, для выделения контуров объектов необходимо построить поле модуля градиента для функции яркости исходного изображения. Эта функция является функцией, зависящей от двух переменных - координат x и y.</p>
	    <p>Как известно, градиент функции двух переменных вычисляется по формуле:</p>
	    <img src="/images/grass-gradient-01.png" alt="градиент" width="323" height="80" align="center" />
	    <p>Поскольку нас не будет интересовать направление градиента, то ограничимся вычислением его модуля:</p>
	    <img src="/images/grass-gradient-02.png" alt="модуль градиента" width="416" height="93" align="center" />
	    <p>Однако, в чистом виде данная формула неприменима, поскольку она работает с частными производными, которые не существуют в точках разрыва функции, т.е. имеют смысл для непрерывных функций, но не дискретных. А так как поле яркости изображения в общем случае представляет собой фунцию двух переменных со множеством разрывов, то частные производные необходимо получить в виде оценок:</p>
	    <img src="/images/grass-gradient-03.png" alt="оценки частных производных" width="496" height="157" align="center" />
	    <p>здесь n<sub>1</sub>,n<sub>2</sub> - координаты (измеренные в пикселах) на растровом изображении.</p>
	    <p>Из практических соображений, когда при вычислении частных производных используют метод скользящего окна, часто применяют оператор Собела. В этом случае s<sub>1</sub> находят при помощи обработки маской 3x3:</p>
<pre>
-1 -2 -1
 0  0  0
 1  2  1
</pre>
	    <p>А s<sub>2</sub> обработкой аналогичной маской:</p>
<pre>
-1  0  1
-2  0  2
-1  0  1
</pre>


<!-- Второй раздел -->
            <h2><strong><a name="02" id="02"></a></strong>2. Реализация в ГИС GRASS</h2>
            <p>Предположим, что у нас уже <a href="grass-intro.html">создана область GRASS</a>, в которую загружен растр под именем test. Этот файл показан на рисунке:</p>
	        <div align="center"><img src="/images/grass-gradient-04.jpg" alt="пример растра" width="641" height="482" align="center" />
	              </div>
	        <p>Для реализации описанного выше способа нам понадобятся две команды GRASS: <a href="http://grass.gis-lab.info/grass65/manuals/html65_user/r.mfilter.html" target="_blank" class="external">r.mfilter</a> и <a href="http://grass.gis-lab.info/grass65/manuals/html65_user/r.mapcalc.html" target="_blank" class="external">r.mapcalc</a>. Первая команда используется для создания фильтров и их последующего использования, вторая представляет собой мощный растровый калькулятор.</p>
	    <p>Для реализации фильтров, вычисляющих оператор Собеля, создадим два файла s1.f:</p>
<pre>
title s1
matrix 3
-1 -2 -1
0 0 0
1 2 1
divisor 1
</pre>
	<p>и аналогичный файл s2.f:</p>
<pre>
title s2
matrix 3
-1 0 1
-2 0 2
-1 0 1
</pre>
	    <p>Для каждого из файла вызовем функцию r.mfilter следующими командами:</p>
<pre>
r.mfilter in=test out=s1 filter=s1.f
r.mfilter in=test out=s2 filter=s2.f
</pre>
	    <p>В результате будут построены два растра s1 и s2 - оценки частных производных по координатам x и y. Далее вычислим модуль градиента:</p>
<pre>r.mapcalc grad="sqrt(pow(s1,2)+pow(s2,2))"</pre>
		<p>Таким образом будет создан новый растр под именем grad, представляющий собой поле модуля градиента функции яркости для изображения test. </p>
		<p align="center"><img src="/images/grass-gradient-07.jpg" alt="фрагмент поля модуля градиента" width="642" height="452" align="center" /></p>
		<p>Далее к этому растру можно применить пороговую обработку, когда все значения меньше определенного обращаются в NULL. При выборе порога нужно руководствоваться следующим соображением: чем меньше порог, тем меньше ячеек растра будут обращены в NULL и, соответственно, тем более жирными будут линии контуров. С другой стороны, излишне большой порог приведет к тому, что линии контуров станут слишком тонкими, а местами и вовсе пропадут. Таким образом, пороговое значение очень сильно зависит от исходного изображения и подбирается экспериментально, в нашем случае таким порогом был уровень 60:</p>
		<pre>
r.mapcalc contur="if(grad-60, grad, grad, null())"
</pre>
		<p>В результате был получен растр под названием contur, в котором все ячейки, которые соответствуют ячейкам растра grad со значениями меньше 60, были обращены в NULL, а ячейки, соответствующие ячейкам из grad с большими значениями, чем 60, получили значения из растра grad. Построенный таким образом растр представлен на рисунке ниже (с наложением на исходный растр):</p>
		<div align="center"><img src="/images/grass-gradient-05.jpg" alt="поле модуля градиента" width="641" height="482" align="center" />
		  </div>
		<p>Вот фрагмент растра в более крупном масштабе:</p>
	    <div align="center"><img src="/images/grass-gradient-06.jpg" alt="фрагмент поля модуля градиента" width="642" height="482" align="center" />
	      </div>
	    <p>Как видно из рисунков, алгоритм вполне справляется с поиском разнородных объектов и выделением контуров. Однако, также заметен и основной недостаток алгоритма: сильная зависимость от шума. В результате на зашумленных участках растра появляются паразитные линии или наоборот, контур объекта преобретает разрывную форму.</p>
        <p class="discuss"><span><!--#include virtual="/scripts/forum-comments-num.php?i=3961"--></span></p>
            <div class="links">
				<h2>Ссылки по теме</h2>
					<ul>
						<li><a href="http://grass.gis-lab.info/intro/general.php" target="_blank" class="external">ГИС GRASS</a></li>
						<li><a href="http://gis-lab.info/docs/grass/">Документация по ГИС GRASS</a></li>
						<li><a href="grass-intro.html">Начало работы с GRASS для Windows</a></li>												
					</ul>
			</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 09.09.2009
<br>Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=6597" target="_blank">Дмитрий Колесов</a></span></p>
<!--#include virtual="/inc/footer2.php" -->