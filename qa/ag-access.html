<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Подключение к базе данных MS Access из ArcGIS 9.x</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Подключение к базе данных MS Access из  ArcGIS 9.x</h1>
<p class="ann">Загрузка данных из MS Access в ArcGIS </p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=2578"--></span></p>
<p>Статья написана на примере тех же данных, что и <a href="sql.html">аналогичная  для ArcView 3.x.</a> Технология используется при создании карт распространения  растений сайта <a href="http://byrranga.ru" target="_blank" class="external">«Флора Таймыра»</a> © И.Поспелов, Е.Поспелова 2007-2008.</p>
<p> Сразу необходимо сделать важное замечание. В отличие от ArcView  3.x, ODBC driver ArcGIS  9.x значительно более  требователен к именам объектов баз данных. Поэтому крайне нежелательны  имена таблиц и полей в них на кириллице, а также с  нестандартными символами типа &amp;, @, и т.д., и с пробелами.</p>
<p> Итак, имеем созданный в ArcGIS 9.2 проект, задача –  связать shape-файл локальных флор (белые кружки), с атрибутивными данными,  хранящимися в базе данных (БД) MS ACCESS 2007. Нажимаем «Add Theme» <br />
  <br />
  <img src="../images/ag-access-01.gif" width="700" height="548" /></p>
<p>В  списке Look In выбираем Database Connections:</p>
<p align="center"><img src="../images/ag-access-02.gif" width="491" height="327" /><br />
</p>
<p><span>В  следующем окошке выбираем Add OLE DB Connection:</span></p>
            <p align="center"><img src="../images/ag-access-03.gif" width="516" height="330" /></p>
            <p>Соединение с БД, которое будет установлено, сохранится в  памяти ArcGIS и будет предлагаться теперь для любого нового проекта, что видно  по уже имеющимся на иллюстрации OLE DB Connection(№№).</p>
            <p> Примечание. Можно подключиться и напрямую к файлу БД ACCESS  .mdb, он будет корректно прочитан, но доступны для связи будут только  таблицы БД (но не запросы). А на мой взгляд, связь гораздо удобнее  устанавливать с заранее созданными в ACCESS запросами.
              В появившемся окне «Свойства связи с данными» на  вкладке «Поставщик данных» выбираем Microsoft OLE DB Provider for ODBS Drivers.  Жмем «Далее».</p>
            <p align="center"><img src="../images/ag-access-04.gif" width="374" height="460" /></p>
            <p>              На  Вкладке «Подключение» ставим флажок «Использовать строку подключения». Жмем «Сборка»</p>
            <p>              В появившемся  окне «Выбор источника данных». Переходим на вкладку «Источник данных компьютера»  и ДВАЖДЫ ЩЕЛКАЕМ на MS Access Database или База данных MS Access  (Без разницы).<br />
              Примечание:  использован компьютер с English Windows Server 2003 с установленным пакетом MUI  RUS и русским MS Office 2007. На машинах с другими языками ОС и Office  возможно, данные диалоговые окна будут выглядеть несколько по другому, главное –  в «Выборе источника данных» выбрать БД MS ACCESS.</p>
            <p align="center">              <img src="../images/ag-access-06.gif" width="449" height="386" /></p>
            <p>              По  двойному щелчку появится окно «Вход», здесь по кнопке «База данных» выбираем  нужную нам БД и при необходимости вводим Логин-Пароль базы данных.</p>
            <p align="center">              <img src="../images/ag-access-07.gif" width="464" height="446" /></p>
            <p>              Жмем  два раза «ОК», после чего в окне ««Свойства  связи с данными» на вкладке «Подключение» жмем кнопку «Проверка связи с данными».   Если все правильно, получим  информационное окошко «Проверка подключения выполнена». Ошибка может возникнуть  только в том случе, когда БД у вас запаролена и вы ошиблись с логином-паролем.  Жмем ОК.</p>
            <p align="center"><img src="../images/ag-access-08.gif" width="373" height="460" /></p>
            <p>              Мы  вернулись к окошку  Add Data. В нем  появилось новое OLE DB Connection (если у вас их еще не было, то так и будет  называться, в нашем случае оно был автоматически названо OLE DB Connection(5).  Теперь самое время присвоить соединению вразумительное имя, что я и сделал. </p>
            <p align="center">              <img src="../images/ag-access-09.gif" width="492" height="320" /></p>
            <p><span>Дважды щелкаем по созданному соединению. Откроется окно с  таблицами и запросами БД, расставленными по алфавиту. Выбираем нужный  объект  и жмем «Add». Кстати, если вы не обратили  внимание на предупреждение о правильном синтаксисе имен источников данных,  может появиться сообщение об ошибке Field Name Is Not valid и будет указано, имя  какого поля ошибочно.</span></p>
            <p align="center"><img src="../images/ag-access-10.gif" width="489" height="329" /></p>
            <p>В левой нижней части окна ArсMAP переходим на вкладку  Source. Теперь наряду с слоями карты мы видим и присоединенные таблицы.<br />
            </p>
            <p align="center"><img src="../images/ag-access-11.gif" width="252" height="428" /></p>
            <p> Теперь  начинаем собственно присоединять атрибутивные данные к shape-файлам.  Вызываем окно свойств нужного слоя, переходим  на вкладку Joins &amp; Relates. В  левом окне Joins нажимаем Add...</p>
            <p align="center"><img src="../images/ag-access-12.gif" width="591" height="446" /></p>
            <p>В появившемся окне в поле 1 выбираем поле связи (общее с  присоединяемой таблицей) для слоя карты, в поле 2 – какую именно таблицу мы  хотим присоединить, в поле 3 – поле связи для таблицы из БД. Внимание !  Проверяйте соответствие типов данных в поле связи в Shape-файле и таблице БД.  Если, скажем, в БД поле будет числовым, а в атрибутике Shape-файла текстовым –  установление связи будет невозможным ! В таком случае приведите поля в  соответствие (путем изменения типа данных в таблице ACCESS или копирования  данных в новое поле нужного типа. Кстати, если вы добавили в запрос (таблицу)  новое поле, то в связанной таблице оно отобразится только после перезапуска  ArcMAP или переустановки связи OLE DB Connection. </p>
              <p>Можно также нажать кнопку Advanced и устонавить  вариант связи «Один-Ко-Многим» (по умолчанию» или «Один-К-Одному» - примеры их  нарисованы в окошке достаточно доходчиво. Жмем ОК.</p>
              <p align="center"><img src="/images/ag-access-13.gif" width="700" height="421" /></p>
              <p>Все,  связь создана! Перейдите на вкладку Fieds в Layer Properites и убедитесь, что в атрибутике слоя появились новые  поля (вверху – поля атрибутивной таблицы Shape-файла, внизу – присоединенные поля  из запроса в БД</p>
              <p align="center">                    <img src="../images/ag-access-14.gif" width="587" height="448" /></p>
              <p>                Также  нужно открыть атрибутивную таблицу слоя, и убедиться, что связь осуществлена  правильно. Выделены на рисунке поля связи shape-файла и связанного запроса БД.</p>
              <p align="center">                <img src="../images/ag-access-15.gif" width="700" height="567" /></p>
              <p>                Теперь  можно использовать присоединенную атрибутику для создания новых карт, например  по полю count_22 построена картограмма (легенда типа  богатства локальных флор Таймырского  муниципального района (бывшего Таймырского АО).</p>
              <p align="center">                    <img src="../images/ag-access-16.gif" width="700" height="736" /></p>
              <p>                Еще  один момент, на котором хотелось бы остановиться – связывание Shape-файла и  внешней атрибутивной таблицы «Один-Ко-Многим». В моем случае это локальные  флоры (117) и находки видов в этих локальных флорах (видов 866, всего находок  более 23000). Можно произвести связь этих таблиц и напрямую, но в силу неких  ограничений в связанной таблице ArcGIS выводит только первые 2000 записей.  Поэтому созданные методом фильтрации (Definition Query) карты будут ошибочными, так  как находки будут взяты только из этих первых 2000 записей (не исключаю, что  исправить сие можно в системном реестре Windows, но прямых указаний не нашел).</p>
              <p align="center">                    <img src="../images/ag-access-17.gif" width="703" height="112" /></p>
              <p align="center"><br />
                <img src="../images/ag-access-18.gif" width="705" height="99" /></p>
              <p>Есть достаточно простой выход – перед началом работы перейти  к последней записи в связанной таблице,   но мне представляется более удобным осуществлять фильтрацию в запросе  непосредственно в ACCESS. Запрос при этом постоянно находится в режиме конструктора  и просто сохраняется после каждой смены выборки, а в параллельно открытом проекте  ArcMap после смены выборки проводится обновление компоновки по клавише  f5. </p>
              <p>Именно так генерируются карты,  приведенные на сайте <a href="http://byrranga.ru">«Флора Таймыра»</a>.</p>
        <p class="discuss">
		   <span><!--#include virtual="/scripts/forum-comments-num.php?i=2578"--></span>
		</p>
            <div class="links">
				<h2>Ссылки по теме</h2>
					<ul>
                        <li><a href="sql.html">Как установить связь с базой данных MS ACCESS и работать с внешними таблицами, содержащими атрибутивные данные (общее описание процедуры и конкретные примеры)</a></li>
					  </ul>
			</div>
            <!--#include virtual="/scripts/date.php" -->
            <p class="status"><span>Дата создания: 03.11.2008
<br>Автор: <a href="/forum/memberlist.php?mode=viewprofile&u=3" target="_blank">Игорь Поспелов (taimyr)</a></span></p>
<!--Contents end-->
<!--#include virtual="/inc/footer2.php" -->
