<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Визуализация рельефа в ArcGIS и создание 3D моделей местности</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1> Визуализация рельефа  и создание 3D моделей местности в ArcGIS</h1>
<p class="ann">Начальные сведения о 3d - визуализации рельефа в ArcGis 9.х, медленно но верно вытесняющей ArcView 3.x. Нижеприведенные примеры – долина р. Котуй, Анабарское плато, юго-восток Таймырского АО.</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=948"--></span></p>
<p>В отличие от ArcView 3х, в ArcMap 9 в стандартном пользовательском интерфейсе значительно усовершенствовано построение TIN. Для создания TIN-модели рельефа требуется один или несколько слоев, имеющих в атрибутивной таблице значения абсолютной высоты. В этом примере будут использоваться слой горизонталей (линейный) и слой отметок высот всех типов (точечный).</p>
            <p>Загружаем в проект нужные слои. Активизируем модуль 3D Analyst (Tools – Extentions – 3D Analyst (рис. 1).</p>
            <p align="center"><img src="../images/3dviz-ag-01.gif" width="380" height="485" /><br />
              Рис.1. Активизация модуля 3D Analyst</p>
            <p align="left">Вызвав

              контекстное меню щелчком правой кнопки мыши на панели инструментов Arcmap, включаем панель 3D Analyst (рис.2).</p>
            <p align="center"><img src="../images/3dviz-ag-02.gif" width="495" height="47" /><br />
              Рис.2. Панель инструментов 3 D Analyst</p>
            <p>Открываем меню в левой части панели 3D Analyst и выбираем Create/ Modify TIN. Появляется диалоговое окно, в котором слева предлагается выбор слоев, на основе которых может быть построена TIN – модель (рис.3). </p>
            <p align="center"><img src="../images/3dviz-ag-03.gif" width="449" height="342" /><br />
              Рис.3. Диалоговое окно создания TIN, слева обведены слои, на основе которых он будет построен, справа – поле, содержащее значения абсолютных высот.</p>
            <p align="left">Отмечаем галочкой темы (слои), содержащие информацию о высоте – в нашем случае rel_ point200 и rel_ line200, и для каждой темы справа в списке Height Source выбираем  поле в атрибутивной таблице, содержащее значения высот – в нашем случае в обоих темах поле AHEIGHT . Остальные значения указывают путь и имя результирующей TIN-модели. После нажатия ОК – идет построение модели, результат – рис. 4.</p>
            <p align="center"><img src="../images/3dviz-ag-04.jpg" width="650" height="728" /><br />
              Рис.4. TIN, построенный со значениями «по умолчанию»</p>
            <p align="left">Можно отредактировать легенду TIN (двойным щелчком на названии TIN-темы вызвать ее свойства и перейти на вкладку Symbology. Параметр Edge type можно снять, это те же горизонтали, только построенные автоматически по интерполированному TIN в соответствии с заданными интервалами (этот параметр может, однако, пригодиться, если надо построит свой особый слой горизонталей, отличный от исходного).  ArcMap представляет широкие возможности для раскраски рельефа (цветовые шкалы, рис.5) и классификации (кнопка Classify, рис 6).</p>
            <p align="center"><img src="../images/3dviz-ag-05.jpg" width="590" height="429" /><br />
              Рис. 5. Выбор цветовых шкал высот</p>
            <p align="center"><img src="../images/3dviz-ag-06.gif" width="630" height="480" /> <br />
              Рис.6. Выбор способов классификации для построения легенды слоя абсолютных высот. </p>
            <p align="left">Можно задать любое количество классов и любые интервалы между ними, цветовые шкалы так же можно редактировать (рис.7). </p>
            <p align="center"><img src="../images/3dviz-ag-07.gif" width="300" height="301" /><br />
              Рис. 7. Окно редактирования цветовой шкалы. Цветовая шкала состоит из одной или нескольких градиентных растяжек. Для редактирования градиентной заливки – необходимо выбрать Properites.</p>
            <p>Результат редактирования представлен на рис. 8. Созданную легенду можно сохранить для будущего использования нажав правой кнопкой мыши на названии темы и выбрав – Save As Layer File (Сохранить как файл слоя). </p>
            <p align="center"><img src="../images/3dviz-ag-08.gif" width="600" height="439" /><br />
              Рис.8. TIN с модифицированной легендой.</p>
            <p align="left">В дальнейшем TIN можно модифицировать и уточнять, добавляя новые слои любых типов, имеющие в атрибутике абсолютные высоты.</p>
            <p>Далее нужно переконвертировать TIN в GRID (3D Analyst – Convert – TIN to Raster), при этом можно задать размер ячейки GRID (рис.9). </p>
            <p align="center"><img src="../images/3dviz-ag-09.gif" width="381" height="233" /> <br />
              Рис. 9. Окно конвертации TIN в GRID, выделено поле ввода размера ячейки GRID в единицах Вида (в данном случае – 25х25 м).</p>
            <p align="left">В полученном GRID надо поменять легенду, тем же способом, что и ранее был описан для TIN,  в поле Show: надо сменить Stretched на Classified (рис.10). Все прилагающиеся цветовые легенды шкалы высот сделаны из расчета, что зеленым обозначаются большие значения, а коричневым – меньшие. Чтобы «развернуть» цвета в обратном порядке, щелкаем мышью на столбце с цветами и выбираем Flip Colors.</p>
            <p align="center"><img src="../images/3dviz-ag-10.gif" width="590" height="438" /><br />
              Рис. 10. Окно построения легенды растрового изображения ( GRID).</p>
            <p align="left">Дальнейшие операции весьма сходны по сути с <a href="/qa/3dviz.html">описанными для ArcView 3 x</a>. Делаем слой оттенения (3D Analyst- Surface Analysis – Hillshade), в диалоговом оконе задаем направление и высоту солнца, при необходимости меняем Cell Size на идентичные исходному GRID, и обязательно меняем путь и имя Hillshade – растра с Temporary (временный) на любой постоянный путь и название файла (рис. 11).</p>
            <p align="center"><img src="../images/3dviz-ag-11.gif" width="322" height="298" /><br />
              Рис. 11. Окно построения Hillshade GRID. Azimuth – направление освещения солнца (по умолчанию – СЗ, Altitude – угол высоты солнца над горизонтом, чем он ниже, тем «длиннее» будут тени, значение Output cell size должно быть равно ячейке GRID абсолютных высот.</p>
            <p align="left"><span>Далее помещаем полученный слой Hillshade под Grid в списке слоев, и задаем слою GRID прозрачность вызвав его свойства (Properties) и закладку Display (рис. 12). </span> </p>
            <p align="center"><img src="../images/3dviz-ag-12.gif" width="590" height="438" /><br />
              Рис.12. Установка прозрачности слоя GRID.</p>
            <p align="left">Все дальнейшие действия – это  комбинированию легенд слоев GRID и Hillshade и прозрачности слоя GRID. Возможный результат – на рис.13. В качестве примера можно скачать легенды<a href="/other/3dviz-ag.zip"> grid 0-1200.lyr</a> (рассчитана на высоты 0-1300 м) и <a href="/other/3dviz-ag.zip">hillshade .lyr</a> (перед подгрузкой тип легенды Stretched необходимо заменить на Classified)</p>
            <p align="center"><img src="../images/3dviz-ag-13.gif" width="600" height="494" /><br />
              Рис.13. Раскраска и отмывка рельефа с наложением гидросети (пример)</p>
            <p align="left">Теперь у нас есть все необходимое для создания трехмерной модели местности. Для этого можно использовать приложение ArcScene, вызываемое с панели инструментов 3D Analyst (рис.14). </p>
            <p align="center"><img src="../images/3dviz-ag-14.gif" width="573" height="54" /> <br />
              Рис. 14. Кнопка вызова ArcScene на панели инструментов 3 D Analyst.</p>
            <p align="left">На рис. 15 – окно ArcScene, сходное с окном ArcMap, в него также можно добавлять любые темы. </p>
            <p align="center"><img src="../images/3dviz-ag-15.gif" width="700" height="245" /><br />
              Рис.15. Окно ArcScene</p>
            <p align="left">Сначала нужно загрузить собственно слой поверхности – либо полученный ранее TIN, либо GRID, результат будет примерно одинаков . После добавления слоя в проект ArcScene подгружаем ему легенду . lyr, заранее сохраненную в ArcMap. Затем идем в свойства темы, на вкладку Base Heights. Здесь нам надо установить, во первых, базовую поверхность (GRID или TIN), а во вторых – Z-factor – соотношение горизонтального и вертикального масштабов (рис.16). </p>
            <p align="center"><img src="../images/3dviz-ag-16.gif" width="590" height="482" /> <br />
              Рис.16. Окно установки 3D-параметров модели. Вверху – установить базовый слой высот, в середине справа – установка соотношения горизонтального и вертикального масштабов ( Z-factor).</p>
            <p align="left">Для гористых местностей его надо ставить 3—7, для равнинных 10—20. Получаем следующую картинку – рис.17.</p>
            <p align="center"><img src="../images/3dviz-ag-17.gif" width="600" height="416" /><br />
              Рис. 17. Трехмерная модель местности на основе слоя GRID без наложения других слоев.</p>
            <p align="left">Далее на нее можно накладывать как векторные, так и растровые слои, для которых во вкладке свойств Base Heights устанавливаем ту же поверхность и Z- factor, что и для базового слоя высот. В принципе он (базовый слой высот – TIN или GRID) вообще может и не присутствовать в ТОС ArcScene, а быть только обозначенным во всех слоях. Иногда имеет смысл сделать Z- factor для накладываемых слоев чуть (на 0,5-1) большим, так как векторы могут местами «зарываться» в базовый слой из-за разности визуализации растровых и векторных данных. Например, на трехмерную модель наложена гидросеть (рис. 18).</p>
            <p align="center"><img src="../images/3dviz-ag-18.gif" width="600" height="367" /><br />
              Рис. 18. Трехмерная модель местности на основе слоя GRID с наложением векторных слоев гидросети.</p>
            <p align="left">Можно наложить на 3D модель космическую съемку, так же добавив соответствующий растр в ТОС и установив Base Heights и Z- factor. Если у вас достаточно мощная видеокарта, имеет смысл на вкладке свойств растра снимка Rendering выставить Quality Encashment… – High (рис.19), но на слабых картах (менее 64 мб памяти) работа может сильно замедлиться. </p>
            <p align="center"><img src="../images/3dviz-ag-19.gif" width="590" height="482" /><br />
              Рис. 19. Установка параметров качества растрового изображения, наложенного на трехмерную поверхность.</p>
            <p align="left">На рис.20 – снимок ETM + каналы 3-4-5, наложенный на 3- d поверхность. Обведена на рисунке панель, при помощи инструментов которой можно управлять изображением – масштабировать, вращать, менять центр вращения, сдвигать и даже имитировать полет над местностью.</p>
            <p align="center"><a href="../images/3dviz-ag-20b.jpg" onClick="NewWindow(this.href,'mm','1280','1024','yes');return false;"><img src="../images/3dviz-ag-20.gif" alt="Нажмите для увеличения" width="526" height="362" border="0" /></a><br />
              Рис.20. Снимок ЕТМ+, наложенный на трехмерную поверхность, в максимальном качестве рендеринга. Обведены инструменты управления отображением трехмерной модели.</p>
            <p class="discuss">
				<span><!--#include virtual="/scripts/forum-comments-num.php?i=948"--></span>
			</p>
			<div class="links">
			<h2>Ссылки по теме</h2>
			<ul>
               <li><a href="3dviz.html">Визуализация рельефа в Arcview GIS</a></li>
			   <li><a href="3danalyst.html">Использование модуля 3D Analyst для Arcview GIS</a></li>
			</ul>
			</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 07.03.2006
<br>
Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=3" target="_blank">Игорь Поспелов</a></span></p>
<!--#include virtual="/inc/footer2.php" -->
