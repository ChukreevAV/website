<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Использование GDAL для привязки растровых материалов</title>
<!--#include virtual="/inc/header2.txt" -->

<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<h1>Использование GDAL для привязки растровых материалов</h1>
<!--Contents start-->
<p class="ann">Описание работы с библиотекой GDAL для привязки растровых данных</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=1641"--></span></p>
            <p>Библиотека GDAL - очень полезный, бесплатно распространяемый набор инструментов и библиотек с открытым исходным кодом. Использование этих инструментов это один из немногих способов осуществить географическую привязку растрового изображения используя исключительно бесплатное (и легальное) ПО.  </p>
            <p>Привязка растровых изображений, которые кроме файловой (пиксельной) другой системы координат не имеют (например отсканированных изображений) проводится в два шага.  Если растр уже имеет географическую или спроектированную систему координат и ее нужно изменить на другую то следует переходить сразу к шагу 3. </p>
            <h2>1. Адресация контрольных точек</h2>
            <p>Прежде чем назначать контрольные точки, необходимо разобраться с адресацией пикселей. Начало координат растра при чтении его GDAL располагается в точке 0,0, которая соответствует левому верхнему пикселю (точка 00 на иллюстрации). Координаты по оси Y увеличиваются сверху вниз, так, левый нижний угол должен адресоваться как 0, 23. Координаты по оси Х увеличиваются слева направо, так верхний правый угол должен адресоваться как 31,0. Наконец, нижний правый угол будет иметь координаты 31,23. </p>
            <p align="center"><img src="/images/georef-gdal-02.gif" alt="запуск listgeo" width="600" height="450" /> </p>
            <p>&nbsp;</p>
            <p>&nbsp;</p>
            <h2>2. Назначение контрольных точек</h2>
            <p>На этом этапе, информация о том, какие конечные координаты (Lat, Long) должен получить определенный пиксел (имеющий пиксельные координаты X,Y). Конечные координаты не обязательно должны быть широтой долготой, они также могут быть иметь и спроектированную прямоугольную систему координат:</p>
            <pre>gdal_translate.exe -of GTiff -gcp X Y Long Lat source.tif output.tif </pre>
            <p>Как правило, прописывается несколько точек, для трансформации на втором этапе необходимо минимум 2 точки, следующим образом (все контрольные точки прописываются одной командой):</p>
            <pre>gdal_translate.exe -of GTiff -gcp 136 172 49 -11.3333 -gcp 3363 187 49.5 -11.3333 -gcp 56594 208 50 -11.3333 source.tif output.tif </pre>
            <p>Проверить, правильно ли прописались контрольные точки можно с помощью <a href="ftp://ftp.remotesensing.org/geotiff/libgeotiff/listgeo-geotifcp-win32-x86-112502.zip" target="_blank" class="external">listgeo</a>:</p>
            <pre>listgeo.exe output.tif</pre>
            <p>В случае если операция осуществлена корректно, в тэгах GeoTIFF должна появиться информация о контрольных точках:</p>
            <p align="center"><img src="/images/georef-gdal-01.gif" alt="запуск listgeo" width="641" height="328" /> </p>
            <h2>3. Трансформация растра</h2>
            <p>Обычно на втором этапе производится трансформация растра, если растр уже имеет географическую или спроектированную систему координат и ее нужно изменить на другую, то первый шаг не нужен:</p>
            <p>-s_rsr - исходная система координат, в формате строки описания системы координат PROJ. Исходная система координат должна соответствовать системе координат введенных на первом этапе контрольных точек.</p>
            <p>-t_srs - конечная система координат, если необходимо только трансформировать растр в систему координат контрольных точек, то она должна быть равна исходной. </p>
            <pre>gdalwarp.exe -s_srs &quot;+proj=longlat +ellps=krass +datum=Pulkovo_1942&quot; -t_srs &quot;+proj=longlat +ellps=krass +datum=Pulkovo_1942&quot; output.tif result.tif </pre>
            <p>либо можно ее вообще не указывать, опять же, в этом случае будет просто произведена аффинная или полиномиальная трансформация растра (<a href="polynom.html">подробнее</a>), которые к проективным преобразованиям отношения не имеют: </p>
            <pre>gdalwarp.exe output.tif result.tif </pre>
            <p>Примечания:</p>
            <ul>
              <li>Названия файлов не рекомендуется начинать с цифр</li>
              <li>По умолчанию для трансформации используется полиномиальное преобразование, причем его порядок определяется количеством точек, что не всегда удобно, так как если у вас много контрольных точек, то выбрано будет преобразование высокого порядка, которое сильно деформирует растр, что в большинстве случаев неприемлемо. Чтобы установить определенный порядок полиномиального преобразования, нужно использовать ключ -order n, где n - порядок полинома. </li>
              <li>GDAL также позволяет использовать преобразование thin-plate spline, для этого нужно использовать ключ -tps.</li>
            </ul>
            <p align="right"><em>Благодарим за идею Григория Морозова </em></p>
            <p class="discuss">
							<span><!--#include virtual="/scripts/forum-comments-num.php?i=1641"--></span>
			</p>
			<div class="links">
			<h2>Ссылки по теме</h2>
			<ul>
               <li><a href="georef-ag.html">Координатная привязка карты в ArcMap</a></li>
               <li><a href="http://www.gdal.org/gdalwarp.html" target="_blank" class="external">gdalwarp</a></li>
			   <li><a href="http://www.gdal.org/gdal_translate.html" target="_blank" class="external">gdal_translate</a></li>
			</ul>
			</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 27.07.2007
<br>Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=2" target="_blank">Максим Дубинин</a></span></p>
<!--#include virtual="/inc/footer2.php" -->