<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Полиномиальные преобразования</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Полиномиальные преобразования</h1>
<p class="ann">Формулы и примеры расчетов полиномиальных преобразований</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=1400"--></span></p>
<p>Формулы полиноминальных преобразований используются для перевода исходных координат (обычно локальных-прямоугольных) в конечные (обычно спроектированные - прямоугольные). В зависимости от искажения изображения, количества контрольных точек (GCP – ground control point), и их размещения относительно друг друга, для выражения необходимого преобразования могут потребоваться достаточно сложные полиноминальные формулы. Сложность полинома выражается через его порядок. Порядок – это показатель наивысшей степени, используемой в полиноме. </p>
            <p><strong>Линейные  преобразования</strong></p>
            <p>Преобразование 1-го порядка –  линейное преобразование. Это преобразование может изменять:</p>
            <ul type="disc">
              <li>положение по X и/или Y; Изменение положения, смещает изображение на определенное       число пикселей по X и Y.</li>
              <li>масштаб по X и/или Y; Коэффициенты масштабирования по X и Y могут       быть различными</li>
              <li>наклон по X и/или Y;</li>
              <li>поворот; При повороте, можно определить любое       положительное или отрицательное число градусов, для поворота по- и против       часовой стрелки соответственно. Поворот происходит вокруг центрального       пикселя изображения.</li>
              <li>Отражение; слева направо, сверху вниз, сверху       вниз и слева направо (аналогично повороту на 180 градусов)</li>
            </ul>
            <p>Преобразование 1-го порядка может быть использовано для перевода исходного (например только что отсканированного) изображения  в прямоугольную систему координат, преобразования одной прямоугольной системы координат в другую, обычно это преобразование используется для относительной небольших фрагментов.</p>
            <p>Примерами применения этого  преобразования могут быть: исправление перекосов в данных дистанционного  зондирования, поворота отсканированных топографических листов, и поворота данных  с нисходящих орбит так, что бы север был вверху изображения (а не по ходу  орбиты).</p>
            <p>Преобразование 1-го порядка  также может быть использовано для данных, которые уже спроецированы на  плоскость. Например, часто данные дистанционного зондирования, уже находятся в  локальной прямоугольной системе координат, но не приведены к соответствующей  проекции. При использовании данного типа преобразования, не имеет смысла  увеличение порядка преобразования, если при первом порядке возникает большая  среднеквадратическая ошибка. Сначала, необходимо проверить другие возможные  источники ошибок: качество опорных точек, их распределение и другие возможные  систематические ошибки.</p>
            <p><a name="affine" id="affine"></a>На рисунке показано, как  изменяются данные при линейных преобразованиях.</p>
            <center>
              <p><img src="/images/polynom-01.gif" alt="полиномиальные преобразования 1-го порядка" width="450" height="326" /></p>
            </center>
            <p>Для осуществления полиномиального преобразования первой степени необходимо найти 6 коэффициентов - по три на каждую координату (X и Y): a<sub>0</sub>, a<sub>1</sub>, a<sub>2</sub>, b<sub>0</sub>, b<sub>1</sub>, b<sub>2</sub>. Эти коэффициенты, далее используются в собственно уравнениях полиномиального преобразования первой степени (эквивалентного также аффинному преобразованию):</p>
			<p align="center">x<sub>0</sub> = a<sub>0</sub> + a<sub>1</sub>x + a<sub>2</sub>y</p>
            <p align="center">y<sub>0</sub> = b<sub>0</sub> + b<sub>1</sub>x + b<sub>2</sub>y</p>
            <p align="center">где x,y - исходные координаты,  x<sub>0</sub>,y<sub>0</sub> - конечные координаты</p>
             <p><strong>Нелинейные  преобразования</strong></p>
             <p>Нелинейные преобразования –  это преобразования 2-го и более порядка. Эти преобразования могут корректировать  нелинейные искажения. На рисунке изображены примеры результатов некоторых  нелинейных преобразований.</p>
             <p align="center"><img src="/images/polynom-02.gif" alt="полиномиальные преобразования n-го порядка" width="630" height="166" /></p>
             <p>Преобразования 2-го порядка  могут быть использованы для преобразования данных в географической системе  координат (широта, долгота) в прямоугольную, для преобразования данных больших  областей (для учета кривизны Земли), для точно привязки искаженных по той или  иной причине данных (например, из-за искажений линз камеры, плохо  отсканированных материалов) и т.д.</p>
             <p><strong>Матрица преобразования</strong></p>
             <p>Матрица преобразования  рассчитывается по контрольным точкам. Матрица состоит из коэффициентов, которые  используются в формулах полиномов для преобразования координат. Размерность  матрицы зависит от порядка используемого преобразования. Коэффициенты матрицы  преобразований рассчитываются таким образом, чтобы получить формулы полиномиального  преобразования с как можно меньшей ошибкой перевода исходных координат в  конечные. Получить коэффициенты, которые не приводят к ошибкам удается не  всегда. Пример, иллюстрирующий ошибку исходной координаты относительно конечной  и кривой, аппроксимирующей зависимость между ними, выраженной полиномом (не все  точки лежат на линии, расстояние от исходной точки до кривой полинома  - среднеквадратичная ошибка). Для простоты в  примере показано только отношение исходной и конечной координаты X и описывающее его кривая, в реальной жизни, исходных координат 2 и конечных координат 2, поэтому зависимость между ними аппроксимируется не кривой, а плоскостью. </p>
             <p align="center"><img src="/images/polynom-05.gif" alt="полиномиальные преобразования n-го порядка" width="275" height="175" /></p>
             <p>Количество коэффициентов  матрицы преобразований для преобразования порядка t равно:</p>
             <p align="center"><img src="/images/polynom-03.gif" alt="полиномиальные преобразования n-го порядка" width="64" height="66" /></p>
             <p>Это число необходимо умножить на 2 – для двух наборов коэффициентов, один - для X, другой для Y. Более простая формула для получения количества коэффициентов: </p>
             <p align="center"><img src="/images/polynom-04.gif" alt="полиномиальные преобразования n-го порядка" width="123" height="38" /></p>
             <p>Очевидно, что размерность матрицы преобразований увеличивается с ростом порядка преобразования, соответственно <a href="#minnumber">минимальное количество контрольных точек </a>необходимых для вычислений коэффициентов матрицы тоже растет. </p>
             <p>Каждая контрольная точка влияет на <a href="polynom-calc.html">расчетные коэффициенты</a>, если нет идеального соответствия каждой контрольной точки полиному, который представлен этими коэффициентами. Расстояние между кривой и расчетной координаты точки – называется ошибкой RMS (среднеквадратической ошибкой точки). Для расчета матрицы преобразований по набору контрольных точек используется метод среднеквадратической регрессии (метод наименьших квадратов) на основе контрольных точек расставляемых пользователем от исходного (привязываемого) материала, к конечному материалу (тому, к которому привязывают).</p>
             <p><strong>Формула вычисления полинома  порядка t </strong></p>
             <p align="center"><img src="/images/polynom-06.gif" alt="полиномиальные преобразования n-го порядка" width="247" height="126" /></p>
             <p>Где: 	t – порядок полинома, 	a<sub>k</sub> и b<sub>k</sub> – коэффициенты, 	индекс k для a<sub>k</sub> и b<sub>k</sub> вычисляется как: </p>
             <p align="center"><img src="/images/polynom-07.gif" alt="полиномиальные преобразования n-го порядка" width="138" height="51" /></p>
             <p>Например, для преобразования 3-го порядка будет использоваться 20 коэффициентов:</p>
             <p align="center"><img src="/images/polynom-08.gif" alt="полиномиальные преобразования n-го порядка" width="204" height="31" /> </p>
             <p>Формула для преобразования 3-го порядка, после вычисления коэффициентов, может выглядеть так:</p>
             <p align="center"><img src="/images/polynom-09.gif" alt="полиномиальные преобразования n-го порядка" width="423" height="52" /></p>
             <p><strong>Влияние порядка  преобразования</strong></p>
             <p>Расчет формул полиномов высоких  порядков и выходных значений сложнее, чем расчет полиномов первых порядков.  Поэтому, полиномы высоких порядков применяются для изображений требующих для привязки более  сложных искажений. Для понимания влияния различных порядков преобразования при  спрямлении изображения, полезно рассмотреть выходные величины полиномов  различных порядков.</p>
             <p>В следующем примере, для  просты, используется только одна координата (X), вместо двух (X, Y), которые для  расчетов в полиномиальных преобразованиях. Это позволяет использовать двухмерные  графики, иллюстрирующие, как использование преобразования определенного порядка  позволяет связать исходные и конечные координаты. Из-за того, что в примере  используется только координата X, число используемых контрольных точек меньше  реально требуемого для преобразований соответствующих порядков.</p>
             <p>Коэффициенты, подобные тем,  которые использованы в примере, обычно рассчитываются по методу наименьших  квадратов. Предположим, что введены следующие контрольные точки:</p>
             <table border="0" align="center" cellpadding="0" cellspacing="0">
               <tr>
                 <th><p align="center">Исходная координата    X</p></th>
                 <th><p align="center">Конечная    координата X</p></th>
               </tr>
               <tr>
                 <td><p align="center">1</p></td>
                 <td><p align="center">17</p></td>
               </tr>
               <tr>
                 <td><p align="center">2</p></td>
                 <td><p align="center">9</p></td>
               </tr>
               <tr>
                 <td><p align="center">3</p></td>
                 <td><p align="center">1</p></td>
               </tr>
             </table>
             <p>Эти точки позволяют выполнить преобразование 1-го порядка для координат X, которые удовлетворяют следующему уравнению (коэффициенты указаны в скобках):</p>
             <p align="center"><img src="/images/polynom-10.gif" alt="полиномиальные преобразования" width="120" height="25" /></p>
             <p>Где: x<sub>r</sub> = конечная  координата X, x<sub>i</sub> = исходная  координата X</p>
             <p>В данном случае, уравнение  принимает такую же форму, как и уравнение линии (y = b + mx), отсюда и линейность преобразования. </p>
             <p align="center"><img src="/images/polynom-11.gif" alt="полиномиальные преобразования" width="310" height="357" /></p>
             <p>Однако, что произойдет, если вторую контрольную точку изменить следующим образом?</p>
             <table border="0" align="center" cellpadding="0" cellspacing="0">
               <tr>
                 <th><p align="center">Исходная координата    X</p></th>
                 <th><p align="center">Конечная    координата X</p></th>
               </tr>
               <tr>
                 <td><p align="center">1</p></td>
                 <td><p align="center">17</p></td>
               </tr>
               <tr>
                 <td><p align="center">2</p></td>
                 <td><p align="center">7</p></td>
               </tr>
               <tr>
                 <td><p align="center">3</p></td>
                 <td><p align="center">1</p></td>
               </tr>
             </table>
             <p>Эти точки нельзя соединить одной прямой линией, что означает, что они не могут быть описаны посредством полинома 1-го порядка, так как было описано выше.</p>
             <p align="center"><img src="/images/polynom-12.gif" alt="полиномиальные преобразования" width="302" height="347" /></p>
             <p>В данном случае, эти точки выражаются через полином 2-го порядка:</p>
             <p align="center"><img src="/images/polynom-13.gif" alt="полиномиальные преобразования" width="171" height="31" /></p>
             <p>Полиномы 2-го порядка и выше – нелинейные.</p>
             <p align="center"><img src="/images/polynom-14.gif" alt="полиномиальные преобразования" width="302" height="347" /></p>
             <p>Что если добавить еще одну контрольную точку?</p>
             <table border="0" align="center" cellpadding="0" cellspacing="0">
               <tr>
                 <th><p align="center">Исходная координата    X</p></th>
                 <th><p align="center">Конечная    координата X</p></th>
               </tr>
               <tr>
                 <td><p align="center">1</p></td>
                 <td><p align="center">17</p></td>
               </tr>
               <tr>
                 <td><p align="center">2</p></td>
                 <td><p align="center">7</p></td>
               </tr>
               <tr>
                 <td><p align="center">3</p></td>
                 <td><p align="center">1</p></td>
               </tr>
               <tr>
                 <td><p align="center">4</p></td>
                 <td><p align="center">5</p></td>
               </tr>
             </table>
             <p align="center"><img src="/images/polynom-15.gif" alt="полиномиальные преобразования" width="304" height="346" /></p>
             <p>Как видно на рисунке, четвертая точка не лежит на кривой, выраженной уравнением полинома 2-го порядка. Для того, чтобы все точки лежали на кривой, порядок преобразования должен быть увеличен до 3-х. Результирующее уравнение и кривая изображены на рисунке.</p>
             <p align="center"><img src="/images/polynom-16.gif" alt="полиномиальные преобразования" width="306" height="348" /></p>
             <p>Рисунок иллюстрирует преобразование 3-го порядка. Однако, возможно, это уравнение излишне усложнено. Выполнение преобразования координат с использованием этого уравнения, может вызвать неожиданные расхождения в результирующем изображении, при попытке достижения наилучшей подгонки всех исходных контрольных точек к конечным. Возможно, в этом примере, использование преобразования 3-го порядка было излишним, потому что порядок результирующих пикселей отличается от порядка входных пикселей по оси X (4 точка встала на 3 место, 3 оказалась на 4 месте).</p>
             <table border="0" align="center" cellpadding="0" cellspacing="0">
               <tr>
                 <th><p align="center">Исходная координата    X</p></th>
                 <th><p align="center">Конечная    координата X</p></th>
               </tr>
               <tr>
                 <td><p align="center">1</p></td>
                 <td><p align="center">x(1) = 17</p></td>
               </tr>
               <tr>
                 <td><p align="center">2</p></td>
                 <td><p align="center">x(2) = 7</p></td>
               </tr>
               <tr>
                 <td><p align="center">3</p></td>
                 <td><p align="center">x(3) = 1</p></td>
               </tr>
               <tr>
                 <td><p align="center">4</p></td>
                 <td><p align="center">x(4) = 5</p></td>
               </tr>
             </table>
             <p align="center">x(1) &gt;	 x(2) &gt; 	x(4) &gt; 	x(3)</p>
             <p align="center"><img src="/images/polynom-17.gif" alt="полиномиальные преобразования" width="617" height="163" /></p>
             <p>В этом случае преобразование  более высокого порядка, возможно, не даст ожидаемого результата, изображение  будет сильно искажено.</p>
             <p><strong><a name="minnumber" id="minnumber"></a>Минимальное  количество контрольных точек</strong></p>
             <p>Преобразования высших  порядков могут быть использованы для корректировки очень сложных типов  искажений. Однако для использования преобразований высших порядков требуется  большее количество контрольных точек. Например, плоскость определяется 3-мя  точками. Т.о. для применения преобразования 1-го порядка, которое выражается  через уравнение плоскости, требуется как минимум 3 точки. Таким же образом,  преобразование 2-го порядка выражается уравнением параболоида. Для определения  уравнения параболоида требуется 6 точек. Поэтому, как минимум 6 контрольных  точек требуется для осуществления преобразования 2-го порядка. Минимально  требуемое количество точек для преобразования t-го порядка вычисляется следующим  образом:</p>
             <p align="center"><img src="/images/polynom-18.gif" alt="полиномиальные преобразования" width="94" height="48" /></p>
             <p>Использование количества контрольных  точек больше минимального также возможно. Хотя, возможно, это даст лучшую  подгонку, зачастую увеличение количества точек не имеет значения.</p>
             <p>В следующей таблице  перечислено минимальное количество контрольных точек необходимое для  преобразований порядков с 1-го по 10-й.</p>
             <table width="50%" border="0" align="center" cellpadding="0" cellspacing="0">
               <tr>
                 <th><p align="center">Порядок преобразования</p></th>
                 <th><p align="center">Минимальное количество контрольных точек</p></th>
               </tr>
               <tr>
                 <td><p align="center">1</p></td>
                 <td><p align="center">3</p></td>
               </tr>
               <tr>
                 <td><p align="center">2</p></td>
                 <td><p align="center">6</p></td>
               </tr>
               <tr>
                 <td><p align="center">3</p></td>
                 <td><p align="center">10</p></td>
               </tr>
               <tr>
                 <td><p align="center">4</p></td>
                 <td><p align="center">15</p></td>
               </tr>
               <tr>
                 <td><p align="center">5</p></td>
                 <td><p align="center">21</p></td>
               </tr>
               <tr>
                 <td><p align="center">6</p></td>
                 <td><p align="center">28</p></td>
               </tr>
               <tr>
                 <td><p align="center">7</p></td>
                 <td><p align="center">36</p></td>
               </tr>
               <tr>
                 <td><p align="center">8</p></td>
                 <td><p align="center">45</p></td>
               </tr>
               <tr>
                 <td><p align="center">9</p></td>
                 <td><p align="center">55</p></td>
               </tr>
               <tr>
                 <td><p align="center">10</p></td>
                 <td><p align="center">66</p></td>
               </tr>
             </table>
             <p align="right"><em>В статье использованы материалы ERDAS IMAGINE Field Guide</em></p>
             <p class="discuss">
			 	<span><!--#include virtual="/scripts/forum-comments-num.php?i=1400"--></span>
			</p>
			<div class="links">
			<h2>Ссылки по теме</h2>
			<ul>
               <li><a href="rmse.html">Среднеквадратичная ошибка (RMSE)</a></li>
			   <li><a href="polynom-calc.html">Полиномиальные преобразования - вычисления и практика</a></li>
			</ul>
			</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 19.02.2007
<br>Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=2" target="_blank">Максим Дубинин</a></span></p>
<!--#include virtual="/inc/footer2.php" -->
