<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Смещение точек с одинаковыми координатами, Python/OGR</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Смещение точек с одинаковыми координатами, Python/OGR</h1>
<p class="ann">Описание скрипта для смещения точек с одинаковыми координатами.</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=9343"--></span></p>

<p>Одна из проблем, с которыми мы столкнулись в процессе работы над картой
&laquo;<a href="http://www.forbes.ru/sobytiya/vlast/77338-izbiratelnaya-geografiya-moskvy" target="_blank" class="external">Избирательная география Москвы</a>&raquo;: по одному и тому же адресу
может находиться несколько точек - участковых избирательных комиссий (УИК). Из-за
этого точки, соответствующие УИКам, накладывались друг на друга и просмотр
данных был возможен только для верхней точки.</p>
<p>Очевидное решение этой проблемы&nbsp;&mdash; сместить перекрывающиеся
точки на небольшое расстояние так, чтобы все они были видны. Вариант с
разносом точек вручную отпал сразу, слишком много перекрывающихся точек
и трудно выдержать одинаковое расстояние. Необходимо автоматизированное
решение. В первую очередь мы вспомнили о модуле QGIS &laquo;Смещение точек&raquo;
(сейчас он включен в ядро). К сожалению, этот модуль смещает точки только
в процессе отрисовки карты, реальные координаты остаются неизменными.</p>
<p>Поэтому для решения данной задачи был написан небольшой скрипт.</p>

<p><strong>Оглавление</strong></p>
<ol>
  <li><a href="#01">Подготовка</a></li>
  <li><a href="#02">Использование</a></li>
</ol>

<!-- Первый раздел -->
<h2><strong><a name="01" id="01"></a></strong>1. Подготовка</h2>
<p>Для работы скрипта необходимо иметь <a href="/programs/python/point-displacement.7z">сам скрипт</a>,
интерпретатор Python версии 2.5 или выше, библиотеку GDAL и ее привязки
(bindings) к Python.</p>
<p>Наиболее простым способом получить необходимые компоненты в ОС Windows
является использование установщика OSGeo4W:</p>
<ol>
  <li><a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup.exe" target="_blank" class="external">загрузить</a> установщик.
  Для пользователей, у которых возникают проблемы с доступом к серверу download.osgeo.org,
  создан <a href="http://download2.osgeo.org/osgeo4w/osgeo4w-setup-it.exe" target="_blank" class="external">альтернативный установщик</a>,
  работающий с зеркалом download2.osgeo.org</li>
  <li>запустить установщик</li>
  <li>выбрать пункт &laquo;Расширенная установка&raquo; и нажать &laquo;Далее&raquo;</li>
  <li>выбрать пакеты gdal и gdal-python (категория Libs), нажать &laquo;Далее&raquo;</li>
  <li>выбранные пакеты и необходимые зависимости будут загружены и установлены
  автоматически</li>
</ol>
<p>Пользователи OC Linux должны установить необходимые пакеты при помощи
пакетного менеджера своего дистрибутива.</p>
<p>Архив со скриптом необходимо распаковать, и файл displacement.py
поместить в любой удобный каталог, например, в C:\Tools\GIS. Запускать
скрипт следует из командной строки OSGeo4W.</p>

<h2><strong><a name="02" id="02"></a></strong>2. Использование</h2>
<p>Скрипт запускается из командной строки и принимает два обязательных
аргумента. Также существует несколько параметров для настройки. Аргументы</p>
<pre>displacement.py [OPTIONS] INPUT_FILE OUTPUT_FILE</pre>
<ul>
  <li>INPUT_FILE&nbsp;&mdash; исходный точечный shape-файл</li>
  <li>OUTPUT_FILE&nbsp;&mdash; файл, в который будет записан результат работы</li>
</ul>
<p>Список параметров:</p>
<ul>
  <li>-d DISTANCE, --distance=DISTANCE&nbsp;&mdash; расстояние, на которое
  будут сдвигаться перекрывающиеся точки. <strong>ВАЖНО!</strong> Необходимо
  следить, чтобы расстояние было в тех же единицах, что и координаты точек.
  Например, если координаты точек заданы в десятичных градусах, то расстояние
  должно быть в десятичных градусах.</li>
  <li>-r, --rotate&nbsp;&mdash; параметр-переключатель. Если он задан, то
  две перекрывающиеся точки будут разнесены по горизонтали, иначе&nbsp;&mdash;
  по вертикали. По умолчанию False, т.е точки разносятся по вертикали.</li>
  <li>-l FILE, --log=FILE&nbsp;&mdash; имя файла, в который будут записаны
  ID перекрывающихся точек и значения заданного поля. Имеет смысл только
  вместе с указанием параметра &quot;-f&quot;</li>
  <li>-f FIELD, --field=FIELD&nbsp;&mdash; имя поля shape-файла, значение
  которого будет выводиться в лог. Имеет смысл только вместе с указанием
  параметра &quot;-l&quot;</li>
</ul>
<p>Скрипт находит точки с одинаковыми координатами и размещает их по кругу,
используя в качестве центра исходные координаты и значение параметра &quot;-d&quot;
в качестве радиуса. Таким образом, скрипт дает практически ту же картину,
что и модуль QGIS &laquo;Смещение точек&raquo;.</p>
<p>Ниже показан результат работы скрипта (синий&nbsp;&mdash; исходные точки,
зеленый&nbsp;&mdash; точки после сдвига, величина сдвига ~10 м.).</p>
<p align="center"><img src="/images/point-displacement-01.png" alt="Результат сдвига" width="722" height="589" /></p>

<!-- обсуждение на форуме, цифра изменяется при публикации статьи -->
<p class="discuss"><span><!--#include virtual="/scripts/forum-comments-num.php?i=9343"--></span></p>

<div class="links">
<h2>Ссылки по теме</h2>
<ul>
   <li><a href="/qa/ogr-python.html">Работа с векторными данными при помощи OGR и Python</a></li>
</ul>
</div>

<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 11.12.2011
<br>Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=5325" target="_blank">Александр Бруй</a></span></p>
<!--#include virtual="/inc/footer2.php" -->
