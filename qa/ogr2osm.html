<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Конвертация из формата shape в OSM XML с переназначением полей с помощью ogr2osm</title><!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Конвертация из формата shape в OSM XML с переназначением полей с помощью ogr2osm</h1>
<p class="ann">Описание работы с инструментом и исправленная его версия</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=5462"--></span></p>

<p>Это статья описывает процесс перевода векторных данных в формате shape в формат OSM XML, пригодный для загрузки в базу данных проекта OpenStreetMap - открытой карты России и всего мира. Пожалуйста, перед загрузкой, убедитесь, что ваши данные лицензионно чисты, вы получили их по открытым источникам или источникам, для которых вы имеете право переводить в их векторную форму. Снимки геосервисов Google, Microsoft и подобных такими данными - не являются! </p>
<p><strong>Оглавление</strong></p>
<ol>
	  <li><a href="#get">Получение и установка</a> </li>
	  <li><a href="#convert">Конвертация</a></li>
	  <li><a href="#mapping">Переназначение полей и значений</a></li>
	  </ol>

<!-- Первый раздел -->
<h2><strong><a name="01" id="01"></a></strong>1. Получение и установка</h2>
<p>Скачать оригинальную версию ogr2osm можно <a href="http://svn.openstreetmap.org/applications/utils/import/ogr2osm/" target="_blank" class="external">здесь</a>. </p>
<p>Если в shape-файлах есть атрибутика использующая кириллицу, лучше воспользоваться <a href="/programs/python/ogr2osm.zip">исправленной версией</a> (исправления внесены Александром Дежиным, в комплект также входит пример исходных и результирующих данных и файл настроек правил переназначения полей и значений с помощью которого результат был получен). </p>
<p>Внимание: для правильного перевода атрибутов, DBF таблица должна иметь кодировку UTF8. Если таблица имеет другую кодировку, можно использовать <a href="/qa/dbf-encode.html">конвертор</a>, чтобы перевести ее в UTF8.</p>
<p>Для работы программы нужен GDAL/OGR, установить его можно с <a href="/qa/qgis-osgeo4w.html">помощью OSGeo4W</a>, для работы рекомендуются пакеты gdal16 или gdaldev.</p>
<p>Запускаем шелл OSGeo4W и в нем выполняем gdal16 или gdaldev, после этого можно конвертировать. </p>
<!-- Второй раздел -->
<h2><strong><a name="02" id="02"></a></strong>2. Конвертация</h2>
<p>Запустить конвертор очень просто:  </p>
<pre>ogr2osm input.shp</pre>
<p>Результатом конвертации будет файл с таким же именем и расширением osm. Система координат данных будет прочитана из файла PRJ, если его нет, подразумевается что данные в Lat/Long WGS84.</p>
<h2><strong><a name="02" id="02"></a></strong>3. Переназначение полей и значений</h2>
<p>Атрибутивная информация, содержащаяся в DBF файле, будучи очень полезной, часто не отвечает условиям обозначения объектов в OSM. Это статья не объясняет, как правильно описывать атрибуты, для этого служат <a href="http://wiki.openstreetmap.org/wiki/RU:Map_Features" target="_blank" class="external">специальные справочники</a>. Здесь мы опишем как правильно настроить сам процесс и приведем примеры.</p>
<p>Для переназначения полей и значений необходимо иметь специальный файл, где эти переназначения описаны, он должен лежать в папке translations. Запускается конвертор в этом случае с ключем -t, за которым следует имя файла описания, без расширения py:</p>
<pre>python ogr2osm.py -t vmap0 built-utf.shp</pre>
<p> С помощью файла описания  можно:</p>
<ul>
  <li>изменить название тега/поля</li>
  <li>добавить ко всем объектам комбинацию тег/ключ</li>
  <li>для тегов соответствующих определенному названию изменить их значение.</li>
  </ul>
<p>Файл описания является небольшой программой на языке Python, представляющей собой функцию, которой передаются атрибуты shape-файла (attrs):</p>
<pre># -*- coding: utf-8 -*-
def translateAttributes(attrs):
	if not attrs: return
</pre>
<p>Внимание: должна обязательно быть указана строка кодировки UTF8 и сам текст должен быть в этой же кодировке. </p>
<p>После этого, стандартного начала идет описание правил, оно обычно начинается с очистки поля деятельности:</p>
<pre>tags = {}</pre>
<p>Рассмотрим на примерах что и как прописывается, определения тегов идут в порядке обратном тому, в котором они будут прописываться объектам, т.е. первый тег описанный в файле правил будет последним в списке тегов объекта.</p>
<p><strong>Переименование поля </strong></p>
<p>По умолчанию  названия полей превращаются в названия тегов, чтобы этого избежать, можно их переименовывать. Этот пример показывает как поле CODE, содержащее некоторые значения, переименовывается при экспорте в тег cladr:code, содержащий собственно значения. </p>
<pre>if attrs['CODE']:
		tags.update({'cladr:code':attrs['CODE']})</pre>
<p><strong>Переименование поля и замена значения по условию </strong></p>
<p>Все создаваемые объекты для записей, у которых в поле TYPE в shape-файле записана буква 'с' должны получить тег cladr:suffix со значением 'Село':</p>
<pre>if attrs['TYPE'] == 'с':
		tags.update({'cladr:suffix':'Село'})</pre>
<p><strong>Изменение строк</strong></p>
<p>При изменении значений можно использовать любые функции питона. Это пример например переводит строку в нижний регистр и делает первую букву заглавной. </p>
<pre>if attrs['NAM']:
		str = attrs['NAM'].lower().capitalize()
		tags.update({'name:en':str})</pre>
<p>Теги/ключи попадают в результирующий файл неотсортированными по имени, но они будут автоматически отсортированы при работе с <a href="/qa/josm-start.html">данными в JOSM</a>.</p>
<p>Пример окончательного файла настроек преобразования для перевода данных VMap0, который можно использовать как образец, также находится в архиве с обновленным кодом программы ogs2osm (<a href="/programs/python/ogr2osm.zip">скачать</a>). </p>
<!-- обсуждение на форуме, цифра изменяется при публикации статьи -->   
<p class="discuss"><span><!--#include virtual="/scripts/forum-comments-num.php?i=5462"--></span></p>
<!-- ссылки -->
<div class="links">
	<h2>Ссылки по теме</h2>
		<ul>
			<li><a href="/projects/osm-export.html">Данные OpenStreetMap по регионам РФ в форматах shape и OSM XML</a></li>
			<li><a href="/qa/vmap0-settl-rus.html">Русскоязычная база данных по названиям населенных пунктов на основе данных VMap0</a></li>
		</ul>
</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 13.06.2010
<br>Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=2" target="_blank">Максим Дубинин</a></span></p>
<!--#include virtual="/inc/footer2.php" -->