<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Получение значений растра по точечным профилям с помощью Python/GDAL</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Получение значений растра по точечным профилям с помощью Python/GDAL</h1>
<p class="ann">Описание скрипта для получения значений растра по точечным
профилям</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=8242"--></span></p>

<p>Задача получения данных из растра (серии растров) по некоторому набору
точечных объектов не редкость. Это необходимо при построении спектральных
профилей, количественной оценке точности растровых данных, анализе изменений,
при подготовке тренировочных наборов для классификации и т.д.</p>

<p align="center"><img src="/images/extract-pixel-data-02.gif" alt="Получение значений по точкам" width="400" height="389" /></p>
<!--<p align="center"><img src="/images/dtclassifier-04.png" alt="Получение данных по точкам" width="339" height="403"></img></p>-->

<p>На сайте уже присутствует <a href="/qa/extract-pixel-data.html">похожий
инструмент</a>, но он разработан для ArcView и имеет ряд ограничений.</p>

<p><strong>Оглавление</strong></p>
<ol>
  <li><a href="#01">Подготовка</a></li>
  <li><a href="#02">Использование</a></li>
</ol>

<!-- Первый раздел -->
<h2><strong><a name="01" id="01"></a></strong>1. Подготовка</h2>
<p>Для работы скрипта необходимо иметь <a href="/programs/python/extract-values.7z">сам скрипт</a>,
интерпретатор Python версии 2.5 или выше, библиотеку GDAL и ее привязки
(bindings) к Python.</p>
<p>Наиболее простым способом получить необходимые компоненты в ОС Windows
является использование установщика OSGeo4W:</p>
<ol>
  <li><a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup.exe" target="_blank" class="external">загрузить</a> установщик.
  Для пользователей, у которых возникают проблемы с доступом к серверу download.osgeo.org,
  создан <a href="http://download2.osgeo.org/osgeo4w/osgeo4w-setup-it.exe" target="_blank" class="external">альтернативный установщик</a>,
  работающий с зеркалом download2.osgeo.org</li>
  <li>запустить установщик</li>
  <li>выбрать пункт &laquo;Расширенная установка&raquo; и нажать &laquo;Далее&raquo;</li>
  <li>выбрать пакеты gdal и gdal-python (категория Libs), нажать &laquo;Далее&raquo;</li>
  <li>выбранные пакеты и необходимые зависимости будут загружены и установлены
  автоматически</li>
</ol>
<p>Пользователи OC Linux должны установить необходимые пакеты при помощи
пакетного менеджера своего дистрибутива.</p>
<p>Архив со скриптом необходимо распаковать, и файл extract_values.py
поместить в любой удобный каталог, например, в C:\Tools\GIS. Запускать
скрипт следует из командной строки OSGeo4W.</p>

<h2><strong><a name="02" id="02"></a></strong>2. Использование</h2>
<p>Скрипт запускается из командной строки и принимает несколько параметров</p>
<pre>extract_values.py [-c] [-r] point_shapefile [raster_file(s)] [-d directory_with_rasters]</pre>
<ul>
  <li>point_shapefile&nbsp;&mdash; точечный shape-файл, по объектам которого
  будет выполняться экстракция значений</li>
  <li>raster_file(s)&nbsp;&mdash; список растров из которых необходимо
  извлечь данные. Если растры и скрипт находятся в разных каталогах,
  необходимо указывать <strong>полный путь</strong> к файлам. Элементы
  списка разделяются пробелами</li>
  <li>-c&nbsp;&mdash; активирует режим записи данных во внешний файл. Рядом
  с каждым растром будет создан CSV-файл (имя совпадает с именем shape-файла),
  в котором будут присутствовать как значения всех полей исходного shape-файла,
  так и экстрагированные значения растра. В этом режиме исходный shape-файл
  не модифицируется</li>
  <li>-r&nbsp;&mdash; указывает на необходимость преобразования координат
  точек в систему координат растра. Используется, если растры и вектор имеют
  разные системы координат</li>
  <li>-d&nbsp;&mdash; режим обработки каталога. После ключа указывается
  каталог с растрами, экстракция данных будет выполняться из всех растров
  в каталоге</li>
</ul>
<p>Скрипт работает с одно- и многоканальными растровыми данными GDAL-совместимых
форматов. Для каждого одноканального растрового слоя в точечном слое будет
создано поле с названием, равным названию растрового слоя, а в случае
многоканального растра к названию слоя добавится номер канала.</p>
<strong>Важно!</strong> Необходимо помнить, что название поля в формате
DBF ограничено 10 символами, поэтому длинные названия будут обрезаться.</p>
<p>Ниже показан результат извлечения данных из 6-канального фрагмента Landsat
(тип данных Byte, название файла снимка&nbsp;&mdash; clearcuts_174016.tiff),
открытый в QGIS. К исходным двум полям shape-файла (id, taxon) добавились
поля clearcut_1 - clearcut_6 (видим, что имена полей обрезаны чтобы
удовлетворять требованиям формата DBF) со значениями соответствующих
каналов в каждой точке.</p>
<p align="center"><img src="/images/extract-values-rasters-01.png" alt="Результат извлечения" width="860" height="508" /></p>

<p><strong>Примеры</strong></p>
<p>Получить значения растра after.tiff по точечному shape-файлу poi.shp
(скрипт и файлы находятся в одном каталоге)</p>
<pre>extract_values.py poi.shp after.tiff</pre>

<p>Получить значения растра after.tiff по точечному shape-файлу poi2.shp
и записать их во внешний файл</p>
<pre>extract_values.py -с poi2.shp after.tiff</pre>

<p>Получить значения растра after.tiff по точечному shape-файлу poi2.shp,
система координат которого отличается от системы координат растра</p>
<pre>extract_values.py -r poi2.shp after.tiff</pre>

<p>Получить значения растров before.tiff и after.tiff по точечному
shape-файлу points.shp</p>
<pre>extract_values.py points.shp before.tiff after.tiff</pre>

<p>Получить значения всех растров каталога по точечному shape-файлу
points.shp</p>
<pre>extract_values.py points.shp -d D:\data\rasters_veg</pre>

<!-- обсуждение на форуме, цифра изменяется при публикации статьи -->
<p class="discuss"><span><!--#include virtual="/scripts/forum-comments-num.php?i=8242"--></span></p>

<div class="links">
<h2>Ссылки по теме</h2>
<ul>
   <li><a href="/qa/extract-values-grids.html">Получение данных по точечным профилям из серий растровых данных</a></li>
   <li><a href="/qa/gdal-python.html">Работа с растрами при помощи GDAL и Python</a></li>
   <li><a href="/qa/ogr-python.html">Работа с векторными данными при помощи OGR и Python</a></li>
</ul>
</div>

<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 13.07.2011
<br>Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=5325" target="_blank">Александр Бруй</a></span></p>
<!--#include virtual="/inc/footer2.php" -->
