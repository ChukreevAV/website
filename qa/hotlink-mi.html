<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Геоссылка в Mapinfo</title>
<!--#include virtual="/inc/header2.txt" -->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<!--Contents start-->
<h1>Геоссылка в Mapinfo</h1>
<p class="ann">Использование инструмента связи геоданных и внешних файлов в Mapinfo</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=4008"--></span></p>

<h2>Исходные условия и подготовка </h2>
<p>Задача: Организовать запуск некоторого контента при выборе определенного объекта на карте.</p>
<p>Пути решения: Использовать стандартный механизм HotLink, в русском наименовании &quot;геоссылку&quot; (далее ГС), позволяющий превращать текстовое поле таблицы в гиперссылку. Все действия с указанным путем производятся, так как если бы данный файл был выбран в окне проводника Windows.</p>
<p>Подготовительная работа: </p>
<p>1.	Создадим каталог, в который положим <a href="/images/hotlink-mi-images.7z">набор JPG файлов</a>. Все их пронумеруем от 0 до 77 – получим имена img000.jpg - img077.jpg </p>
<p>2.	Полные пути к этим файлов, хотя можно использовать и  относительные, далее занесем в специально выбранное поле. </p>
<h2>Порядок действий</h2>
<p>1. Открываем  таблицу, на поле из которой будем показывать ссылки.</p>
<p>2. В  нем должно быть текстовое поле достаточной длины, что бы вместить ссылки. Т.к.  ограничение на длину текста 254 символа – либо ссылки должны быть  относительными к адресу самой таблицы, либо полностью укладываться в 254  символа. Кавычки – не нужны.</p>
<p>3. Допустим мы используем каталог &quot;T:\70\&quot; для таблицы и картинок, но путь  будем указывать полный - &quot;T:\70\img000.jpg &quot;</p>
<p>4. Вот  пример структуры таблицы. Использована карта районов Московской области,  их названия искажены:</p>
<p align="center"><img src="/images/hotlink-mi-01.gif" width="419" height="428"></p>
<p>&nbsp;</p>
<p align="center"><img src="/images/hotlink-mi-02.gif" width="700" height="596"></p>
<p>5. Поле  для ссылок – xREF char(254)</p>
<p>6. Вот данные, которыми оно заполнено (скачать <a href="/other/hotlink-mi-table.7z">таблицу</a> и <a href="/other/hotlink-mi-images.7z">изображения</a>)</p>
<p align="center"><img src="/images/hotlink-mi-03.gif" width="663" height="835"></p>
<p>Каждой записи – соответствует путь к файлу.</p>
<p>7.	Теперь создаем собственно HotLink: </p>
<p>A.	Открываем таблицу в окне карты </p>
<p>B.	Открываем управление слоями: </p>
<p align="center"><img src="/images/hotlink-mi-04.gif" width="432" height="443"></p>
<p>C.	Выбираем &quot;<em>HotLink</em>…&quot; </p>
<p>D.	Появляется следующее окно: </p>
<p align="center"><img src="/images/hotlink-mi-05.gif" width="530" height="438"></p>
<p>E.	Заполняем его данными о том, какое поле и как будет использоваться для ссылок.</p>
<p>F.	Выбираем <em>Add </em></p>
<p align="center"><img src="/images/hotlink-mi-06.gif" width="529" height="436"></p>
<p>G.	Выбираем (меняем) поле, в котором храним ссылки. В нашем случае по умолчанию выбралось 1-ое текстовое поле, а нам нужно, что бы это было поле xREF.</p>
<p>H.	Производим выбор дополнительных настроек: </p>
<p>i.	<em>FileName Expression</em> – способ формирования пути к файлу. У нас – простейший на прямую из колонки, но можно было составить и сложное выражение – приписывать общее начало пути к файлу, комбинировать колонки и т.п. – любые строковые выражения, которые должны задать путь к файлу, который хотим запустить. </p>
<p>ii.	Переключатель <em>File locations </em>… - если не указан диск, то пути будут считать относительными путями, и рассчитываться по отношению к текущему положению таблицы со ссылками. </p>
<p>iii.	Радио-кнопки <em>Activate HotLink on</em>: определяет на чем будет срабатывать наш указатель вызова ссылки (ГС), на подписях объекта, на самом объекте или на том и другом. </p>
<p>iv.	<em>Save options to table metadata </em>– указывает на то, что надо сохранить наши настройки вызова ГС в метаданные таблицы. Это ДОЛЖНО позволить сохранить настройки для последующего использования. Эти данные записываются в файл TAB таблицы. Вот так это выглядит: </p>
<pre>begin_metadata &quot;\ActiveObject&quot; = &quot;&quot;
&quot;\ActiveObject\Expr&quot; = &quot;xREF&quot;
&quot;\ActiveObject\Mode&quot; = &quot;HOTLINK_MODE_BOTH&quot;
&quot;\ActiveObject\Relative&quot; = &quot;TRUE&quot;
&quot;\ActiveObject\Enabled&quot; = &quot;TRUE&quot;
&quot;\IsReadOnly&quot; = &quot;FALSE&quot;
end_metadata </pre>
<p>I.	Закрываем окна настройки ГС и слоев карты. </p>
<p>8. Теперь надо вызвать ГС, что бы она запустила нам файл-ссылку на выполнение. Для этого используется специальный режим. Он вызывается после выбора  кнопки <em>HotLink <img src="/images/hotlink-mi-08.gif" width="23" height="20"></em>:</p>
<p align="center"><em><img src="/images/hotlink-mi-09.gif" width="121" height="327"></em> </p>
<p>9.	Теперь при выборе объекта, имеющего ГС, форма курсора будет менять на символ &quot;рука с молнией&quot;. </p>
<p>10.	После нажатия кнопки мыши на объекте с названием &quot;Молодежный&quot; – произошел запуск вот такой картинки из файла &quot;T:\70\img050.jpg </p>
<p align="center"><em><img src="/images/hotlink-mi-10.gif" width="700" height="796"></em></p>
<p>11.	В последних версиях добавлена возможность множественного геолинка. Теперь, если задано несколько полей, из которых могут браться данные для ссылки, после нажатия кнопки мыши, вызывается дополнительное меню, в котором надо выбрать поле, из которого будет взята ссылка.</p>
<p>Задача решена.</p>
<h2>Как показать только названия  файлов без пути. </h2>
<p>Геолинк показывает полный путь к файлу в следующих случаях:
  <ol>
</p>
<ul><li>если они явно указаны;</li>
  <li>если в настройках слоев указано, что файлы будут  искаться относительно текущего положения таблицы с геолинком:</li>
  </ul>
<p align="center"><em><img src="/images/hotlink-mi-11.gif" width="530" height="438"></em></p>
<p>Прописывание ссылки не  файл, а на его ярлык (Shortcut) – файл с  расширением lnk и применение инструмента &quot;геолинк&quot; к такой  ссылке приводит к аварийному завершению Mapinfo.</p>
<p>Геолинк осуществляет поиск файлов, не имеющих явно заданного пути, при отключенной опции "<em>поиск относительно текущего положения таблицы</em>" в каталогах, прописанных в переменной окружения PATH:</p>
<p align="center"><em><img src="/images/hotlink-mi-12.gif" width="418" height="504"></em></p>
<p>В этом случае, при наведении  &quot;геолинка&quot; на объект карты, название файла выводится БЕЗ указания  полного пути:</p>
<p align="center"><em><img src="/images/hotlink-mi-13.gif" width="624" height="298"></em></p>
<p>В приведенном примере имеет место  перекрытие нескольких объектов, поэтому выводится окно, в котором отображаются  оба объекта. Для их идентификации используются подписи, сформированные для  данной таблицы в легенде карты.</p>
<p> В случае, когда задан только один  столбец для &quot;геолинка&quot; и нет перекрытия объектов – сразу же  выполняется ссылка, без всяких промежуточных окон. 
  Для варианта с двумя и более столбцами  для &quot;геолинка&quot; (в версиях 9.0 и выше),  может задаваться порядок их обработки:</p>
<p align="center"><em><img src="/images/hotlink-mi-14.gif" width="530" height="438"></em></p>
<p>И использование инструмента  &quot;геолинк&quot; вызывает окно выбора поля:</p>
<p align="center"><em><img src="/images/hotlink-mi-15.gif" width="700" height="212"></em></p>
<!-- обсуждение на форуме, цифра изменяется при публикации статьи -->   
<p class="discuss">
   <span><!--#include virtual="/scripts/forum-comments-num.php?i=4008"--></span>
</p>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 15.10.2009
<br>Автор(ы): <a href="/forum/memberlist.php?mode=viewprofile&u=538" target="_blank">Борис Фельдман</a></span></p>
<!--#include virtual="/inc/footer2.php" -->