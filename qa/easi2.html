<!--#include virtual="/inc/header02.txt" -->
<title>GIS-Lab: Основы макроязыка EASI (PCI Geomatica) - Анализ данных</title>
<!--#include virtual="/inc/header2.txt" -->
<!--Contents start-->
<div class="cont">
<div class="col1">

<ul class="path">
   <li class="first"><a href="/">Главная</a></li>
   <li><a href="/qa.html">Вопросы и ответы</a></li>
</ul>
<h1>Основы макроязыка EASI (PCI Geomatica)<br />Часть 2. Анализ данных.</h1>
<p class="ann">Вторая часть серии статей о языке EASI, основные команды языка для анализа данных.</p>
<p class="discuss discuss_top"><span><!--#include virtual="/scripts/forum-comments-num.php?i=1661"--></span></p><p><strong>Содержание</strong></p>
            <ul><li><a href="#arithm">Арифметические операции</a></li>
              <li><a href="#logic">Логические операции</a></li>
              <li><a href="#math">Специальные команды для выполнения математических операций</a></li>
              <li><a href="#masks">Операции над растровыми масками</a></li>
              <li><a href="#model">Команда MODEL и язык моделей</a></li>
              <li><a href="#filters">Фильтры</a></li>
              <li><a href="#histo">Гистограммы значений</a></li>
              <li><a href="#vector">Работа с векторными данными </a></li>
              <li><a href="#imageanalysis">Краткий перечень  специальных команд анализа изображений</a></li>
            </ul>
            <p><a name="arithm" id="arithm"></a><strong>Арифметические операции</strong></p>
            <p>Язык EASI отличается чрезвычайной простотой выполнения арифметических и логических операций над растровыми данными. Для выполнения расчетов с использованием нескольких растров, необходимо, что бы изображения были собраны в один файл PCIDSK. Для проведения расчетов дополнительные каналы данных из других файлов можно временно привязать к рабочему файлу с помощью команды PCIADD2  с опцией exist (см. <a href="easi1.html">предыдущую статью</a>).</p>
            <p> Перед началом выполнения операций необходимо задать рабочий файл с помощью параметра file:<br />
              file=”(имя файла)</p>
            <p> При создании арифметических выражений ссылка на каналы данных обозначается %:<br />
              %1 – первый канал. </p>
            <p>Ссылка на растровые маски (сегменты) выглядит так: <br />
            %%2 – сегмент номер 2.</p>
            <p>Примеры записи простых выражений:<br />
              %2=%1+10 – к значениям пикселей канала 1 прибавить константу (10) и записать в канал 2. <br />
              %1=0 – обнулить значения канала 1.<br />
              %7=(%1-%2)/(%1+%2) – Вычисление NDVI и запись его в 7 канал. <br />
              %16=100*((%3-%2)/(%3+%2)+1) – Вычисление NDVI и масштабирование результата из диапазона -1 – 1 в диапазон 0 – 200.              </p>
            <p>Возможна запись результата в исходный канал:<br />
              %10=%10+5 – увеличиваем все значения пикселей на константу.</p>
            <p> Существует ряд дополнительных команд, которые можно использовать в арифметических выражениях:<br />
              min, max – минимальное и максимальное значение пикселя по заданным каналам,<br />
              int, abs – округление до целого и модуль,<br />
              sin, cos и т.д. – тригонометрические функции,
              <br />
              ln, exp, log10, exp10 – логарифмические функции.</p>
            <p>Пример использования функции:<br />
              %10=max(%1,%2,%3,%4,%5,%6,%7,%8,%9) – вычисление максимального значения из 9 каналов.</p>
            <p> В случае, когда результат нужен только на время вычисления, можно использовать переменные. Переменные декларируются перед началом операции: </p>
            <pre>local int i
i= max(%1,%2,%3)
</pre>
            <p>Если однотипную операцию надо провести над множеством каналов, можно использовать циклы:</p>
<pre>local int i
for i = 10 to 15
%{i}=%{i-9}*100
endfor</pre>
            <p>Каналы 10-15 получат значения каналов 1-6, умноженных на 100.<br />
Впрочем, использование циклов не ускоряет расчеты, поэтому для наглядности обычно удобнее использовать простые команды.</p>
            <p> Для обозначения пространственных координат пикселя существует набор встроенных переменных, которые также бывает полезно использовать в расчетах:<br />
              @x, @y – положение пикселя по отношению к верхнему левому углу, в пикселях,<br />
              @geox, @geoy – метрические координаты пикселя в проекции растра, и другие.<br />
              Дополнительно об использовании встроенных переменных смотрите в справочной системе EASI.</p>
            <p><a name="logic" id="logic"></a><strong> Логические операции</strong></p>
            <p>Описание простого условия в EASI выглядит так:<br />
if (%1>100) %2=3 – если значения канала 1 больше 100, канал 2 принимает значение 3.</p>
            <p> Условие с записью результата в растровую маску (сегмент):</p>
            <pre>if (%1>100) %%2=1</pre>
            <p>(Помните, что пиксели растровой маски принимают только значения 0 и 1)</p>
            <p> Выполнение действия только в пределах растровой маски: </p>
			<pre>if (%%2=1) %2=%1+10</pre>
            <p>Двойное условие:</p>
			<pre>if (%1>100) and (%3=1) %2=3

if (%1>100) or (%3=1) %2=3 </pre>
            <p>Сложное условие:</p>
			<pre>if (%1>100) or (%2<=1) then
%3 = 5
%4 = 20
else
%3 = 0
%4 = 10
endif
</pre>
            <p><strong><a name="math" id="math"></a>Специальные команды для выполнения математических операций</strong></p>
            <p> <strong>ARI</strong> – арифметические вычисления.<br />
              Использование:<br />
              file=" (имя файла)<br />
              oper="add/sub/mul/div/and/or (тип операции)<br />
              cnst= (значение константы – если есть)<br />
              mask= (маска для проведения операции)<br />
              dbic= (список входных каналов)<br />
              dboc= (канал для записи результата)<br />
              auto= (автоматическое масштабирование результатов)<br />
              rval= (значения минимального и максимального порогов для входных и выходных значений при масштабировании: rval=IN_min,IN_max,OUT_min,OUT_max)
              <br />
              zerodiv= (значение, которое будет выдаваться при получении не действительного результата – например, при делении на ноль)            </p>
			  <pre>r ari</pre>
              <p>Использование команды ARI в цикле:</p>
			  <pre>local int i<br />
for i = 1 to 5
cnst=90
mask=
oper="add
dboc=i

r ari

endfor</pre>
            <p>К значениям каналов 1-5 будет прибавлена константа 90.</p>
              <p> <strong>SCALE</strong> – применение линейных и нелинейных функций к значениям растра.<br />
                Пример простого использования – изменение диапазона значений 1-100 на 1-255<br />
                fili=" (имя входного файла)<br />
                filo=" (имя выходного файла)<br />
                dbic= (список входных каналов)<br />
                dboc=(список выходных каналов)<br />
                inrange=1,100<br />
                outrange=1,255              </p>
				<pre>r scale</pre>
            <p>Дополнительный параметр sfunct позволяет задать тип функции для масштабирования - подробнее смотрите в справочной системе EASI.</p>
                <p> <strong>CLR</strong> – Очистка канала изображения.<br />
                  file=" (имя файла)<br />
                  dboc= (список каналов)<br />
                  valu= (значение, которое будет записано в канал)<br />
                  dbow= (опционно – возможность задать прямоугольную область для очистки) </p>
				  <pre>r clr</pre>
		    <p><strong><a name="masks" id="masks"></a>Операции над растровыми масками</strong></p>
				  <p> <strong>BLO</strong> – Логические операции над растровыми масками.<br />
				    file=" (имя файла)<br />
				    logfunc="and/or/xor/sub/not (тип операции)<br />
				    dbsn=" (имя выходной маски – обязательный параметр)<br />
				    dbib= (входные маски a,b)<br />
				    dbob= (выходная маска. Если пустой – будет создана новая)		    </p>
					<pre>r blo</pre>
				    <p>Типы операций для масок a и b<br />
and - a и b;<br />
or - a или b;<br />
xor – что-то одно, если обе маски нулевые или =1, то выходное значение =0;<br />
sub - a и не b;<br />
not – «негатив» маски (в dbib должно быть только одно значение).</p>
				    <p> <strong>MAP</strong> – Копирование растровой маски в канал изображения.<br />
				      file=" (имя файла)<br />
				      dbib= (маска)<br />
				      dboc= (каналы изображения, которые будут изменены)<br />
				      valu= (значение, которое записывается в канал изображения под маской)</p>
					  <pre>r map</pre>
	        <p><strong>THR </strong>– создание растровой маски по интервалу пороговых значений</p>
				      <p> file=" (имя файла)<br />
				        dbic= (канал)<br />
				        dbob= (растровая маска. Если пустой – будет создана новая)<br />
				        tval= (минимальное и максимальное пороговые значения. Например, 1,10 – маска получит значения 1 только если значения канала равны или больше 1 и при этом равны или меньше 10)<br />
				        dbsn=" (имя нового сегмента – обязательное поле)	        </p>
						<pre>r thr</pre>
	        <p><strong>RANDBIT</strong> – простая команда для создания случайной выборки пикселей на основе существующей растровой маски. Подробнее смотрите в справочной системе EASI.</p>
				        <p><strong> <a name="model" id="model"></a>Команда MODEL и язык моделей</strong></p>
				        <p> Помимо прямого использования арифметических и логических операторов, вводимых из командной строки или записанных в виде скрипта, в EASI используется специальный язык моделей, сходный по синтаксису с самим EASI. Модели для выполнения записываются в файлы с расширением .mod и вызываются на выполнение командой <strong>MODEL</strong>:</p>
				        <p>
				          file=" (имя файла)<br />
				          source=" (имя файла модели *.mod)</p>
						  <pre>r model</pre>
            <p>В файле модели имя файла не указывается. Таким образом, одна и та же модель может быть применена к множеству файлов с одинаковым набором каналов.</p>
				          <p> Основное отличие языка моделей от языка EASI – необходимость разделения строк точкой с запятой: </p>
						  <pre>%1=%2+10;</pre>
				          <p>Запись условия:</p>
						  <pre>if (%1>100) then
%2=3;
%3=4;
endif;</pre>
				          <p>Встроенные функции работают как в языке EASI:</p>
						  <pre>%10= max(%1,%2,%3);</pre>
				          <p>Декларировать переменные в моделях не нужно. Скалярные переменные обозначаются знаком #:<br />
#a=100; - переменная равна константе.<br />
#a=%1; - переменная равна значению канала 1.<br />
if (#a>0) and (#b>0) then %2=3; endif; - использование переменных в условии.
<br />
#test=max(%1,%2,%3); - создание временной переменной и запись в нее результата вычисления.<br />
Текстовые переменные (если они нужны) обозначают знаком $:</p>
<pre>$a="test"</pre><p>Другой вариант использования модели: ввод модели из командной строки или из скрипта. Для этого перед началом записи модели введем выражение:</p>
            <p> model on " (имя файла)</p>
            <p> Далее поместим текст модели и завершим модель:</p>
            <p> endmodel</p>
            <p> ОБРАТИТЕ ВНИМАНИЕ: если модель вводиться таким образом из командной строки или в скрипте, использование точке с запятой в конце строки не допускается!</p>
            <p><strong> <a name="filters" id="filters"></a>Фильтры</strong></p>
            <p> Создание фильтров на языке EASI основано на использовании специальных переменных, определяющих координаты пикселя в единицах растра: @x, @y (см. выше).
              Запись фильтра, вычисляющего среднее значение канала 4 в плавающем окне 3х3 пикселя выглядит так:              </p>
            <p>model on “(имя файла) </p>
            <pre>%7 = (%4[@x-1,@y-1] + %4[@x,@y-1] + %4[@x+1,@y-1] + \<br />
%4[@x-1,@y ] + %4[@x,@y ] + %4[@x+1,@y ] <br />
+ \
%4[@x-1,@y+1] + %4[@x,@y+1] + %4[@x+1,@y+1] ) / 9<br />
endmodel</pre>
              <p>Фильтры, заданные таким образом, корректно обрабатывают края  изображения, дублируя значения из области растра за пределы изображения.</p>
              <p>Существует набор специальных команд для выполнения  стандартных операций фильтрации:</p>
              <p><strong>FAV</strong> – Вычисление  среднего в плавающем окне. </p>
              <p>file=&quot;  (имя файла)<br />
                dbic=  (входной канал)<br />
                dboc=  (выходной канал)<br />
                flsz=  (размер плавающего окна. Например: 3,3)<br />
                mask=  (опционно: маска для выполнения операции)</p>
              <pre>r fav</pre>
              <p><strong>FME</strong> - Вычисление  медианы в плавающем окне. </p>
              <p>file=&quot;  (имя файла)<br />
                dbic=  (входной канал)<br />
                dboc=  (выходной канал)<br />
                flsz=  (размер плавающего окна. Например: 3,3)<br />
              mask=  (опционно: маска для выполнения операции)</p>
				<pre>r fme</pre>
                <p><strong>FED</strong> – Фильтр  для обнаружения границ (edge detection). Вычисляет среднее модулей разности значений  пикселей окна с центральным пикселем.</p>
                <p>file=&quot;  (имя файла)<br />
                  dbic=  (входной канал)<br />
                  dboc=  (выходной канал)<br />
                  flsz=  (размер плавающего окна. Например: 3,3)<br />
                  mask=  (опционно: маска для выполнения операции)</p>
				  <pre>r fed</pre>
                  <p><strong>FMO</strong> – Вычисление  моды. Этот фильтр аналогичен majority filter  в ERDAS Imagine. </p>
                  <p>file=&quot;  (имя файла)<br />
                    dbic=  (входной канал)<br />
                    dboc=  (выходной канал)<br />
                    flsz=  (размер плавающего окна. Например: 3,3)<br />
                    mask=  (опционно: маска для выполнения операции)</p>
					<pre>r fmo</pre>
                    <p>Существуют два дополнительных полезных параметра этой  команды:</p>
					<pre>thinline="on/off</pre>
                    <p>При использовании фильтра 3х3 значение &quot;on&quot; (по умолчанию) означает,  что вычисление моды будет производиться только тогда, когда число пикселей класса,  которому принадлежит центральный пиксель окна, меньше 3.  Это позволяет при фильтрации тематических карт  сохранять линейные объекты.</p>
					<pre>keepvalu=</pre>
                    <p>Значения классов, фильтрация которых не производиться.</p>
                    <p>Дополнительные команды фильтрации (описание команд смотрите  в справочной системе EASI):<br />
                        <strong>TEX</strong> – вычисление текстурных функций.<br />
                        <strong>FSHARP</strong> – Увеличение контраста изображения.<br />
                        <strong>FGA</strong> – Гауссовское сглаживание.</p>
                    <p><strong><a name="histo" id="histo"></a>Гистограммы</strong><strong> значений</strong><strong> </strong></p>
                    <p><strong>HIS</strong> – Графический  вывод гистограммы значений по каналу.</p>
                    <p>file=&quot; (имя файла)<br />
                      dbic= (номер канала)<br />
                      mask= (опционно: маска для выполнения операции)<br />
                      report= (вывод на экран или имя файла для вывода в файл)</p>
					  <pre>r his</pre>
					  <p>Существует несколько дополнительных параметров,  настраивающих вид гистограммы. Описание дополнительных параметров команды  смотрите в справочной системе EASI.</p>
					  <p>Помимо графического или табличного представления гистограммы  значений, будет выведено среднее, медиана, мода, максимум и минимум значений, а  так же число пикселей, использованных для расчета. Поскольку формат вывода  стандартный, результаты вывода в файл могут быть обработаны простыми  программами для создания таблиц значений. Пример обработки файлов с  использованием программ на языке PERL  приведен в <a href="easi4.html">4-ой статье</a>.</p>
					  <p><strong>HISDUMP</strong> – Вывод гистограммы значений в виде таблицы.</p>
					  <p>file=&quot; (имя файла)<br />
					    dbic= (список каналов)<br />
					    mask= (опционно: маска для выполнения операции)<br />
					    report= (вывод на экран или имя файла для вывода в файл)<br />
					    hisform=”  (формат гистограммы)</p>
						<pre>r hisdump</pre>
					    <p>Значения параметра hisform определяют формат таблицы:<br />
raw  – одна колонка для каждого канала , показывающая частоту встречаемости каждого  класса<br />
center  – то же плюс дополнительная колонка, показывающая значение, встречаемость  которого вычисляется<br />
hitcenter  – то же, значения с нулевой встречаемостью опущены.<br />
Описание дополнительных параметров команды смотрите в  справочной системе EASI.</p>
					    <p><strong><a name="vector" id="vector"></a>Работа</strong><strong> с</strong><strong> векторными</strong><strong> данными</strong><strong> </strong></p>
					    <p>Векторные данные обычно хранятся внутри рабочих файлов PCIDSK в виде сегментов. Для  этого проекция вектора должна совпадать с проекцией растровой базы данных. Если  Вы импортировали векторный файл в PCIDSK из формата shp, скажем, в географических  координатах, то для переноса векторного сегмента в рабочий растровый файл его  надо спроецировать командой VECPRO:</p>
					    <p><strong>VECPRO</strong> – Изменение проекции векторных сегментов.<br />
					      Краткий вариант использования команды:<br />
					      fili=&quot; (имя файла с векторным сегментом)<br />
					      filo=&quot; (имя файла с растровыми данными, в которые  переносится сегмент)<br />
	        dbvs= (номер сегмента. Если векторный файл импортирован с  помощью команды FIMPORT,  номер сегмента = 2)</p>
			<pre>r vecpro</pre>
					    <p>Программа произведет трансформацию на основе сегментов  привязки файлов.<br />
Дополнительные параметры команды (смотрите в справочной  системе EASI) позволяют  производить трансформацию по выбранным сегментам привязки.</p>
					    <p><strong>GRDPOL</strong> – Растеризация полигональных векторных данных. </p>
					    <p>filv=&quot;  (имя файла с векторным сегментом. Если сегмент находится в рабочем файле,  параметр не заполняем)<br />
					      dbvs=  (номер векторного сегмента)<br />
					      file=&quot;  (рабочий файл)<br />
					      dboc=  (канал, в который производим растеризацию)<br />
					      fldnme=&quot;  (имя поля, значения которого будет присвоено пикселям)
					    algo=&quot;  (алгоритм растеризации. Для полигональных объектов лучше использовать polygon)</p>
						<pre>r grdpol</pre>
					    <p>(Обратите внимание, что, если номер выходного канала не  задан, будет создано новый растровый сегмент и произведена растризация в него.  При этом значения поля учитываться не будут.)</p>
					    <p><strong>KRIGING</strong> – Интерполяция точечных векторных данных (смотрите в справочной системе EASI)</p>
					    <p><strong>RTV</strong> – Векторизация  растровых данных.</p>
					    <p>file=&quot;  (рабочий файл)<br />
					      dbic= (векторизуемый канал)<br />
					      dbsn=&quot;  (имя сегмента – обязательное поле)<br />
					      polyinfo=&quot;  (создание линий или меток. обычно используют оба – “both”)
					    border=&quot; (отрисовка  линий границ растра. Обычно “on”)</p>
						<pre>r rtv</pre>
					    <p>Дополнительные команды (описание команд смотрите в  справочной системе EASI):<br />
                          <strong>VECBUF</strong> – Создание растровых масок в виде буфера линейных и точечных объектов  векторного слоя.<br />
                          <strong>CONTOUR</strong> – Создание векторного контура на основе растровых данных (обычно применяется  для ЦМР).<br />
                          <strong>VECMERG</strong> – Объединение векторных данных из разных сегментов.<br />
                          <strong>VIMAGE</strong> – Расчет зональной статистики по растру в пределах векторных объектов и запись  статистики в базу данных векторного сегмента.</p>
					    <p><strong><a name="imageanalysis" id="imageanalysis"></a>Краткий перечень  специальных команд анализа изображений</strong><br />
					      Подробное описание команд смотрите в справочной системе EASI.</p>
		                <p>Преобразование изображений<br />
                            <strong>LUT</strong> – Масштабирование  значений по каналам на основе данных сегмента таблицы радиометрической  коррекции (Look up Table). <br />
                            <strong>MATCH</strong> –  «Подгонка» гистограмм изображений.<br />
                            <strong>RADNORM</strong> – радиометрическая нормализация перекрывающихся снимков.<br />
                            <strong>PCA</strong> – Вычисление главных компонент. <br />
                            <strong>TASSE<em>L</em></strong> - Преобразование tasseled cap для Landsat MSS, TM и Landsat 7.<br />
            <strong>PANSHARP</strong> – Увеличение контрастности многоканального изображения с использованием  панхроматического канала высокого разрешения.</p>
					    <p>Работа с ЦМР (DEM)<br />
                            <strong>ASP</strong> – Расчет  аспекта.<br />
                            <strong>SLP</strong> – Расчет  склона.<br />
                            <strong>ARE</strong> – Расчет площади в пределах растровой маски с использованием  ЦМР.</p>
					    <p>Пространственная статистика<br />
                            <strong>IPG</strong> – Создание  базы растровых полигонов. Используется правило объединения 8-соседей. <br />
                            <strong>POG</strong> – Расчет  площади и периметра растровых полигонов.<br />
                            <strong>SIEVE</strong> –  Объединение полигонов по заданному критерию минимальной площади.</p>
					    <p>Кластеризация<br />
                          <strong>KCLUS</strong> -  Кластеризация методом K-means.<br />
                          <strong>FUZCLUS</strong> – Кластеризация методом Fuzzy K-means.<br />
                          <strong>ISOCLUS</strong> - Кластеризация методом ISODATA.<br />
                          <strong>NGCLUS</strong> – Непараметрическая  кластеризация.</p>
					    <p>Классификация<br />
                            <strong>MLC</strong> – Непараметрическая  (параллелепипед) или параметрическая (максимальное подобие) классификация с  обучением.<br />
                            <strong>MINDIS </strong>– Классификация по методу наименьшего расстояния.<br />
                            <strong>KNN</strong> – Классификация  методом к-ближайших соседей (K-Nearest Neighbors method).</p>
					    <p class="discuss">
							<span><!--#include virtual="/scripts/forum-comments-num.php?i=1661"--></span>
			</p>
			<div class="links">
			<h2>Ссылки по теме</h2>
			<ul>
               <li><a href="easi1.html">Основы макроязыка EASI (PCI Geomatica). Часть 1. Управление данными</a></li>
			   <li><a href="easi3.html">Основы макроязыка EASI (PCI Geomatica). Часть 3. Географическая привязка и проекции</a></li>
			   <li><a href="easi4.html">Основы макроязыка EASI (PCI Geomatica). Часть 4. Примеры автоматизации процессов</a></li>
			</ul>
			</div>
<!--Contents end-->
<!--#include virtual="/scripts/date.php" -->
<p class="status"><span>Дата создания: 15.08.2007
<br>
Автор(ы): Пётр Потапов</span></p>
<!--#include virtual="/inc/footer2.php" -->